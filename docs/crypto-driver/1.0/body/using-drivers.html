<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="7 Using drivers from an application" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://arm-software.github.io/psa-api/crypto-driver/1.0/body/using-drivers.html" />
<link rel="canonical" href="https://arm-software.github.io/psa-api/crypto-driver/1.0/body/using-drivers.html" />
<meta property="og:site_name" content="PSA Certified Crypto Driver Interface 1.0" />
<meta property="og:description" content="Alpha Using transparent drivers: Transparent drivers linked into the library are automatically used for the mechanisms that they implement. Using opaque drivers: Each opaque driver is assigned a lo..." />
<meta name="description" content="Alpha Using transparent drivers: Transparent drivers linked into the library are automatically used for the mechanisms that they implement. Using opaque drivers: Each opaque driver is assigned a lo..." />

    <title>7 Using drivers from an application &#8212; PSA Certified Crypto Driver Interface 1.0</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=f6a572b4" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
    <link rel="preconnect" type="text/css" href="https://fonts.googleapis.com" />
    <link rel="preconnect" type="text/css" href="https://fonts.gstatic.com" />
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,300;0,400;1,300;1,400&display=swap" />
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Noto+Sans+Mono:ital,wght@0,300;0,400;1,300&display=swap" />
    <script src="../_static/documentation_options.js?v=d052748e"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="1 Open questions" href="../appendix/open-issues.html" />
    <link rel="prev" title="6 Opaque drivers" href="opaque.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/ARM_LOGO-2025_INK_RGB.svg" alt="Logo of PSA Certified Crypto Driver Interface"/>
            </a></p><hr />
<h3><a href="../index.html">PSA Certified<br />Crypto Driver Interface</a></h3>
111106<br/>
Non-confidential<br/>
Version 1.0 Alpha (Issue 1)
<hr />
<ul>
<li class="toctree-l1"><a class="reference internal" href="../about/about.html">About this document</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">1 Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">2 Overview of drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="manifest.html">3 Driver description</a></li>
<li class="toctree-l1"><a class="reference internal" href="entry-points.html">4 Driver entry points</a></li>
<li class="toctree-l1"><a class="reference internal" href="transparent.html">5 Transparent drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="opaque.html">6 Opaque drivers</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">7 Using drivers from an application</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#using-transparent-drivers">7.1 Using transparent drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-opaque-drivers">7.2 Using opaque drivers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#lifetimes-and-locations">7.2.1 Lifetimes and locations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-a-key-in-a-secure-element">7.2.2 Creating a key in a secure element</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../appendix/open-issues.html">A Open questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/history.html">B Changes to the API</a></li>
</ul>

<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="watermark docutils container">
<p>Alpha</p>
</div>
<section id="using-drivers-from-an-application">
<h1><span class="section-number">7 </span>Using drivers from an application<a class="headerlink" href="#using-drivers-from-an-application" title="Link to this heading">¶</a></h1>
<section id="using-transparent-drivers">
<h2><span class="section-number">7.1 </span>Using transparent drivers<a class="headerlink" href="#using-transparent-drivers" title="Link to this heading">¶</a></h2>
<p>Transparent drivers linked into the library are automatically used for the mechanisms that they implement.</p>
</section>
<section id="using-opaque-drivers">
<h2><span class="section-number">7.2 </span>Using opaque drivers<a class="headerlink" href="#using-opaque-drivers" title="Link to this heading">¶</a></h2>
<p>Each opaque driver is assigned a <a class="reference internal" href="#lifetimes-and-locations"><span class="std std-ref">location</span></a>.
The driver is invoked for all actions that use a key in that location.
A key’s location is indicated by its lifetime.
The application chooses the key’s lifetime when it creates the key.</p>
<p>For example, the following snippet creates an AES-GCM key which is only accessible inside the secure element designated by the location <code class="docutils literal notranslate"><span class="pre">PSA_KEY_LOCATION_acme</span></code>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>psa_key_attributes_t attributes = PSA_KEY_ATTRIBUTES_INIT;
psa_set_key_lifetime(&amp;attributes, PSA_KEY_LIFETIME_FROM_PERSISTENCE_AND_LOCATION(
        PSA_KEY_PERSISTENCE_DEFAULT, PSA_KEY_LOCATION_acme));
psa_set_key_identifier(&amp;attributes, 42);
psa_set_key_type(&amp;attributes, PSA_KEY_TYPE_AES);
psa_set_key_size(&amp;attributes, 128);
psa_set_key_algorithm(&amp;attributes, PSA_ALG_GCM);
psa_set_key_usage_flags(&amp;attributes, PSA_KEY_USAGE_ENCRYPT | PSA_KEY_USAGE_DECRYPT);
psa_key_id_t key;
psa_generate_key(&amp;attributes, &amp;key);
</pre></div>
</div>
<section id="lifetimes-and-locations">
<span id="id1"></span><h3><span class="section-number">7.2.1 </span>Lifetimes and locations<a class="headerlink" href="#lifetimes-and-locations" title="Link to this heading">¶</a></h3>
<p>The PSA Certified Crypto API defines <a class="reference external" href="https://arm-software.github.io/psa-api/crypto/1.3/api/keys/lifetimes.html#key-lifetimes">lifetimes</a> as an attribute of a key that indicates where the key is stored and which application and system actions will create and destroy it.
The lifetime is expressed as a 32-bit value (<code class="docutils literal notranslate"><span class="pre">typedef</span> <span class="pre">uint32_t</span> <span class="pre">psa_key_lifetime_t</span></code>).
An upcoming version of the Crypto API defines more structure for lifetime values to separate these two aspects of the lifetime:</p>
<ul class="simple">
<li><p>Bits 0-7 are a <em>persistence level</em>.
This value indicates what device management actions can cause it to be destroyed.
In particular, it indicates whether the key is volatile or persistent.</p></li>
<li><p>Bits 8-31 are a <em>location indicator</em>.
This value indicates where the key material is stored and where operations on the key are performed.
Location values can be stored in a variable of type <code class="docutils literal notranslate"><span class="pre">psa_key_location_t</span></code>.</p></li>
</ul>
<p>An opaque driver is attached to a specific location.
Keys in the default location (<code class="docutils literal notranslate"><span class="pre">PSA_KEY_LOCATION_LOCAL_STORAGE</span> <span class="pre">=</span> <span class="pre">0</span></code>) are transparent: the core has direct access to the key material.
For keys in a location that is managed by an opaque driver, only the secure element has access to the key material and can perform operations on the key, while the core only manipulates a wrapped form of the key or an identifier of the key.</p>
</section>
<section id="creating-a-key-in-a-secure-element">
<h3><span class="section-number">7.2.2 </span>Creating a key in a secure element<a class="headerlink" href="#creating-a-key-in-a-secure-element" title="Link to this heading">¶</a></h3>
<p>The core defines a compile-time constant for each opaque driver indicating its location called <code class="docutils literal notranslate"><span class="pre">PSA_KEY_LOCATION_</span></code><em>prefix</em> where <em>prefix</em> is the value of the <code class="docutils literal notranslate"><span class="pre">&quot;prefix&quot;</span></code> property in the driver description.
For convenience, Mbed TLS also declares a compile-time constant for the corresponding lifetime with the default persistence called <code class="docutils literal notranslate"><span class="pre">PSA_KEY_LIFETIME_</span></code><em>prefix</em>.
Therefore, to declare an opaque key in the location with the prefix <code class="docutils literal notranslate"><span class="pre">foo</span></code> with the default persistence, call <code class="docutils literal notranslate"><span class="pre">psa_set_key_lifetime</span></code> during the key creation as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>psa_set_key_lifetime(&amp;attributes, PSA_KEY_LIFETIME_foo);
</pre></div>
</div>
<p>To declare a volatile key:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>psa_set_key_lifetime(&amp;attributes, PSA_KEY_LIFETIME_FROM_PERSISTENCE_AND_LOCATION(
        PSA_KEY_LOCATION_foo,
        PSA_KEY_PERSISTENCE_VOLATILE));
</pre></div>
</div>
<p>Generally speaking, to declare a key with a specified persistence:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>psa_set_key_lifetime(&amp;attributes, PSA_KEY_LIFETIME_FROM_PERSISTENCE_AND_LOCATION(
        PSA_KEY_LOCATION_foo,
        persistence));
</pre></div>
</div>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &#169; 2020-2025 Arm Limited and/or its affiliates.
      
    </div>

    

    
  </body>
</html>