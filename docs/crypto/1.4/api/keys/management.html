<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="9.9 Key management functions" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://arm-software.github.io/psa-api/crypto/1.4/api/keys/management.html" />
<link rel="canonical" href="https://arm-software.github.io/psa-api/crypto/1.4/api/keys/management.html" />
<meta property="og:site_name" content="PSA Certified Crypto API 1.4" />
<meta property="og:description" content="Key creation: New keys can be created in the following ways: psa_import_key() creates a key from a data buffer provided by the application., psa_generate_key() and psa_generate_key_custom() create ..." />
<meta name="description" content="Key creation: New keys can be created in the following ways: psa_import_key() creates a key from a data buffer provided by the application., psa_generate_key() and psa_generate_key_custom() create ..." />

    <title>9.9 Key management functions &#8212; PSA Certified Crypto API 1.4</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=f6a572b4" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=4ae1632d" />
    <link rel="preconnect" type="text/css" href="https://fonts.googleapis.com" />
    <link rel="preconnect" type="text/css" href="https://fonts.gstatic.com" />
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,300;0,400;1,300;1,400&display=swap" />
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Noto+Sans+Mono:ital,wght@0,300;0,400;1,300&display=swap" />
    <script src="../../_static/documentation_options.js?v=8ef9151b"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="10 Cryptographic operation reference" href="../ops/index.html" />
    <link rel="prev" title="9.8 Key policies" href="policy.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/ARM_LOGO-2025_INK_RGB.svg" alt="Logo of PSA Certified Crypto API"/>
            </a></p><hr />
<h3><a href="../../index.html">PSA Certified<br />Crypto API</a></h3>
IHI 0086<br/>
Non-confidential<br/>
Version 1.4.1
<hr />
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../about/about.html">About this document</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../overview/intro.html">1 Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/goals.html">2 Design goals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/functionality.html">3 Functionality overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/sample-arch.html">4 Sample architectures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/conventions.html">5 Library conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/implementation.html">6 Implementation considerations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/usage.html">7 Usage considerations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../library/index.html">8 Library management reference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">9 Key management reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="attributes.html">9.1 Key attributes</a></li>
<li class="toctree-l2"><a class="reference internal" href="types.html">9.2 Key types</a></li>
<li class="toctree-l2"><a class="reference internal" href="types.html#unstructured-key-types">9.3 Unstructured key types</a></li>
<li class="toctree-l2"><a class="reference internal" href="types.html#structured-key-types">9.4 Structured key types</a></li>
<li class="toctree-l2"><a class="reference internal" href="types.html#asymmetric-key-types">9.5 Asymmetric key types</a></li>
<li class="toctree-l2"><a class="reference internal" href="lifetimes.html">9.6 Key lifetimes</a></li>
<li class="toctree-l2"><a class="reference internal" href="ids.html">9.7 Key identifiers</a></li>
<li class="toctree-l2"><a class="reference internal" href="policy.html">9.8 Key policies</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">9.9 Key management functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#key-creation">9.9.1 Key creation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#key-destruction">9.9.2 Key destruction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#key-export">9.9.3 Key export</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ops/index.html">10 Cryptographic operation reference</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../appendix/example_header.html">A Example header file</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendix/encodings.html">B Algorithm and key type encoding</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendix/specdef_values.html">C Example macro implementations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendix/sra.html">D Security Risk Assessment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendix/history.html">E Changes to the API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../atg_c-identifiers.html">Index of API elements</a></li>
</ul>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="key-management-functions">
<h1><span class="section-number">9.9 </span>Key management functions<a class="headerlink" href="#key-management-functions" title="Link to this heading">¶</a></h1>
<section id="key-creation">
<span id="id1"></span><h2><span class="section-number">9.9.1 </span>Key creation<a class="headerlink" href="#key-creation" title="Link to this heading">¶</a></h2>
<p>New keys can be created in the following ways:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#c.psa_import_key" title="psa_import_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_import_key()</span></code></a> creates a key from a data buffer provided by the application.</p></li>
<li><p><a class="reference internal" href="#c.psa_generate_key" title="psa_generate_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_generate_key()</span></code></a> and <a class="reference internal" href="#c.psa_generate_key_custom" title="psa_generate_key_custom"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_generate_key_custom()</span></code></a> create a key from randomly generated data.</p></li>
<li><p><a class="reference internal" href="../ops/key-derivation.html#c.psa_key_derivation_output_key" title="psa_key_derivation_output_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_output_key()</span></code></a> and <a class="reference internal" href="../ops/key-derivation.html#c.psa_key_derivation_output_key_custom" title="psa_key_derivation_output_key_custom"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_output_key_custom()</span></code></a> create a key from data generated by a pseudorandom derivation process. See <a class="reference internal" href="../ops/key-derivation.html#kdf"><span class="secref">Key derivation</span></a>.</p></li>
<li><p><a class="reference internal" href="../ops/key-agreement.html#c.psa_key_agreement" title="psa_key_agreement"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_agreement()</span></code></a> creates a key from the shared secret result of a key-agreement process. See <a class="reference internal" href="../ops/key-agreement.html#key-agreement"><span class="secref">Key agreement</span></a>.</p></li>
<li><p><a class="reference internal" href="../ops/key-encapsulation.html#c.psa_encapsulate" title="psa_encapsulate"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_encapsulate()</span></code></a> and <a class="reference internal" href="../ops/key-encapsulation.html#c.psa_decapsulate" title="psa_decapsulate"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_decapsulate()</span></code></a> create a shared secret key using a key-encapsulation mechanism.</p></li>
<li><p><a class="reference internal" href="../ops/pake.html#c.psa_pake_get_shared_key" title="psa_pake_get_shared_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_pake_get_shared_key()</span></code></a> creates a key from the shared secret result of a password-authenticated key exchange. See <a class="reference internal" href="../ops/pake.html#pake"><span class="secref">Password-authenticated key exchange (PAKE)</span></a>.</p></li>
<li><p><a class="reference internal" href="#c.psa_copy_key" title="psa_copy_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_copy_key()</span></code></a> duplicates an existing key with a different lifetime or with a more restrictive usage policy.</p></li>
<li><p><a class="reference internal" href="#c.psa_attach_key" title="psa_attach_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_attach_key()</span></code></a> registers implementation-provided key material for use as a volatile key.</p></li>
</ul>
<p>When creating a key, the attributes for the new key are specified in a <a class="reference internal" href="attributes.html#c.psa_key_attributes_t" title="psa_key_attributes_t"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_attributes_t</span></code></a> object. Each key creation function defines how it uses the attributes.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The attributes for a key are immutable after the key has been created.</p>
<p>The application must set the key algorithm policy and the appropriate key usage flags in the attributes in order for the key to be used in any cryptographic operations.</p>
</div>
<section id="c.psa_import_key">
<h3><code class="docutils literal notranslate"><span class="pre">psa_import_key</span></code> (function)<a class="headerlink" href="#c.psa_import_key" title="Link to this heading">¶</a></h3>
<p>Import a key in binary format.</p>
<pre class="literal-block">psa_status_t <a class="reference internal" href="#c.psa_import_key" title="psa_import_key">psa_import_key</a>(const <a class="reference internal" href="attributes.html#c.psa_key_attributes_t" title="psa_key_attributes_t">psa_key_attributes_t</a> * attributes,
                            const uint8_t * data,
                            size_t data_length,
                            <a class="reference internal" href="ids.html#c.psa_key_id_t" title="psa_key_id_t">psa_key_id_t</a> * key);</pre>
<p class="rubric">Parameters</p>
<div class="apisubitem docutils container">
<dl>
<dt><p><code class="docutils literal notranslate"><span class="pre">attributes</span></code></p>
</dt><dd><p>The attributes for the new key.</p>
<p>The following attributes are required for all keys:</p>
<ul class="simple">
<li><p>The key type determines how the <code class="docutils literal notranslate"><span class="pre">data</span></code> buffer is interpreted.</p></li>
</ul>
<p>The following attributes must be set for keys used in cryptographic operations:</p>
<ul class="simple">
<li><p>The key permitted-algorithm policy, see <a class="reference internal" href="policy.html#permitted-algorithms"><span class="secref">Permitted algorithms</span></a>.</p></li>
<li><p>The key usage flags, see <a class="reference internal" href="policy.html#key-usage-flags"><span class="secref">Key usage flags</span></a>.</p></li>
</ul>
<p>The following attributes must be set for keys that do not use the default <a class="reference internal" href="lifetimes.html#c.PSA_KEY_LIFETIME_VOLATILE" title="PSA_KEY_LIFETIME_VOLATILE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_LIFETIME_VOLATILE</span></code></a> lifetime:</p>
<ul class="simple">
<li><p>The key lifetime, see <a class="reference internal" href="lifetimes.html#key-lifetimes"><span class="secref">Key lifetimes</span></a>.</p></li>
<li><p>The key identifier is required for a key with a persistent lifetime, see <a class="reference internal" href="ids.html#key-identifiers"><span class="secref">Key identifiers</span></a>.</p></li>
</ul>
<p>The following attributes are optional:</p>
<ul class="simple">
<li><p>If the key size is nonzero, it must be equal to the key size determined from <code class="docutils literal notranslate"><span class="pre">data</span></code>.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is an input parameter: it is not updated with the final key attributes.
The final attributes of the new key can be queried by calling <a class="reference internal" href="attributes.html#c.psa_get_key_attributes" title="psa_get_key_attributes"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_get_key_attributes()</span></code></a> with the key’s identifier.</p>
</div>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">data</span></code></p>
</dt><dd><p>Buffer containing the key data.
The content of this buffer is interpreted according to the type declared in <code class="docutils literal notranslate"><span class="pre">attributes</span></code>.</p>
<p>All implementations must support at least the format described in the <em>Key format</em> section of the chosen key type.
Implementations can support other formats, but be conservative in interpreting the key data: it is recommended that implementations reject content if it might be erroneous, for example, if it is the wrong type or is truncated.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">data_length</span></code></p>
</dt><dd><p>Size of the <code class="docutils literal notranslate"><span class="pre">data</span></code> buffer in bytes.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">key</span></code></p>
</dt><dd><p>On success, an identifier for the newly created key. <a class="reference internal" href="ids.html#c.PSA_KEY_ID_NULL" title="PSA_KEY_ID_NULL"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_ID_NULL</span></code></a> on failure.</p>
</dd>
</dl>
</div>
<p class="rubric">Returns: <code class="docutils literal notranslate"><span class="pre">psa_status_t</span></code></p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_SUCCESS</span></code></p>
</dt><dd><p>Success.
If the key is persistent, the key material and the key’s metadata have been saved to persistent storage.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_BAD_STATE</span></code></p>
</dt><dd><p>The library requires initializing by a call to <a class="reference internal" href="../library/library.html#c.psa_crypto_init" title="psa_crypto_init"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_crypto_init()</span></code></a>.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_NOT_PERMITTED</span></code></p>
</dt><dd><p>The implementation does not permit creating a key with the specified attributes due to some implementation-specific policy.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_ALREADY_EXISTS</span></code></p>
</dt><dd><p>This is an attempt to create a persistent key, and there is already a persistent key with the given identifier.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INVALID_ARGUMENT</span></code></p>
</dt><dd><p>The following conditions can result in this error:</p>
<ul class="simple">
<li><p>The key type is invalid.</p></li>
<li><p>The key size is nonzero, and is incompatible with the key data in <code class="docutils literal notranslate"><span class="pre">data</span></code>.</p></li>
<li><p>The key lifetime is invalid.</p></li>
<li><p>The key identifier is not valid for the key lifetime.</p></li>
<li><p>The key usage flags include invalid values.</p></li>
<li><p>The key’s permitted-usage algorithm is invalid.</p></li>
<li><p>The key attributes, as a whole, are invalid.</p></li>
<li><p>The key data is not correctly formatted for the key type.</p></li>
</ul>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_NOT_SUPPORTED</span></code></p>
</dt><dd><p>The key attributes, as a whole, are not supported, either by the implementation in general or in the specified storage location.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INSUFFICIENT_MEMORY</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INSUFFICIENT_STORAGE</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_COMMUNICATION_FAILURE</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_CORRUPTION_DETECTED</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_STORAGE_FAILURE</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_DATA_CORRUPT</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_DATA_INVALID</span></code></p>
</dt><dd></dd>
</dl>
</div>
<p class="rubric">Description</p>
<p>The key is extracted from the provided <code class="docutils literal notranslate"><span class="pre">data</span></code> buffer. Its location, policy, and type are taken from <code class="docutils literal notranslate"><span class="pre">attributes</span></code>.</p>
<p>The provided key data determines the key size. The attributes can optionally specify a key size; in this case it must match the size determined from the key data. A key size of <code class="docutils literal notranslate"><span class="pre">0</span></code> in <code class="docutils literal notranslate"><span class="pre">attributes</span></code> — the default value — indicates that the key size is solely determined by the key data.</p>
<p>Implementations must reject an attempt to import a key of size <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p>
<p>This function supports any output from <a class="reference internal" href="#c.psa_export_key" title="psa_export_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_export_key()</span></code></a>. Each key type in <a class="reference internal" href="types.html#key-types"><span class="secref">Key types</span></a> describes the expected format of keys.</p>
<p>This specification defines a single format for each key type. Implementations can optionally support other formats in addition to the standard format. It is recommended that implementations that support other formats ensure that the formats are clearly unambiguous, to minimize the risk that an invalid input is accidentally interpreted according to a different format.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The Crypto API does not support asymmetric private-key objects outside of a key pair. To import a private key, the <code class="docutils literal notranslate"><span class="pre">attributes</span></code> must specify the corresponding key-pair type. Depending on the key type, either the import format contains the public-key data or the implementation will reconstruct the public key from the private key as needed.</p>
</div>
</section>
<section id="c.psa_custom_key_parameters_t">
<h3><code class="docutils literal notranslate"><span class="pre">psa_custom_key_parameters_t</span></code> (struct)<a class="headerlink" href="#c.psa_custom_key_parameters_t" title="Link to this heading">¶</a></h3>
<p>Custom production parameters for key generation or key derivation.</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 1.3.</span></p>
</div>
<pre class="literal-block">typedef struct <a class="reference internal" href="#c.psa_custom_key_parameters_t" title="psa_custom_key_parameters_t">psa_custom_key_parameters_t</a> {
    uint32_t flags;
} <a class="reference internal" href="#c.psa_custom_key_parameters_t" title="psa_custom_key_parameters_t">psa_custom_key_parameters_t</a>;</pre>
<p class="rubric">Fields</p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">flags</span></code></p>
</dt><dd><p>Flags to control the key production process.
<code class="docutils literal notranslate"><span class="pre">0</span></code> for the default production parameters.</p>
</dd>
</dl>
</div>
<p class="rubric">Description</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Future versions of the specification, and implementations, may add other fields in this structure.</p>
</div>
<p>The interpretation of this structure depends on the type of the key. <span><a class="reference internal" href="#tab-custom-key-parameters"><span class="numref">Table 13</span></a></span> shows the custom production parameters for each type of key. See the key type definitions for details of the valid parameter values.</p>
<table class="docutils align-default" id="tab-custom-key-parameters">
<caption><span class="caption-number">Table 13 </span><span class="caption-text">Custom key parameters</span><a class="headerlink" href="#tab-custom-key-parameters" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 20.0%" />
<col style="width: 80.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Key type</p></th>
<th class="head"><p>Custom key parameters</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>RSA</p></td>
<td><p>Use the production parameters to select an exponent value that is different from the default value of <code class="docutils literal notranslate"><span class="pre">65537</span></code>.</p>
<p>See <a class="reference internal" href="types.html#c.PSA_KEY_TYPE_RSA_KEY_PAIR" title="PSA_KEY_TYPE_RSA_KEY_PAIR"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_RSA_KEY_PAIR</span></code></a>.</p>
</td>
</tr>
<tr class="row-odd"><td><p>Other key types</p></td>
<td><p>Reserved for future use.</p>
<p><code class="docutils literal notranslate"><span class="pre">flags</span></code> must be <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p>
</td>
</tr>
</tbody>
</table>
</section>
<section id="c.PSA_CUSTOM_KEY_PARAMETERS_INIT">
<h3><code class="docutils literal notranslate"><span class="pre">PSA_CUSTOM_KEY_PARAMETERS_INIT</span></code> (macro)<a class="headerlink" href="#c.PSA_CUSTOM_KEY_PARAMETERS_INIT" title="Link to this heading">¶</a></h3>
<p>The default production parameters for key generation or key derivation.</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 1.3.</span></p>
</div>
<pre class="literal-block">#define <a class="reference internal" href="#c.PSA_CUSTOM_KEY_PARAMETERS_INIT" title="PSA_CUSTOM_KEY_PARAMETERS_INIT">PSA_CUSTOM_KEY_PARAMETERS_INIT</a> { 0 }</pre>
<p>Calling <a class="reference internal" href="#c.psa_generate_key_custom" title="psa_generate_key_custom"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_generate_key_custom()</span></code></a> or <a class="reference internal" href="../ops/key-derivation.html#c.psa_key_derivation_output_key_custom" title="psa_key_derivation_output_key_custom"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_output_key_custom()</span></code></a> with <code class="docutils literal notranslate"><span class="pre">custom</span></code><code class="docutils literal notranslate"> <span class="pre">==</span> </code><a class="reference internal" href="#c.PSA_CUSTOM_KEY_PARAMETERS_INIT" title="PSA_CUSTOM_KEY_PARAMETERS_INIT"><code class="docutils literal notranslate"><span class="pre">PSA_CUSTOM_KEY_PARAMETERS_INIT</span></code></a> and <code class="docutils literal notranslate"><span class="pre">custom_data_length</span> <span class="pre">==</span> <span class="pre">0</span></code> is equivalent to calling <a class="reference internal" href="#c.psa_generate_key" title="psa_generate_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_generate_key()</span></code></a> or <a class="reference internal" href="../ops/key-derivation.html#c.psa_key_derivation_output_key" title="psa_key_derivation_output_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_output_key()</span></code></a>
respectively.</p>
</section>
<section id="c.psa_generate_key">
<h3><code class="docutils literal notranslate"><span class="pre">psa_generate_key</span></code> (function)<a class="headerlink" href="#c.psa_generate_key" title="Link to this heading">¶</a></h3>
<p>Generate a key or key pair.</p>
<pre class="literal-block">psa_status_t <a class="reference internal" href="#c.psa_generate_key" title="psa_generate_key">psa_generate_key</a>(const <a class="reference internal" href="attributes.html#c.psa_key_attributes_t" title="psa_key_attributes_t">psa_key_attributes_t</a> * attributes,
                              <a class="reference internal" href="ids.html#c.psa_key_id_t" title="psa_key_id_t">psa_key_id_t</a> * key);</pre>
<p class="rubric">Parameters</p>
<div class="apisubitem docutils container">
<dl>
<dt><p><code class="docutils literal notranslate"><span class="pre">attributes</span></code></p>
</dt><dd><p>The attributes for the new key.</p>
<p>The following attributes are required for all keys:</p>
<ul class="simple">
<li><p>The key type. It must not be an asymmetric public key.</p></li>
<li><p>The key size. It must be a valid size for the key type.</p></li>
</ul>
<p>The following attributes must be set for keys used in cryptographic operations:</p>
<ul class="simple">
<li><p>The key permitted-algorithm policy, see <a class="reference internal" href="policy.html#permitted-algorithms"><span class="secref">Permitted algorithms</span></a>.</p></li>
<li><p>The key usage flags, see <a class="reference internal" href="policy.html#key-usage-flags"><span class="secref">Key usage flags</span></a>.</p></li>
</ul>
<p>The following attributes must be set for keys that do not use the default <a class="reference internal" href="lifetimes.html#c.PSA_KEY_LIFETIME_VOLATILE" title="PSA_KEY_LIFETIME_VOLATILE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_LIFETIME_VOLATILE</span></code></a> lifetime:</p>
<ul class="simple">
<li><p>The key lifetime, see <a class="reference internal" href="lifetimes.html#key-lifetimes"><span class="secref">Key lifetimes</span></a>.</p></li>
<li><p>The key identifier is required for a key with a persistent lifetime, see <a class="reference internal" href="ids.html#key-identifiers"><span class="secref">Key identifiers</span></a>.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is an input parameter: it is not updated with the final key attributes.
The final attributes of the new key can be queried by calling <a class="reference internal" href="attributes.html#c.psa_get_key_attributes" title="psa_get_key_attributes"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_get_key_attributes()</span></code></a> with the key’s identifier.</p>
</div>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">key</span></code></p>
</dt><dd><p>On success, an identifier for the newly created key.
For persistent keys, this is the key identifier defined in <code class="docutils literal notranslate"><span class="pre">attributes</span></code>.
<a class="reference internal" href="ids.html#c.PSA_KEY_ID_NULL" title="PSA_KEY_ID_NULL"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_ID_NULL</span></code></a> on failure.</p>
</dd>
</dl>
</div>
<p class="rubric">Returns: <code class="docutils literal notranslate"><span class="pre">psa_status_t</span></code></p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_SUCCESS</span></code></p>
</dt><dd><p>Success.
If the key is persistent, the key material and the key’s metadata have been saved to persistent storage.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_BAD_STATE</span></code></p>
</dt><dd><p>The library requires initializing by a call to <a class="reference internal" href="../library/library.html#c.psa_crypto_init" title="psa_crypto_init"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_crypto_init()</span></code></a>.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_NOT_PERMITTED</span></code></p>
</dt><dd><p>The implementation does not permit creating a key with the specified attributes due to some implementation-specific policy.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_ALREADY_EXISTS</span></code></p>
</dt><dd><p>This is an attempt to create a persistent key, and there is already a persistent key with the given identifier.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INVALID_ARGUMENT</span></code></p>
</dt><dd><p>The following conditions can result in this error:</p>
<ul class="simple">
<li><p>The key type is invalid, or is an asymmetric public-key type.</p></li>
<li><p>The key size is not valid for the key type.</p></li>
<li><p>The key lifetime is invalid.</p></li>
<li><p>The key identifier is not valid for the key lifetime.</p></li>
<li><p>The key usage flags include invalid values.</p></li>
<li><p>The key’s permitted-usage algorithm is invalid.</p></li>
<li><p>The key attributes, as a whole, are invalid.</p></li>
</ul>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_NOT_SUPPORTED</span></code></p>
</dt><dd><p>The key attributes, as a whole, are not supported, either by the implementation in general or in the specified storage location.</p>
</dd>
<dt><p><a class="reference internal" href="../library/status.html#c.PSA_ERROR_INSUFFICIENT_ENTROPY" title="PSA_ERROR_INSUFFICIENT_ENTROPY"><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INSUFFICIENT_ENTROPY</span></code></a></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INSUFFICIENT_MEMORY</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INSUFFICIENT_STORAGE</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_COMMUNICATION_FAILURE</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_CORRUPTION_DETECTED</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_STORAGE_FAILURE</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_DATA_CORRUPT</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_DATA_INVALID</span></code></p>
</dt><dd></dd>
</dl>
</div>
<p class="rubric">Description</p>
<p>The key is generated randomly. Its location, policy, type and size are taken from <code class="docutils literal notranslate"><span class="pre">attributes</span></code>.</p>
<p>Implementations must reject an attempt to generate a key of size <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p>
<p>The key type definitions in <a class="reference internal" href="types.html#key-types"><span class="secref">Key types</span></a> provide specific details relating to generation of the key.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This function is equivalent to calling <a class="reference internal" href="#c.psa_generate_key_custom" title="psa_generate_key_custom"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_generate_key_custom()</span></code></a> with the production parameters <a class="reference internal" href="#c.PSA_CUSTOM_KEY_PARAMETERS_INIT" title="PSA_CUSTOM_KEY_PARAMETERS_INIT"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_CUSTOM_KEY_PARAMETERS_INIT</span></code></a> and <code class="docutils literal notranslate"><span class="pre">custom_data_length</span> <span class="pre">==</span> <span class="pre">0</span></code> (<code class="docutils literal notranslate"><span class="pre">custom_data</span></code> is ignored).</p>
</div>
</section>
<section id="c.psa_generate_key_custom">
<h3><code class="docutils literal notranslate"><span class="pre">psa_generate_key_custom</span></code> (function)<a class="headerlink" href="#c.psa_generate_key_custom" title="Link to this heading">¶</a></h3>
<p>Generate a key or key pair using custom production parameters.</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 1.3.</span></p>
</div>
<pre class="literal-block">psa_status_t <a class="reference internal" href="#c.psa_generate_key_custom" title="psa_generate_key_custom">psa_generate_key_custom</a>(const <a class="reference internal" href="attributes.html#c.psa_key_attributes_t" title="psa_key_attributes_t">psa_key_attributes_t</a> * attributes,
                                     const <a class="reference internal" href="#c.psa_custom_key_parameters_t" title="psa_custom_key_parameters_t">psa_custom_key_parameters_t</a> * custom,
                                     const uint8_t * custom_data,
                                     size_t custom_data_length,
                                     <a class="reference internal" href="ids.html#c.psa_key_id_t" title="psa_key_id_t">psa_key_id_t</a> * key);</pre>
<p class="rubric">Parameters</p>
<div class="apisubitem docutils container">
<dl>
<dt><p><code class="docutils literal notranslate"><span class="pre">attributes</span></code></p>
</dt><dd><p>The attributes for the new key.</p>
<p>The following attributes are required for all keys:</p>
<ul class="simple">
<li><p>The key type. It must not be an asymmetric public key.</p></li>
<li><p>The key size. It must be a valid size for the key type.</p></li>
</ul>
<p>The following attributes must be set for keys used in cryptographic operations:</p>
<ul class="simple">
<li><p>The key permitted-algorithm policy, see <a class="reference internal" href="policy.html#permitted-algorithms"><span class="secref">Permitted algorithms</span></a>.</p></li>
<li><p>The key usage flags, see <a class="reference internal" href="policy.html#key-usage-flags"><span class="secref">Key usage flags</span></a>.</p></li>
</ul>
<p>The following attributes must be set for keys that do not use the default <a class="reference internal" href="lifetimes.html#c.PSA_KEY_LIFETIME_VOLATILE" title="PSA_KEY_LIFETIME_VOLATILE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_LIFETIME_VOLATILE</span></code></a> lifetime:</p>
<ul class="simple">
<li><p>The key lifetime, see <a class="reference internal" href="lifetimes.html#key-lifetimes"><span class="secref">Key lifetimes</span></a>.</p></li>
<li><p>The key identifier is required for a key with a persistent lifetime, see <a class="reference internal" href="ids.html#key-identifiers"><span class="secref">Key identifiers</span></a>.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is an input parameter: it is not updated with the final key attributes.
The final attributes of the new key can be queried by calling <a class="reference internal" href="attributes.html#c.psa_get_key_attributes" title="psa_get_key_attributes"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_get_key_attributes()</span></code></a> with the key’s identifier.</p>
</div>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">custom</span></code></p>
</dt><dd><p>Customized production parameters for the key generation.</p>
<p>When this is <a class="reference internal" href="#c.PSA_CUSTOM_KEY_PARAMETERS_INIT" title="PSA_CUSTOM_KEY_PARAMETERS_INIT"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_CUSTOM_KEY_PARAMETERS_INIT</span></code></a> with <code class="docutils literal notranslate"><span class="pre">custom_data_length</span> <span class="pre">==</span> <span class="pre">0</span></code>, this function is equivalent to <a class="reference internal" href="#c.psa_generate_key" title="psa_generate_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_generate_key()</span></code></a>.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">custom_data</span></code></p>
</dt><dd><p>A buffer containing additional variable-sized production parameters.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">custom_data_length</span></code></p>
</dt><dd><p>Length of <code class="docutils literal notranslate"><span class="pre">custom_data</span></code> in bytes.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">key</span></code></p>
</dt><dd><p>On success, an identifier for the newly created key.
For persistent keys, this is the key identifier defined in <code class="docutils literal notranslate"><span class="pre">attributes</span></code>.
<a class="reference internal" href="ids.html#c.PSA_KEY_ID_NULL" title="PSA_KEY_ID_NULL"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_ID_NULL</span></code></a> on failure.</p>
</dd>
</dl>
</div>
<p class="rubric">Returns: <code class="docutils literal notranslate"><span class="pre">psa_status_t</span></code></p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_SUCCESS</span></code></p>
</dt><dd><p>Success.
If the key is persistent, the key material and the key’s metadata have been saved to persistent storage.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_BAD_STATE</span></code></p>
</dt><dd><p>The library requires initializing by a call to <a class="reference internal" href="../library/library.html#c.psa_crypto_init" title="psa_crypto_init"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_crypto_init()</span></code></a>.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_NOT_PERMITTED</span></code></p>
</dt><dd><p>The implementation does not permit creating a key with the specified attributes due to some implementation-specific policy.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_ALREADY_EXISTS</span></code></p>
</dt><dd><p>This is an attempt to create a persistent key, and there is already a persistent key with the given identifier.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INVALID_ARGUMENT</span></code></p>
</dt><dd><p>The following conditions can result in this error:</p>
<ul class="simple">
<li><p>The key type is invalid, or is an asymmetric public-key type.</p></li>
<li><p>The key size is not valid for the key type.</p></li>
<li><p>The key lifetime is invalid.</p></li>
<li><p>The key identifier is not valid for the key lifetime.</p></li>
<li><p>The key usage flags include invalid values.</p></li>
<li><p>The key’s permitted-usage algorithm is invalid.</p></li>
<li><p>The key attributes, as a whole, are invalid.</p></li>
<li><p>The production parameters are invalid.</p></li>
</ul>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_NOT_SUPPORTED</span></code></p>
</dt><dd><p>The following conditions can result in this error:</p>
<ul class="simple">
<li><p>The key attributes, as a whole, are not supported, either by the implementation in general or in the specified storage location.</p></li>
<li><p>The production parameters are not supported by the implementation.</p></li>
</ul>
</dd>
<dt><p><a class="reference internal" href="../library/status.html#c.PSA_ERROR_INSUFFICIENT_ENTROPY" title="PSA_ERROR_INSUFFICIENT_ENTROPY"><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INSUFFICIENT_ENTROPY</span></code></a></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INSUFFICIENT_MEMORY</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INSUFFICIENT_STORAGE</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_COMMUNICATION_FAILURE</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_CORRUPTION_DETECTED</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_STORAGE_FAILURE</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_DATA_CORRUPT</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_DATA_INVALID</span></code></p>
</dt><dd></dd>
</dl>
</div>
<p class="rubric">Description</p>
<p>Use this function to provide explicit production parameters when generating a key.
See the description of <a class="reference internal" href="#c.psa_generate_key" title="psa_generate_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_generate_key()</span></code></a> for the operation of this function with the default production parameters.</p>
<p>The key is generated randomly. Its location, policy, type and size are taken from <code class="docutils literal notranslate"><span class="pre">attributes</span></code>.</p>
<p>Implementations must reject an attempt to generate a key of size <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p>
<p>See the documentation of <a class="reference internal" href="#c.psa_custom_key_parameters_t" title="psa_custom_key_parameters_t"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_custom_key_parameters_t</span></code></a> for a list of non-default production parameters. See the key type definitions in <a class="reference internal" href="types.html#key-types"><span class="secref">Key types</span></a> for details of the custom production parameters used for key generation.</p>
</section>
<section id="c.psa_copy_key">
<h3><code class="docutils literal notranslate"><span class="pre">psa_copy_key</span></code> (function)<a class="headerlink" href="#c.psa_copy_key" title="Link to this heading">¶</a></h3>
<p>Make a copy of a key.</p>
<pre class="literal-block">psa_status_t <a class="reference internal" href="#c.psa_copy_key" title="psa_copy_key">psa_copy_key</a>(<a class="reference internal" href="ids.html#c.psa_key_id_t" title="psa_key_id_t">psa_key_id_t</a> source_key,
                          const <a class="reference internal" href="attributes.html#c.psa_key_attributes_t" title="psa_key_attributes_t">psa_key_attributes_t</a> * attributes,
                          <a class="reference internal" href="ids.html#c.psa_key_id_t" title="psa_key_id_t">psa_key_id_t</a> * target_key);</pre>
<p class="rubric">Parameters</p>
<div class="apisubitem docutils container">
<dl>
<dt><p><code class="docutils literal notranslate"><span class="pre">source_key</span></code></p>
</dt><dd><p>The key to copy.
It must permit the usage <a class="reference internal" href="policy.html#c.PSA_KEY_USAGE_COPY" title="PSA_KEY_USAGE_COPY"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_USAGE_COPY</span></code></a>.
If a private or secret key is being copied outside of a secure element it must also permit <a class="reference internal" href="policy.html#c.PSA_KEY_USAGE_EXPORT" title="PSA_KEY_USAGE_EXPORT"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_USAGE_EXPORT</span></code></a>.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">attributes</span></code></p>
</dt><dd><p>The attributes for the new key.</p>
<p>The following attributes must be set for keys used in cryptographic operations:</p>
<ul class="simple">
<li><p>The key permitted-algorithm policy, see <a class="reference internal" href="policy.html#permitted-algorithms"><span class="secref">Permitted algorithms</span></a>.</p></li>
<li><p>The key usage flags, see <a class="reference internal" href="policy.html#key-usage-flags"><span class="secref">Key usage flags</span></a>.</p></li>
</ul>
<p>These flags are combined with the source key policy so that both sets of restrictions apply, as described in the documentation of this function.</p>
<p>The following attributes must be set for keys that do not use the default <a class="reference internal" href="lifetimes.html#c.PSA_KEY_LIFETIME_VOLATILE" title="PSA_KEY_LIFETIME_VOLATILE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_LIFETIME_VOLATILE</span></code></a> lifetime:</p>
<ul class="simple">
<li><p>The key lifetime, see <a class="reference internal" href="lifetimes.html#key-lifetimes"><span class="secref">Key lifetimes</span></a>.</p></li>
<li><p>The key identifier is required for a key with a persistent lifetime, see <a class="reference internal" href="ids.html#key-identifiers"><span class="secref">Key identifiers</span></a>.</p></li>
</ul>
<p>The following attributes are optional:</p>
<ul class="simple">
<li><p>If the key type has a non-default value, it must be equal to the source key type.</p></li>
<li><p>If the key size is nonzero, it must be equal to the source key size.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is an input parameter: it is not updated with the final key attributes.
The final attributes of the new key can be queried by calling <a class="reference internal" href="attributes.html#c.psa_get_key_attributes" title="psa_get_key_attributes"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_get_key_attributes()</span></code></a> with the key’s identifier.</p>
</div>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">target_key</span></code></p>
</dt><dd><p>On success, an identifier for the newly created key. <a class="reference internal" href="ids.html#c.PSA_KEY_ID_NULL" title="PSA_KEY_ID_NULL"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_ID_NULL</span></code></a> on failure.</p>
</dd>
</dl>
</div>
<p class="rubric">Returns: <code class="docutils literal notranslate"><span class="pre">psa_status_t</span></code></p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_SUCCESS</span></code></p>
</dt><dd><p>Success.
If the new key is persistent, the key material and the key’s metadata have been saved to persistent storage.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_BAD_STATE</span></code></p>
</dt><dd><p>The library requires initializing by a call to <a class="reference internal" href="../library/library.html#c.psa_crypto_init" title="psa_crypto_init"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_crypto_init()</span></code></a>.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INVALID_HANDLE</span></code></p>
</dt><dd><p><code class="docutils literal notranslate"><span class="pre">source_key</span></code> is not a valid key identifier.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_NOT_PERMITTED</span></code></p>
</dt><dd><p>The following conditions can result in this error:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">source_key</span></code> does not have the <a class="reference internal" href="policy.html#c.PSA_KEY_USAGE_COPY" title="PSA_KEY_USAGE_COPY"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_USAGE_COPY</span></code></a> usage flag.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">source_key</span></code> does not have the <a class="reference internal" href="policy.html#c.PSA_KEY_USAGE_EXPORT" title="PSA_KEY_USAGE_EXPORT"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_USAGE_EXPORT</span></code></a> usage flag, and the location of <code class="docutils literal notranslate"><span class="pre">target_key</span></code> is outside the security boundary of the <code class="docutils literal notranslate"><span class="pre">source_key</span></code> storage location.</p></li>
<li><p>The implementation does not permit creating a key with the specified attributes due to some implementation-specific policy.</p></li>
</ul>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_ALREADY_EXISTS</span></code></p>
</dt><dd><p>This is an attempt to create a persistent key, and there is already a persistent key with the given identifier.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INVALID_ARGUMENT</span></code></p>
</dt><dd><p>The following conditions can result in this error:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">attributes</span></code> specifies a key type or key size which does not match the attributes of <code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">key</span></code>.</p></li>
<li><p>The lifetime or identifier in <code class="docutils literal notranslate"><span class="pre">attributes</span></code> are invalid.</p></li>
<li><p>The key policies from <code class="docutils literal notranslate"><span class="pre">source_key</span></code> and those specified in <code class="docutils literal notranslate"><span class="pre">attributes</span></code> are incompatible.</p></li>
</ul>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_NOT_SUPPORTED</span></code></p>
</dt><dd><p>The following conditions can result in this error:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">key</span></code> storage location does not support copying to the target key’s storage location.</p></li>
<li><p>The key attributes, as a whole, are not supported in the target key’s storage location.</p></li>
</ul>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INSUFFICIENT_MEMORY</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INSUFFICIENT_STORAGE</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_COMMUNICATION_FAILURE</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_CORRUPTION_DETECTED</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_STORAGE_FAILURE</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_DATA_CORRUPT</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_DATA_INVALID</span></code></p>
</dt><dd></dd>
</dl>
</div>
<p class="rubric">Description</p>
<p>Copy key material from one location to another. Its location is taken from <code class="docutils literal notranslate"><span class="pre">attributes</span></code>, its policy is the intersection of the policy in <code class="docutils literal notranslate"><span class="pre">attributes</span></code> and the source key policy, and its type and size are taken from the source key.</p>
<p>This function is primarily useful to copy a key from one location to another, as it populates a key using the material from another key which can have a different lifetime.</p>
<p>This function can be used to share a key with a different party, subject to implementation-defined restrictions on key sharing.</p>
<p>The policy on the source key must have the usage flag <a class="reference internal" href="policy.html#c.PSA_KEY_USAGE_COPY" title="PSA_KEY_USAGE_COPY"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_USAGE_COPY</span></code></a> set. This flag is sufficient to permit the copy if the key has the lifetime <a class="reference internal" href="lifetimes.html#c.PSA_KEY_LIFETIME_VOLATILE" title="PSA_KEY_LIFETIME_VOLATILE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_LIFETIME_VOLATILE</span></code></a> or <a class="reference internal" href="lifetimes.html#c.PSA_KEY_LIFETIME_PERSISTENT" title="PSA_KEY_LIFETIME_PERSISTENT"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_LIFETIME_PERSISTENT</span></code></a>. Some secure elements do not provide a way to copy a key without making it extractable from the secure element. If a key is located in such a secure element, then the key must have both usage flags <a class="reference internal" href="policy.html#c.PSA_KEY_USAGE_COPY" title="PSA_KEY_USAGE_COPY"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_USAGE_COPY</span></code></a> and <a class="reference internal" href="policy.html#c.PSA_KEY_USAGE_EXPORT" title="PSA_KEY_USAGE_EXPORT"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_USAGE_EXPORT</span></code></a> in order to make a copy of the key outside the secure element.</p>
<p>The resulting key can only be used in a way that conforms to both the policy of the original key and the policy specified in the <code class="docutils literal notranslate"><span class="pre">attributes</span></code> parameter:</p>
<ul class="simple">
<li><p>The usage flags on the resulting key are the bitwise-and of the usage flags on the source policy and the usage flags in <code class="docutils literal notranslate"><span class="pre">attributes</span></code>.</p></li>
<li><p>If both permit the same algorithm or wildcard-based algorithm, the resulting key has the same permitted algorithm.</p></li>
<li><p>If either of the policies permits an algorithm and the other policy permits a wildcard-based permitted algorithm that includes this algorithm, the resulting key uses this permitted algorithm.</p></li>
<li><p>If the policies do not permit any algorithm in common, this function fails with the status <code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INVALID_ARGUMENT</span></code>.</p></li>
</ul>
<p>As a result, the new key cannot be used for operations that were not permitted on the source key.</p>
<p>The effect of this function on implementation-defined attributes is implementation-defined.</p>
</section>
<section id="c.psa_attach_key">
<h3><code class="docutils literal notranslate"><span class="pre">psa_attach_key</span></code> (function)<a class="headerlink" href="#c.psa_attach_key" title="Link to this heading">¶</a></h3>
<p>Register implementation-provided key material with a volatile key identifier and key policy.</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 1.4.</span></p>
</div>
<pre class="literal-block">psa_status_t <a class="reference internal" href="#c.psa_attach_key" title="psa_attach_key">psa_attach_key</a>(const <a class="reference internal" href="attributes.html#c.psa_key_attributes_t" title="psa_key_attributes_t">psa_key_attributes_t</a> * attributes,
                            const uint8_t * label,
                            size_t label_length,
                            <a class="reference internal" href="ids.html#c.psa_key_id_t" title="psa_key_id_t">psa_key_id_t</a> * key);</pre>
<p class="rubric">Parameters</p>
<div class="apisubitem docutils container">
<dl>
<dt><p><code class="docutils literal notranslate"><span class="pre">attributes</span></code></p>
</dt><dd><p>The attributes for the key to be registered.</p>
<p>Some of the attributes can be provided by the implementation.
It is <a class="reference internal" href="../../about/about.html#term-implementation-defined"><span class="scterm">implementation defined</span></a>, and possibly key-specific, which attributes are provided by the implementation and which must be supplied by the application.</p>
<p>The following attributes must always be provided by the application:</p>
<ul class="simple">
<li><p>The key lifetime must specify a volatile key, and the storage location of the implementation-provided key.
See <a class="reference internal" href="lifetimes.html#key-lifetimes"><span class="secref">Key lifetimes</span></a>.</p></li>
</ul>
<p>The following attributes must be provided by either the application or the implementation. If provided by both, they must be identical:</p>
<ul class="simple">
<li><p>The key type.</p></li>
<li><p>The key size.</p></li>
</ul>
<p>The following attributes must be set for keys used in cryptographic operations:</p>
<ul class="simple">
<li><p>The key permitted-algorithm policy, see <a class="reference internal" href="policy.html#permitted-algorithms"><span class="secref">Permitted algorithms</span></a>.</p></li>
<li><p>The key usage flags, see <a class="reference internal" href="policy.html#key-usage-flags"><span class="secref">Key usage flags</span></a>.</p></li>
</ul>
<p>These attributes are combined with any policy that is provided by the implementation, so that both sets of restrictions apply.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">label</span></code></p>
</dt><dd><p>Buffer containing a label that identifies the implementation-provided key to be registered.</p>
<p>The contents of this label are interpreted by the implementation and may correspond to a pre-provisioned, securely stored, or deterministically derived key within the location specified in <code class="docutils literal notranslate"><span class="pre">attributes</span></code>.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">label_length</span></code></p>
</dt><dd><p>Size of the <code class="docutils literal notranslate"><span class="pre">label</span></code> buffer in bytes.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">key</span></code></p>
</dt><dd><p>On success, an identifier for the newly created key.
<a class="reference internal" href="ids.html#c.PSA_KEY_ID_NULL" title="PSA_KEY_ID_NULL"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_ID_NULL</span></code></a> on failure.</p>
</dd>
</dl>
</div>
<p class="rubric">Returns: <code class="docutils literal notranslate"><span class="pre">psa_status_t</span></code></p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_SUCCESS</span></code></p>
</dt><dd><p>Success.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_BAD_STATE</span></code></p>
</dt><dd><p>The library requires initializing by a call to <a class="reference internal" href="../library/library.html#c.psa_crypto_init" title="psa_crypto_init"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_crypto_init()</span></code></a>.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_NOT_PERMITTED</span></code></p>
</dt><dd><p>The implementation does not permit creating a key with the specified attributes due to some implementation-specific policy.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INVALID_ARGUMENT</span></code></p>
</dt><dd><p>The following conditions can result in this error:</p>
<ul class="simple">
<li><p>The key type is invalid.</p></li>
<li><p>The key size is nonzero, and is incompatible with the implementation-provided key.</p></li>
<li><p>The key lifetime specifies a non-volatile persistence level.</p></li>
<li><p>The key lifetime specifies an invalid storage location.</p></li>
<li><p>The key usage flags include invalid values.</p></li>
<li><p>The key’s permitted-usage algorithm is invalid.</p></li>
<li><p>The key attributes, as a whole, are invalid.</p></li>
<li><p>The implementation-provided key material is incompatible with the provided key attributes.</p></li>
</ul>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_NOT_SUPPORTED</span></code></p>
</dt><dd><p>The key attributes, as a whole, are not supported, either by the implementation in general or in the specified storage location.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INSUFFICIENT_MEMORY</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_COMMUNICATION_FAILURE</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_CORRUPTION_DETECTED</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_STORAGE_FAILURE</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_DATA_CORRUPT</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_DATA_INVALID</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_DOES_NOT_EXIST</span></code></p>
</dt><dd><p><code class="docutils literal notranslate"><span class="pre">label</span></code> does not refer to key material within the location specified in <code class="docutils literal notranslate"><span class="pre">attributes</span></code>.</p>
</dd>
</dl>
</div>
<p class="rubric">Description</p>
<p>This function allows applications to register implementation-provided key material.
The key material can come from different sources, for example:</p>
<ul class="simple">
<li><p>Keys that are provisioned outside the Crypto API, such as during manufacturing or by a secure element.</p></li>
<li><p>Keys that are deterministically derived from a secret within the implementation.</p></li>
</ul>
<p>After registering the key, the application has a volatile key identifier that can be used in cryptographic operations permitted by its usage flags and algorithm policy.</p>
<p>The key material is identified by its location, specified in the provided attributes <code class="docutils literal notranslate"><span class="pre">lifetime</span></code> value, and the <code class="docutils literal notranslate"><span class="pre">label</span></code> parameter.
The format of the label is specific to the implementation and storage location.
Typically, the label is used as a location-specific identifier for the key material, or can provide input for deriving the key material from an internal secret.</p>
<p>This function can only be used to create a volatile key.
That is, a key with a lifetime persistence level of <a class="reference internal" href="lifetimes.html#c.PSA_KEY_PERSISTENCE_VOLATILE" title="PSA_KEY_PERSISTENCE_VOLATILE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_PERSISTENCE_VOLATILE</span></code></a>.</p>
<p>Depending on the key being registered, the implementation can provide some or all of the key type, size, and policy.
For example:</p>
<ul class="simple">
<li><p>Provisioned key material has a fixed size.
The implementation might permit the application to define the key type and policy, as long as these are compatible with the key material.</p></li>
<li><p>An implementation-specific derived key can require the application to provide a key type and size, using these in the derivation process.</p></li>
<li><p>An implementation-provided key can be fully defined by the implementation, with a fixed type, size, and policy.
The call to <a class="reference internal" href="#c.psa_attach_key" title="psa_attach_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_attach_key()</span></code></a> needs to specify the location and label of the key, and a matching policy, in order to obtain a key id.</p></li>
</ul>
<p>Calling <a class="reference internal" href="#c.psa_destroy_key" title="psa_destroy_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_destroy_key()</span></code></a> with a key identifier returned by <a class="reference internal" href="#c.psa_attach_key" title="psa_attach_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_attach_key()</span></code></a> will remove the key identifier and policy from the key store, but any implementation-provided key material remains within the implementation.
A subsequent call to <a class="reference internal" href="#c.psa_attach_key" title="psa_attach_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_attach_key()</span></code></a> with the same parameters will return a new key identifier for the same key.</p>
<p>It is <a class="reference internal" href="../../about/about.html#term-implementation-defined"><span class="scterm">implementation defined</span></a> whether the same implementation-provided key can be attached to multiple key identifiers concurrently.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This function is intended for scenarios where key material is provided outside the Crypto API, and the application needs to use such keys within the Crypto API framework.</p>
<p>The function only allows registering key material that is provided by the implementation.
To import new key material, use <a class="reference internal" href="#c.psa_import_key" title="psa_import_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_import_key()</span></code></a>.</p>
<p>Although the implementation verifies that the application-supplied attributes are compatible with the implementation-provided key; it is the application’s responsibility to ensure correctness for attributes that are provided by the implementation.</p>
<p>To create a persistent key from pre-existing key material, the implementation might permit a key returned by <a class="reference internal" href="#c.psa_attach_key" title="psa_attach_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_attach_key()</span></code></a> to be copied to a persistent key using <a class="reference internal" href="#c.psa_copy_key" title="psa_copy_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_copy_key()</span></code></a>.</p>
</div>
<div class="admonition-implementation-note admonition">
<p class="admonition-title">Implementation note</p>
<p>Implementations may impose restrictions on which keys can be registered, depending on their storage architecture and security policies.</p>
<p>The behavior of a call <a class="reference internal" href="#c.psa_attach_key" title="psa_attach_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_attach_key()</span></code></a> with a persistent key-lifetime might be specified in a future version of the Crypto API.
At present, it is recommended that such a call returns <code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INVALID_ARGUMENT</span></code>, and does not provide implementation-specific behavior.</p>
</div>
</section>
</section>
<section id="key-destruction">
<span id="id2"></span><h2><span class="section-number">9.9.2 </span>Key destruction<a class="headerlink" href="#key-destruction" title="Link to this heading">¶</a></h2>
<section id="c.psa_destroy_key">
<h3><code class="docutils literal notranslate"><span class="pre">psa_destroy_key</span></code> (function)<a class="headerlink" href="#c.psa_destroy_key" title="Link to this heading">¶</a></h3>
<p>Destroy or unregister a key.</p>
<pre class="literal-block">psa_status_t <a class="reference internal" href="#c.psa_destroy_key" title="psa_destroy_key">psa_destroy_key</a>(<a class="reference internal" href="ids.html#c.psa_key_id_t" title="psa_key_id_t">psa_key_id_t</a> key);</pre>
<p class="rubric">Parameters</p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">key</span></code></p>
</dt><dd><p>Identifier of the key to erase.
If this is <a class="reference internal" href="ids.html#c.PSA_KEY_ID_NULL" title="PSA_KEY_ID_NULL"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_ID_NULL</span></code></a>, do nothing and return <code class="docutils literal notranslate"><span class="pre">PSA_SUCCESS</span></code>.</p>
</dd>
</dl>
</div>
<p class="rubric">Returns: <code class="docutils literal notranslate"><span class="pre">psa_status_t</span></code></p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_SUCCESS</span></code></p>
</dt><dd><p>Success:</p>
<ul class="simple">
<li><p>If <code class="docutils literal notranslate"><span class="pre">key</span></code> was a valid key identifier that was not the result of a call to <a class="reference internal" href="#c.psa_attach_key" title="psa_attach_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_attach_key()</span></code></a>, then material that it referred to has been erased.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">key</span></code> was a valid key identifier that was returned by <a class="reference internal" href="#c.psa_attach_key" title="psa_attach_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_attach_key()</span></code></a>, then the key identifier is detached from the implementation-provided key.</p></li>
<li><p>Alternatively, <code class="docutils literal notranslate"><span class="pre">key</span></code> was <a class="reference internal" href="ids.html#c.PSA_KEY_ID_NULL" title="PSA_KEY_ID_NULL"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_ID_NULL</span></code></a>.</p></li>
</ul>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_BAD_STATE</span></code></p>
</dt><dd><p>The library requires initializing by a call to <a class="reference internal" href="../library/library.html#c.psa_crypto_init" title="psa_crypto_init"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_crypto_init()</span></code></a>.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INVALID_HANDLE</span></code></p>
</dt><dd><p><code class="docutils literal notranslate"><span class="pre">key</span></code> is neither a valid key identifier, nor <a class="reference internal" href="ids.html#c.PSA_KEY_ID_NULL" title="PSA_KEY_ID_NULL"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_ID_NULL</span></code></a>.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_NOT_PERMITTED</span></code></p>
</dt><dd><p>The key cannot be erased because it is read-only, either due to a policy or due to physical restrictions.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_COMMUNICATION_FAILURE</span></code></p>
</dt><dd><p>There was an failure in communication with the cryptoprocessor. The key material might still be present in the cryptoprocessor.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_CORRUPTION_DETECTED</span></code></p>
</dt><dd><p>An unexpected condition which is not a storage corruption or a communication failure occurred. The cryptoprocessor might have been compromised.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_STORAGE_FAILURE</span></code></p>
</dt><dd><p>The storage operation failed. Implementations must make a best effort to erase key material even in this situation, however, it might be impossible to guarantee that the key material is not recoverable in such cases.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_DATA_CORRUPT</span></code></p>
</dt><dd><p>The storage is corrupted. Implementations must make a best effort to erase key material even in this situation, however, it might be impossible to guarantee that the key material is not recoverable in such cases.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_DATA_INVALID</span></code></p>
</dt><dd></dd>
</dl>
</div>
<p class="rubric">Description</p>
<p>For key identifiers that resulted from registering an implementation-provided key using <a class="reference internal" href="#c.psa_attach_key" title="psa_attach_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_attach_key()</span></code></a>, this function detaches the key identifier from the implementation-provided key.</p>
<p>For other keys, this function destroys a key from both volatile memory and, if applicable, non-volatile storage.
Implementations must make a best effort to ensure that that the key material cannot be recovered.</p>
<p>This function also erases any metadata such as policies and frees resources associated with the key.</p>
<p>Destroying the key makes the key identifier invalid, and the key identifier must not be used again by the application.</p>
<p>If a key is currently in use in a multi-part operation, then destroying the key will cause the multi-part operation to fail.</p>
</section>
<section id="c.psa_purge_key">
<h3><code class="docutils literal notranslate"><span class="pre">psa_purge_key</span></code> (function)<a class="headerlink" href="#c.psa_purge_key" title="Link to this heading">¶</a></h3>
<p>Remove non-essential copies of key material from memory.</p>
<pre class="literal-block">psa_status_t <a class="reference internal" href="#c.psa_purge_key" title="psa_purge_key">psa_purge_key</a>(<a class="reference internal" href="ids.html#c.psa_key_id_t" title="psa_key_id_t">psa_key_id_t</a> key);</pre>
<p class="rubric">Parameters</p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">key</span></code></p>
</dt><dd><p>Identifier of the key to purge.</p>
</dd>
</dl>
</div>
<p class="rubric">Returns: <code class="docutils literal notranslate"><span class="pre">psa_status_t</span></code></p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_SUCCESS</span></code></p>
</dt><dd><p>Success.
The key material has been removed from memory, if the key material is not currently required.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_BAD_STATE</span></code></p>
</dt><dd><p>The library requires initializing by a call to <a class="reference internal" href="../library/library.html#c.psa_crypto_init" title="psa_crypto_init"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_crypto_init()</span></code></a>.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INVALID_HANDLE</span></code></p>
</dt><dd><p><code class="docutils literal notranslate"><span class="pre">key</span></code> is not a valid key identifier.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_COMMUNICATION_FAILURE</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_CORRUPTION_DETECTED</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_STORAGE_FAILURE</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_DATA_CORRUPT</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_DATA_INVALID</span></code></p>
</dt><dd></dd>
</dl>
</div>
<p class="rubric">Description</p>
<p>For keys that have been created with the <a class="reference internal" href="policy.html#c.PSA_KEY_USAGE_CACHE" title="PSA_KEY_USAGE_CACHE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_USAGE_CACHE</span></code></a> usage flag, an implementation is permitted to make additional copies of the key material that are not in storage and not for the purpose of ongoing operations.</p>
<p>This function will remove these extra copies of the key material from memory.</p>
<p>This function is not required to remove key material from memory in any of the following situations:</p>
<ul class="simple">
<li><p>The key is currently in use in a cryptographic operation.</p></li>
<li><p>The key is volatile.</p></li>
</ul>
<p>See also <a class="reference internal" href="../../overview/implementation.html#key-material"><span class="secref">Managing key material</span></a>.</p>
</section>
</section>
<section id="key-export">
<span id="id3"></span><h2><span class="section-number">9.9.3 </span>Key export<a class="headerlink" href="#key-export" title="Link to this heading">¶</a></h2>
<section id="c.psa_export_key">
<h3><code class="docutils literal notranslate"><span class="pre">psa_export_key</span></code> (function)<a class="headerlink" href="#c.psa_export_key" title="Link to this heading">¶</a></h3>
<p>Export a key in binary format.</p>
<pre class="literal-block">psa_status_t <a class="reference internal" href="#c.psa_export_key" title="psa_export_key">psa_export_key</a>(<a class="reference internal" href="ids.html#c.psa_key_id_t" title="psa_key_id_t">psa_key_id_t</a> key,
                            uint8_t * data,
                            size_t data_size,
                            size_t * data_length);</pre>
<p class="rubric">Parameters</p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">key</span></code></p>
</dt><dd><p>Identifier of the key to export.
It must permit the usage <a class="reference internal" href="policy.html#c.PSA_KEY_USAGE_EXPORT" title="PSA_KEY_USAGE_EXPORT"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_USAGE_EXPORT</span></code></a>, unless it is a public key.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">data</span></code></p>
</dt><dd><p>Buffer where the key data is to be written.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">data_size</span></code></p>
</dt><dd><p>Size of the <code class="docutils literal notranslate"><span class="pre">data</span></code> buffer in bytes.
This must be appropriate for the key:</p>
<ul class="simple">
<li><p>The required output size is <a class="reference internal" href="#c.PSA_EXPORT_KEY_OUTPUT_SIZE" title="PSA_EXPORT_KEY_OUTPUT_SIZE"><code class="docutils literal notranslate"><span class="pre">PSA_EXPORT_KEY_OUTPUT_SIZE</span></code></a><code class="docutils literal notranslate"><span class="pre">(</span></code><code class="docutils literal notranslate"><span class="pre">type</span></code><code class="docutils literal notranslate"><span class="pre">,</span> </code><code class="docutils literal notranslate"><span class="pre">bits</span></code><code class="docutils literal notranslate"><span class="pre">)</span></code> where <code class="docutils literal notranslate"><span class="pre">type</span></code> is the key type and <code class="docutils literal notranslate"><span class="pre">bits</span></code> is the key size in bits.</p></li>
<li><p><a class="reference internal" href="#c.PSA_EXPORT_ASYMMETRIC_KEY_MAX_SIZE" title="PSA_EXPORT_ASYMMETRIC_KEY_MAX_SIZE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_EXPORT_ASYMMETRIC_KEY_MAX_SIZE</span></code></a> evaluates to the maximum output size of any supported public key or key pair.</p></li>
<li><p><a class="reference internal" href="#c.PSA_EXPORT_KEY_PAIR_MAX_SIZE" title="PSA_EXPORT_KEY_PAIR_MAX_SIZE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_EXPORT_KEY_PAIR_MAX_SIZE</span></code></a> evaluates to the maximum output size of any supported key pair.</p></li>
<li><p><a class="reference internal" href="#c.PSA_EXPORT_PUBLIC_KEY_MAX_SIZE" title="PSA_EXPORT_PUBLIC_KEY_MAX_SIZE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_EXPORT_PUBLIC_KEY_MAX_SIZE</span></code></a> evaluates to the maximum output size of any supported public key.</p></li>
<li><p>This API defines no maximum size for symmetric keys. Arbitrarily large data items can be stored in the key store, for example certificates that correspond to a stored private key or input material for key derivation.</p></li>
</ul>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">data_length</span></code></p>
</dt><dd><p>On success, the number of bytes that make up the key data.</p>
</dd>
</dl>
</div>
<p class="rubric">Returns: <code class="docutils literal notranslate"><span class="pre">psa_status_t</span></code></p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_SUCCESS</span></code></p>
</dt><dd><p>Success.
The first <code class="docutils literal notranslate"><span class="pre">(*data_length)</span></code> bytes of <code class="docutils literal notranslate"><span class="pre">data</span></code> contain the exported key.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_BAD_STATE</span></code></p>
</dt><dd><p>The library requires initializing by a call to <a class="reference internal" href="../library/library.html#c.psa_crypto_init" title="psa_crypto_init"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_crypto_init()</span></code></a>.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INVALID_HANDLE</span></code></p>
</dt><dd><p><code class="docutils literal notranslate"><span class="pre">key</span></code> is not a valid key identifier.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_NOT_PERMITTED</span></code></p>
</dt><dd><p>The key does not have the <a class="reference internal" href="policy.html#c.PSA_KEY_USAGE_EXPORT" title="PSA_KEY_USAGE_EXPORT"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_USAGE_EXPORT</span></code></a> flag.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_BUFFER_TOO_SMALL</span></code></p>
</dt><dd><p>The size of the <code class="docutils literal notranslate"><span class="pre">data</span></code> buffer is too small.
<a class="reference internal" href="#c.PSA_EXPORT_KEY_OUTPUT_SIZE" title="PSA_EXPORT_KEY_OUTPUT_SIZE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_EXPORT_KEY_OUTPUT_SIZE()</span></code></a>, <a class="reference internal" href="#c.PSA_EXPORT_KEY_PAIR_MAX_SIZE" title="PSA_EXPORT_KEY_PAIR_MAX_SIZE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_EXPORT_KEY_PAIR_MAX_SIZE</span></code></a>, <a class="reference internal" href="#c.PSA_EXPORT_PUBLIC_KEY_MAX_SIZE" title="PSA_EXPORT_PUBLIC_KEY_MAX_SIZE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_EXPORT_PUBLIC_KEY_MAX_SIZE</span></code></a>, or <a class="reference internal" href="#c.PSA_EXPORT_ASYMMETRIC_KEY_MAX_SIZE" title="PSA_EXPORT_ASYMMETRIC_KEY_MAX_SIZE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_EXPORT_ASYMMETRIC_KEY_MAX_SIZE</span></code></a> can be used to determine a sufficient buffer size.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_NOT_SUPPORTED</span></code></p>
</dt><dd><p>The following conditions can result in this error:</p>
<ul class="simple">
<li><p>The key’s storage location does not support export of the key.</p></li>
<li><p>The implementation does not support export of keys with this key type.</p></li>
</ul>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INSUFFICIENT_MEMORY</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_COMMUNICATION_FAILURE</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_CORRUPTION_DETECTED</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_STORAGE_FAILURE</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_DATA_CORRUPT</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_DATA_INVALID</span></code></p>
</dt><dd></dd>
</dl>
</div>
<p class="rubric">Description</p>
<p>The output of this function can be passed to <a class="reference internal" href="#c.psa_import_key" title="psa_import_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_import_key()</span></code></a> to create an equivalent object.</p>
<p>If the implementation of <a class="reference internal" href="#c.psa_import_key" title="psa_import_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_import_key()</span></code></a> supports other formats beyond the format specified here, the output from <a class="reference internal" href="#c.psa_export_key" title="psa_export_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_export_key()</span></code></a> must use the representation specified in <a class="reference internal" href="types.html#key-types"><span class="secref">Key types</span></a>, not the originally imported representation.</p>
<p>For standard key types, the output format is defined in the relevant <em>Key format</em> section in <a class="reference internal" href="types.html#key-types"><span class="secref">Key types</span></a>.
The policy on the key must have the usage flag <a class="reference internal" href="policy.html#c.PSA_KEY_USAGE_EXPORT" title="PSA_KEY_USAGE_EXPORT"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_USAGE_EXPORT</span></code></a> set.</p>
</section>
<section id="c.psa_export_public_key">
<h3><code class="docutils literal notranslate"><span class="pre">psa_export_public_key</span></code> (function)<a class="headerlink" href="#c.psa_export_public_key" title="Link to this heading">¶</a></h3>
<p>Export a public key or the public part of a key pair in binary format.</p>
<pre class="literal-block">psa_status_t <a class="reference internal" href="#c.psa_export_public_key" title="psa_export_public_key">psa_export_public_key</a>(<a class="reference internal" href="ids.html#c.psa_key_id_t" title="psa_key_id_t">psa_key_id_t</a> key,
                                   uint8_t * data,
                                   size_t data_size,
                                   size_t * data_length);</pre>
<p class="rubric">Parameters</p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">key</span></code></p>
</dt><dd><p>Identifier of the key to export.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">data</span></code></p>
</dt><dd><p>Buffer where the key data is to be written.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">data_size</span></code></p>
</dt><dd><p>Size of the <code class="docutils literal notranslate"><span class="pre">data</span></code> buffer in bytes.
This must be appropriate for the key:</p>
<ul class="simple">
<li><p>The required output size is <a class="reference internal" href="#c.PSA_EXPORT_PUBLIC_KEY_OUTPUT_SIZE" title="PSA_EXPORT_PUBLIC_KEY_OUTPUT_SIZE"><code class="docutils literal notranslate"><span class="pre">PSA_EXPORT_PUBLIC_KEY_OUTPUT_SIZE</span></code></a><code class="docutils literal notranslate"><span class="pre">(</span></code><code class="docutils literal notranslate"><span class="pre">type</span></code><code class="docutils literal notranslate"><span class="pre">,</span> </code><code class="docutils literal notranslate"><span class="pre">bits</span></code><code class="docutils literal notranslate"><span class="pre">)</span></code> where <code class="docutils literal notranslate"><span class="pre">type</span></code> is the key type and <code class="docutils literal notranslate"><span class="pre">bits</span></code> is the key size in bits.</p></li>
<li><p><a class="reference internal" href="#c.PSA_EXPORT_PUBLIC_KEY_MAX_SIZE" title="PSA_EXPORT_PUBLIC_KEY_MAX_SIZE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_EXPORT_PUBLIC_KEY_MAX_SIZE</span></code></a> evaluates to the maximum output size of any supported public key or public part of a key pair.</p></li>
<li><p><a class="reference internal" href="#c.PSA_EXPORT_ASYMMETRIC_KEY_MAX_SIZE" title="PSA_EXPORT_ASYMMETRIC_KEY_MAX_SIZE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_EXPORT_ASYMMETRIC_KEY_MAX_SIZE</span></code></a> evaluates to the maximum output size of any supported public key or key pair.</p></li>
</ul>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">data_length</span></code></p>
</dt><dd><p>On success, the number of bytes that make up the key data.</p>
</dd>
</dl>
</div>
<p class="rubric">Returns: <code class="docutils literal notranslate"><span class="pre">psa_status_t</span></code></p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_SUCCESS</span></code></p>
</dt><dd><p>Success.
The first <code class="docutils literal notranslate"><span class="pre">(*data_length)</span></code> bytes of <code class="docutils literal notranslate"><span class="pre">data</span></code> contain the exported public key.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_BAD_STATE</span></code></p>
</dt><dd><p>The library requires initializing by a call to <a class="reference internal" href="../library/library.html#c.psa_crypto_init" title="psa_crypto_init"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_crypto_init()</span></code></a>.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INVALID_HANDLE</span></code></p>
</dt><dd><p><code class="docutils literal notranslate"><span class="pre">key</span></code> is not a valid key identifier.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_BUFFER_TOO_SMALL</span></code></p>
</dt><dd><p>The size of the <code class="docutils literal notranslate"><span class="pre">data</span></code> buffer is too small.
<a class="reference internal" href="#c.PSA_EXPORT_PUBLIC_KEY_OUTPUT_SIZE" title="PSA_EXPORT_PUBLIC_KEY_OUTPUT_SIZE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_EXPORT_PUBLIC_KEY_OUTPUT_SIZE()</span></code></a>, <a class="reference internal" href="#c.PSA_EXPORT_PUBLIC_KEY_MAX_SIZE" title="PSA_EXPORT_PUBLIC_KEY_MAX_SIZE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_EXPORT_PUBLIC_KEY_MAX_SIZE</span></code></a>, or <a class="reference internal" href="#c.PSA_EXPORT_ASYMMETRIC_KEY_MAX_SIZE" title="PSA_EXPORT_ASYMMETRIC_KEY_MAX_SIZE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_EXPORT_ASYMMETRIC_KEY_MAX_SIZE</span></code></a> can be used to determine a sufficient buffer size.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INVALID_ARGUMENT</span></code></p>
</dt><dd><p>The key is neither a public key nor a key pair.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_NOT_SUPPORTED</span></code></p>
</dt><dd><p>The following conditions can result in this error:</p>
<ul class="simple">
<li><p>The key’s storage location does not support export of the key.</p></li>
<li><p>The implementation does not support export of keys with this key type.</p></li>
</ul>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INSUFFICIENT_MEMORY</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_COMMUNICATION_FAILURE</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_CORRUPTION_DETECTED</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_STORAGE_FAILURE</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_DATA_CORRUPT</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_DATA_INVALID</span></code></p>
</dt><dd></dd>
</dl>
</div>
<p class="rubric">Description</p>
<p>The output of this function can be passed to <a class="reference internal" href="#c.psa_import_key" title="psa_import_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_import_key()</span></code></a> to create an object that is equivalent to the public key.</p>
<p>If the implementation of <a class="reference internal" href="#c.psa_import_key" title="psa_import_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_import_key()</span></code></a> supports other formats beyond the format specified here, the output from <a class="reference internal" href="#c.psa_export_public_key" title="psa_export_public_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_export_public_key()</span></code></a> must use the representation specified in <a class="reference internal" href="types.html#key-types"><span class="secref">Key types</span></a>, not the originally imported representation.</p>
<p>For standard key types, the output format is defined in the relevant <em>Key format</em> section in <a class="reference internal" href="types.html#key-types"><span class="secref">Key types</span></a>.</p>
<p>Exporting a public-key object or the public part of a key pair is always permitted, regardless of the key’s usage flags.</p>
</section>
<section id="c.PSA_EXPORT_KEY_OUTPUT_SIZE">
<h3><code class="docutils literal notranslate"><span class="pre">PSA_EXPORT_KEY_OUTPUT_SIZE</span></code> (macro)<a class="headerlink" href="#c.PSA_EXPORT_KEY_OUTPUT_SIZE" title="Link to this heading">¶</a></h3>
<p>Sufficient output buffer size for <a class="reference internal" href="#c.psa_export_key" title="psa_export_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_export_key()</span></code></a>.</p>
<pre class="literal-block">#define <a class="reference internal" href="#c.PSA_EXPORT_KEY_OUTPUT_SIZE" title="PSA_EXPORT_KEY_OUTPUT_SIZE">PSA_EXPORT_KEY_OUTPUT_SIZE</a>(key_type, key_bits) \
    <em><a class="reference internal" href="../../overview/implementation.html#implementation-defined-value"><span class="std std-ref">/* implementation-defined value */</span></a></em></pre>
<p class="rubric">Parameters</p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">key_type</span></code></p>
</dt><dd><p>A supported key type.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">key_bits</span></code></p>
</dt><dd><p>The size of the key in bits.</p>
</dd>
</dl>
</div>
<p class="rubric">Returns</p>
<p>If the parameters are valid and supported, return a buffer size in bytes that guarantees that <a class="reference internal" href="#c.psa_export_key" title="psa_export_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_export_key()</span></code></a> or <a class="reference internal" href="#c.psa_export_public_key" title="psa_export_public_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_export_public_key()</span></code></a> will not fail with <code class="docutils literal notranslate"><span class="pre">PSA_ERROR_BUFFER_TOO_SMALL</span></code>. If the parameters are a valid combination that is not supported by the implementation, this macro must return either a sensible size or <code class="docutils literal notranslate"><span class="pre">0</span></code>. If the parameters are not valid, the return value is unspecified.</p>
<p class="rubric">Description</p>
<p>The following code illustrates how to allocate enough memory to export a key by querying the key type and size at runtime.</p>
<pre class="literal-block"><a class="reference internal" href="attributes.html#c.psa_key_attributes_t" title="psa_key_attributes_t">psa_key_attributes_t</a> attributes = <a class="reference internal" href="attributes.html#c.PSA_KEY_ATTRIBUTES_INIT" title="PSA_KEY_ATTRIBUTES_INIT">PSA_KEY_ATTRIBUTES_INIT</a>;
psa_status_t status;
status = <a class="reference internal" href="attributes.html#c.psa_get_key_attributes" title="psa_get_key_attributes">psa_get_key_attributes</a>(key, &amp;attributes);
if (status != PSA_SUCCESS)
    handle_error(...);
<a class="reference internal" href="types.html#c.psa_key_type_t" title="psa_key_type_t">psa_key_type_t</a> key_type = <a class="reference internal" href="types.html#c.psa_get_key_type" title="psa_get_key_type">psa_get_key_type</a>(&amp;attributes);
size_t key_bits = <a class="reference internal" href="types.html#c.psa_get_key_bits" title="psa_get_key_bits">psa_get_key_bits</a>(&amp;attributes);
size_t buffer_size = <a class="reference internal" href="#c.PSA_EXPORT_KEY_OUTPUT_SIZE" title="PSA_EXPORT_KEY_OUTPUT_SIZE">PSA_EXPORT_KEY_OUTPUT_SIZE</a>(key_type, key_bits);
<a class="reference internal" href="attributes.html#c.psa_reset_key_attributes" title="psa_reset_key_attributes">psa_reset_key_attributes</a>(&amp;attributes);
uint8_t *buffer = malloc(buffer_size);
if (buffer == NULL)
    handle_error(...);
size_t buffer_length;
status = <a class="reference internal" href="#c.psa_export_key" title="psa_export_key">psa_export_key</a>(key, buffer, buffer_size, &amp;buffer_length);
if (status != PSA_SUCCESS)
    handle_error(...);</pre>
<p>See also <a class="reference internal" href="#c.PSA_EXPORT_KEY_PAIR_MAX_SIZE" title="PSA_EXPORT_KEY_PAIR_MAX_SIZE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_EXPORT_KEY_PAIR_MAX_SIZE</span></code></a>, <a class="reference internal" href="#c.PSA_EXPORT_PUBLIC_KEY_MAX_SIZE" title="PSA_EXPORT_PUBLIC_KEY_MAX_SIZE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_EXPORT_PUBLIC_KEY_MAX_SIZE</span></code></a>, and <a class="reference internal" href="#c.PSA_EXPORT_ASYMMETRIC_KEY_MAX_SIZE" title="PSA_EXPORT_ASYMMETRIC_KEY_MAX_SIZE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_EXPORT_ASYMMETRIC_KEY_MAX_SIZE</span></code></a>.</p>
</section>
<section id="c.PSA_EXPORT_PUBLIC_KEY_OUTPUT_SIZE">
<h3><code class="docutils literal notranslate"><span class="pre">PSA_EXPORT_PUBLIC_KEY_OUTPUT_SIZE</span></code> (macro)<a class="headerlink" href="#c.PSA_EXPORT_PUBLIC_KEY_OUTPUT_SIZE" title="Link to this heading">¶</a></h3>
<p>Sufficient output buffer size for <a class="reference internal" href="#c.psa_export_public_key" title="psa_export_public_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_export_public_key()</span></code></a>.</p>
<pre class="literal-block">#define <a class="reference internal" href="#c.PSA_EXPORT_PUBLIC_KEY_OUTPUT_SIZE" title="PSA_EXPORT_PUBLIC_KEY_OUTPUT_SIZE">PSA_EXPORT_PUBLIC_KEY_OUTPUT_SIZE</a>(key_type, key_bits) \
    <em><a class="reference internal" href="../../overview/implementation.html#implementation-defined-value"><span class="std std-ref">/* implementation-defined value */</span></a></em></pre>
<p class="rubric">Parameters</p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">key_type</span></code></p>
</dt><dd><p>A public-key or key-pair key type.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">key_bits</span></code></p>
</dt><dd><p>The size of the key in bits.</p>
</dd>
</dl>
</div>
<p class="rubric">Returns</p>
<p>If the parameters are valid and supported, return a buffer size in bytes that guarantees that <a class="reference internal" href="#c.psa_export_public_key" title="psa_export_public_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_export_public_key()</span></code></a> will not fail with <code class="docutils literal notranslate"><span class="pre">PSA_ERROR_BUFFER_TOO_SMALL</span></code>. If the parameters are a valid combination that is not supported by the implementation, this macro must return either a sensible size or <code class="docutils literal notranslate"><span class="pre">0</span></code>. If the parameters are not valid, the return value is unspecified.</p>
<p>If the parameters are valid and supported, it is recommended that this macro returns the same result as <a class="reference internal" href="#c.PSA_EXPORT_KEY_OUTPUT_SIZE" title="PSA_EXPORT_KEY_OUTPUT_SIZE"><code class="docutils literal notranslate"><span class="pre">PSA_EXPORT_KEY_OUTPUT_SIZE</span></code></a><code class="docutils literal notranslate"><span class="pre">(</span></code><a class="reference internal" href="types.html#c.PSA_KEY_TYPE_PUBLIC_KEY_OF_KEY_PAIR" title="PSA_KEY_TYPE_PUBLIC_KEY_OF_KEY_PAIR"><code class="docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_PUBLIC_KEY_OF_KEY_PAIR</span></code></a><code class="docutils literal notranslate"><span class="pre">(</span></code><code class="docutils literal notranslate"><span class="pre">key_type</span></code><code class="docutils literal notranslate"><span class="pre">),</span> </code><code class="docutils literal notranslate"><span class="pre">key_bits</span></code><code class="docutils literal notranslate"><span class="pre">)</span></code>.</p>
<p class="rubric">Description</p>
<p>The following code illustrates how to allocate enough memory to export a public key by querying the key type and size at runtime.</p>
<pre class="literal-block"><a class="reference internal" href="attributes.html#c.psa_key_attributes_t" title="psa_key_attributes_t">psa_key_attributes_t</a> attributes = <a class="reference internal" href="attributes.html#c.PSA_KEY_ATTRIBUTES_INIT" title="PSA_KEY_ATTRIBUTES_INIT">PSA_KEY_ATTRIBUTES_INIT</a>;
psa_status_t status;
status = <a class="reference internal" href="attributes.html#c.psa_get_key_attributes" title="psa_get_key_attributes">psa_get_key_attributes</a>(key, &amp;attributes);
if (status != PSA_SUCCESS)
    handle_error(...);
<a class="reference internal" href="types.html#c.psa_key_type_t" title="psa_key_type_t">psa_key_type_t</a> key_type = <a class="reference internal" href="types.html#c.psa_get_key_type" title="psa_get_key_type">psa_get_key_type</a>(&amp;attributes);
size_t key_bits = <a class="reference internal" href="types.html#c.psa_get_key_bits" title="psa_get_key_bits">psa_get_key_bits</a>(&amp;attributes);
size_t buffer_size = <a class="reference internal" href="#c.PSA_EXPORT_PUBLIC_KEY_OUTPUT_SIZE" title="PSA_EXPORT_PUBLIC_KEY_OUTPUT_SIZE">PSA_EXPORT_PUBLIC_KEY_OUTPUT_SIZE</a>(key_type, key_bits);
<a class="reference internal" href="attributes.html#c.psa_reset_key_attributes" title="psa_reset_key_attributes">psa_reset_key_attributes</a>(&amp;attributes);
uint8_t *buffer = malloc(buffer_size);
if (buffer == NULL)
    handle_error(...);
size_t buffer_length;
status = <a class="reference internal" href="#c.psa_export_public_key" title="psa_export_public_key">psa_export_public_key</a>(key, buffer, buffer_size, &amp;buffer_length);
if (status != PSA_SUCCESS)
    handle_error(...);</pre>
<p>See also <a class="reference internal" href="#c.PSA_EXPORT_PUBLIC_KEY_MAX_SIZE" title="PSA_EXPORT_PUBLIC_KEY_MAX_SIZE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_EXPORT_PUBLIC_KEY_MAX_SIZE</span></code></a> and <a class="reference internal" href="#c.PSA_EXPORT_ASYMMETRIC_KEY_MAX_SIZE" title="PSA_EXPORT_ASYMMETRIC_KEY_MAX_SIZE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_EXPORT_ASYMMETRIC_KEY_MAX_SIZE</span></code></a>.</p>
</section>
<section id="c.PSA_EXPORT_KEY_PAIR_MAX_SIZE">
<h3><code class="docutils literal notranslate"><span class="pre">PSA_EXPORT_KEY_PAIR_MAX_SIZE</span></code> (macro)<a class="headerlink" href="#c.PSA_EXPORT_KEY_PAIR_MAX_SIZE" title="Link to this heading">¶</a></h3>
<p>Sufficient buffer size for exporting any asymmetric key pair.</p>
<pre class="literal-block">#define <a class="reference internal" href="#c.PSA_EXPORT_KEY_PAIR_MAX_SIZE" title="PSA_EXPORT_KEY_PAIR_MAX_SIZE">PSA_EXPORT_KEY_PAIR_MAX_SIZE</a> <em><a class="reference internal" href="../../overview/implementation.html#implementation-defined-value"><span class="std std-ref">/* implementation-defined value */</span></a></em></pre>
<p>This value must be a sufficient buffer size when calling <a class="reference internal" href="#c.psa_export_key" title="psa_export_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_export_key()</span></code></a> to export any asymmetric key pair that is supported by the implementation, regardless of the exact key type and key size.</p>
<p>See also <a class="reference internal" href="#c.PSA_EXPORT_KEY_OUTPUT_SIZE" title="PSA_EXPORT_KEY_OUTPUT_SIZE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_EXPORT_KEY_OUTPUT_SIZE()</span></code></a>, <a class="reference internal" href="#c.PSA_EXPORT_PUBLIC_KEY_MAX_SIZE" title="PSA_EXPORT_PUBLIC_KEY_MAX_SIZE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_EXPORT_PUBLIC_KEY_MAX_SIZE</span></code></a>, and <a class="reference internal" href="#c.PSA_EXPORT_ASYMMETRIC_KEY_MAX_SIZE" title="PSA_EXPORT_ASYMMETRIC_KEY_MAX_SIZE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_EXPORT_ASYMMETRIC_KEY_MAX_SIZE</span></code></a>.</p>
</section>
<section id="c.PSA_EXPORT_PUBLIC_KEY_MAX_SIZE">
<h3><code class="docutils literal notranslate"><span class="pre">PSA_EXPORT_PUBLIC_KEY_MAX_SIZE</span></code> (macro)<a class="headerlink" href="#c.PSA_EXPORT_PUBLIC_KEY_MAX_SIZE" title="Link to this heading">¶</a></h3>
<p>Sufficient buffer size for exporting any asymmetric public key.</p>
<pre class="literal-block">#define <a class="reference internal" href="#c.PSA_EXPORT_PUBLIC_KEY_MAX_SIZE" title="PSA_EXPORT_PUBLIC_KEY_MAX_SIZE">PSA_EXPORT_PUBLIC_KEY_MAX_SIZE</a> <em><a class="reference internal" href="../../overview/implementation.html#implementation-defined-value"><span class="std std-ref">/* implementation-defined value */</span></a></em></pre>
<p>This value must be a sufficient buffer size when calling <a class="reference internal" href="#c.psa_export_key" title="psa_export_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_export_key()</span></code></a> or <a class="reference internal" href="#c.psa_export_public_key" title="psa_export_public_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_export_public_key()</span></code></a> to export any asymmetric public key that is supported by the implementation, regardless of the exact key type and key size.</p>
<p>See also <a class="reference internal" href="#c.PSA_EXPORT_PUBLIC_KEY_OUTPUT_SIZE" title="PSA_EXPORT_PUBLIC_KEY_OUTPUT_SIZE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_EXPORT_PUBLIC_KEY_OUTPUT_SIZE()</span></code></a>, <a class="reference internal" href="#c.PSA_EXPORT_KEY_OUTPUT_SIZE" title="PSA_EXPORT_KEY_OUTPUT_SIZE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_EXPORT_KEY_OUTPUT_SIZE()</span></code></a>, <a class="reference internal" href="#c.PSA_EXPORT_KEY_PAIR_MAX_SIZE" title="PSA_EXPORT_KEY_PAIR_MAX_SIZE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_EXPORT_KEY_PAIR_MAX_SIZE</span></code></a>, and <a class="reference internal" href="#c.PSA_EXPORT_ASYMMETRIC_KEY_MAX_SIZE" title="PSA_EXPORT_ASYMMETRIC_KEY_MAX_SIZE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_EXPORT_ASYMMETRIC_KEY_MAX_SIZE</span></code></a>.</p>
</section>
<section id="c.PSA_EXPORT_ASYMMETRIC_KEY_MAX_SIZE">
<h3><code class="docutils literal notranslate"><span class="pre">PSA_EXPORT_ASYMMETRIC_KEY_MAX_SIZE</span></code> (macro)<a class="headerlink" href="#c.PSA_EXPORT_ASYMMETRIC_KEY_MAX_SIZE" title="Link to this heading">¶</a></h3>
<p>Sufficient buffer size for exporting any asymmetric key pair or public key.</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 1.3.</span></p>
</div>
<pre class="literal-block">#define <a class="reference internal" href="#c.PSA_EXPORT_ASYMMETRIC_KEY_MAX_SIZE" title="PSA_EXPORT_ASYMMETRIC_KEY_MAX_SIZE">PSA_EXPORT_ASYMMETRIC_KEY_MAX_SIZE</a> <em><a class="reference internal" href="../../overview/implementation.html#implementation-defined-value"><span class="std std-ref">/* implementation-defined value */</span></a></em></pre>
<p>This value must be a sufficient buffer size when calling <a class="reference internal" href="#c.psa_export_key" title="psa_export_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_export_key()</span></code></a> or <a class="reference internal" href="#c.psa_export_public_key" title="psa_export_public_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_export_public_key()</span></code></a> to export any asymmetric key pair or public key that is supported by the implementation, regardless of the exact key type and key size.</p>
<p>See also <a class="reference internal" href="#c.PSA_EXPORT_KEY_PAIR_MAX_SIZE" title="PSA_EXPORT_KEY_PAIR_MAX_SIZE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_EXPORT_KEY_PAIR_MAX_SIZE</span></code></a>, <a class="reference internal" href="#c.PSA_EXPORT_PUBLIC_KEY_MAX_SIZE" title="PSA_EXPORT_PUBLIC_KEY_MAX_SIZE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_EXPORT_PUBLIC_KEY_MAX_SIZE</span></code></a>, and <a class="reference internal" href="#c.PSA_EXPORT_KEY_OUTPUT_SIZE" title="PSA_EXPORT_KEY_OUTPUT_SIZE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_EXPORT_KEY_OUTPUT_SIZE()</span></code></a>.</p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &#169; 2018-2026 Arm Limited and/or its affiliates.
      
    </div>

    

    
  </body>
</html>