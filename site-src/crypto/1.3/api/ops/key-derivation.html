---
---

<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="10.6 Key derivation" />
<meta property="og:type" content="website" />
<meta property="og:url" content="{{ page.url | absolute_url }}" />
<link rel="canonical" href="{{ page.url | absolute_url }}" />
<meta property="og:site_name" content="PSA Certified Crypto API 1.3" />
<meta property="og:description" content="A key derivation encodes a deterministic method to generate a finite stream of bytes. This data stream is computed by the cryptoprocessor and extracted in chunks. If two key-derivation operations a..." />
<meta name="description" content="A key derivation encodes a deterministic method to generate a finite stream of bytes. This data stream is computed by the cryptoprocessor and extracted in chunks. If two key-derivation operations a..." />

    <title>10.6 Key derivation &#8212; PSA Certified Crypto API 1.3</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=f6a572b4" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=4ae1632d" />
    <link rel="preconnect" type="text/css" href="https://fonts.googleapis.com" />
    <link rel="preconnect" type="text/css" href="https://fonts.gstatic.com" />
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,300;0,400;1,300;1,400&display=swap" />
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Noto+Sans+Mono:ital,wght@0,300;0,400;1,300&display=swap" />
    <script src="../../_static/documentation_options.js?v=f2aba15d"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script>window.MathJax = {"chtml": {"mtextInheritFont": false, "mtextFont": "Lato-Light"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="10.7 Asymmetric signature" href="signature.html" />
    <link rel="prev" title="10.5 Authenticated encryption with associated data (AEAD)" href="aead.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/ARM_LOGO-2025_INK_RGB.svg" alt="Logo of PSA Certified Crypto API"/>
            </a></p><hr />
<h3><a href="../../index.html">PSA Certified<br />Crypto API</a></h3>
IHI 0086<br/>
Non-confidential<br/>
Version 1.3.1
<hr />
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">About this document</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../overview/intro.html">1 Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/goals.html">2 Design goals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/functionality.html">3 Functionality overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/sample-arch.html">4 Sample architectures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/conventions.html">5 Library conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/implementation.html">6 Implementation considerations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/usage.html">7 Usage considerations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../library/index.html">8 Library management reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../keys/index.html">9 Key management reference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">10 Cryptographic operation reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="algorithms.html">10.1 Algorithms</a></li>
<li class="toctree-l2"><a class="reference internal" href="hash.html">10.2 Message digests (Hashes)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mac.html">10.3 Message authentication codes (MAC)</a></li>
<li class="toctree-l2"><a class="reference internal" href="cipher.html">10.4 Unauthenticated ciphers</a></li>
<li class="toctree-l2"><a class="reference internal" href="aead.html">10.5 Authenticated encryption with associated data (AEAD)</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">10.6 Key derivation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#key-derivation-algorithms">10.6.1 Key-derivation algorithms</a></li>
<li class="toctree-l3"><a class="reference internal" href="#input-step-types">10.6.2 Input step types</a></li>
<li class="toctree-l3"><a class="reference internal" href="#key-derivation-functions">10.6.3 Key-derivation functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#support-macros">10.6.4 Support macros</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="signature.html">10.7 Asymmetric signature</a></li>
<li class="toctree-l2"><a class="reference internal" href="pk-encryption.html">10.8 Asymmetric encryption</a></li>
<li class="toctree-l2"><a class="reference internal" href="key-agreement.html">10.9 Key agreement</a></li>
<li class="toctree-l2"><a class="reference internal" href="key-encapsulation.html">10.10 Key encapsulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="pake.html">10.11 Password-authenticated key exchange (PAKE)</a></li>
<li class="toctree-l2"><a class="reference internal" href="rng.html">10.12 Other cryptographic services</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../appendix/example_header.html">A Example header file</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendix/encodings.html">B Algorithm and key type encoding</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendix/specdef_values.html">C Example macro implementations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendix/sra.html">D Security Risk Assessment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendix/history.html">E Changes to the API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../atg_c-identifiers.html">Index of API elements</a></li>
</ul>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="key-derivation">
<span id="kdf"></span><h1><span class="section-number">10.6 </span>Key derivation<a class="headerlink" href="#key-derivation" title="Link to this heading">¶</a></h1>
<p>A key derivation encodes a deterministic method to generate a finite stream of bytes. This data stream is computed by the cryptoprocessor and extracted in chunks. If two key-derivation operations are constructed with the same parameters, then they produce the same output.</p>
<p>A key derivation consists of two phases:</p>
<ol class="arabic simple">
<li><p>Input collection. This is sometimes known as <em>extraction</em>: the operation “extracts” information from the inputs to generate a pseudorandom intermediate secret value.</p></li>
<li><p>Output generation. This is sometimes known as <em>expansion</em>: the operation “expands” the intermediate secret value to the desired output length.</p></li>
</ol>
<p>The specification defines a <a class="reference internal" href="../../overview/functionality.html#multi-part-operations"><span class="std std-ref">multi-part operation</span></a> API for key derivation that allows:</p>
<ul class="simple">
<li><p>Multiple key and non-key outputs to be produced from a single derivation operation object.</p></li>
<li><p>Key and non-key outputs can be extracted from the key-derivation object, or compared with existing key and non-key values.</p></li>
<li><p>Algorithms that require high-entropy secret inputs. For example <a class="reference internal" href="#c.PSA_ALG_HKDF" title="PSA_ALG_HKDF"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_ALG_HKDF</span></code></a>.</p></li>
<li><p>Algorithms that work with low-entropy secret inputs, or passwords. For example <a class="reference internal" href="#c.PSA_ALG_PBKDF2_HMAC" title="PSA_ALG_PBKDF2_HMAC"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_ALG_PBKDF2_HMAC()</span></code></a>.</p></li>
</ul>
<p>An implementation with <a class="reference internal" href="../../about.html#term-isolation"><span class="term">isolation</span></a> has the following properties:</p>
<ul class="simple">
<li><p>The intermediate state of the key derivation is not visible to the caller.</p></li>
<li><p>If an output of the derivation is a non-exportable key, then this key cannot be recovered outside the isolation boundary.</p></li>
<li><p>If an output of the derivation is compared using <a class="reference internal" href="#c.psa_key_derivation_verify_bytes" title="psa_key_derivation_verify_bytes"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_verify_bytes()</span></code></a> or <a class="reference internal" href="#c.psa_key_derivation_verify_key" title="psa_key_derivation_verify_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_verify_key()</span></code></a>, then the output is not visible to the caller.</p></li>
</ul>
<p>Applications use the <a class="reference internal" href="#c.psa_key_derivation_operation_t" title="psa_key_derivation_operation_t"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_operation_t</span></code></a> type to create key-derivation operations. The operation object is used as follows:</p>
<ol class="arabic">
<li><p>Initialize a <a class="reference internal" href="#c.psa_key_derivation_operation_t" title="psa_key_derivation_operation_t"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_operation_t</span></code></a> object to zero or to <a class="reference internal" href="#c.PSA_KEY_DERIVATION_OPERATION_INIT" title="PSA_KEY_DERIVATION_OPERATION_INIT"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_OPERATION_INIT</span></code></a>.</p></li>
<li><p>Call <a class="reference internal" href="#c.psa_key_derivation_setup" title="psa_key_derivation_setup"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_setup()</span></code></a> to select a key-derivation algorithm.</p></li>
<li><p>Call the functions <a class="reference internal" href="#c.psa_key_derivation_input_key" title="psa_key_derivation_input_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_input_key()</span></code></a> or <a class="reference internal" href="key-agreement.html#c.psa_key_derivation_key_agreement" title="psa_key_derivation_key_agreement"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_key_agreement()</span></code></a> to provide the secret inputs, and <a class="reference internal" href="#c.psa_key_derivation_input_bytes" title="psa_key_derivation_input_bytes"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_input_bytes()</span></code></a> or <a class="reference internal" href="#c.psa_key_derivation_input_integer" title="psa_key_derivation_input_integer"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_input_integer()</span></code></a> to provide the non-secret inputs, to the key-derivation algorithm. Many key-derivation algorithms take multiple inputs; the <code class="docutils literal notranslate"><span class="pre">step</span></code> parameter to these functions indicates which input is being provided. The documentation for each key-derivation algorithm describes the expected inputs for that algorithm and in what order to pass them.</p></li>
<li><p>Optionally, call <a class="reference internal" href="#c.psa_key_derivation_set_capacity" title="psa_key_derivation_set_capacity"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_set_capacity()</span></code></a> to set a limit on the amount of data that can be output from the key-derivation operation.</p></li>
<li><p>Call an output or verification function:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#c.psa_key_derivation_output_key" title="psa_key_derivation_output_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_output_key()</span></code></a> or <a class="reference internal" href="#c.psa_key_derivation_output_key_custom" title="psa_key_derivation_output_key_custom"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_output_key_custom()</span></code></a> to create a derived key.</p></li>
<li><p><a class="reference internal" href="#c.psa_key_derivation_output_bytes" title="psa_key_derivation_output_bytes"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_output_bytes()</span></code></a> to export the derived data.</p></li>
<li><p><a class="reference internal" href="#c.psa_key_derivation_verify_key" title="psa_key_derivation_verify_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_verify_key()</span></code></a> to compare a derived key with an existing key value.</p></li>
<li><p><a class="reference internal" href="#c.psa_key_derivation_verify_bytes" title="psa_key_derivation_verify_bytes"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_verify_bytes()</span></code></a> to compare derived data with a buffer.</p></li>
</ul>
<p>These functions can be called multiple times to read successive output from the key derivation, until the stream is exhausted when its capacity has been reached.</p>
</li>
<li><p>Key derivation does not finish in the same way as other multi-part operations. Call <a class="reference internal" href="#c.psa_key_derivation_abort" title="psa_key_derivation_abort"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_abort()</span></code></a> to release the key-derivation operation memory when the object is no longer required.</p></li>
</ol>
<p>To recover from an error, call <a class="reference internal" href="#c.psa_key_derivation_abort" title="psa_key_derivation_abort"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_abort()</span></code></a> to release the key-derivation operation memory.</p>
<p>A key-derivation operation cannot be rewound. Once a part of the stream has been output, it cannot be output again. This ensures that the same part of the output will not be used for different purposes.</p>
<section id="key-derivation-algorithms">
<span id="id1"></span><h2><span class="section-number">10.6.1 </span>Key-derivation algorithms<a class="headerlink" href="#key-derivation-algorithms" title="Link to this heading">¶</a></h2>
<section id="c.PSA_ALG_HKDF">
<h3><code class="docutils literal notranslate"><span class="pre">PSA_ALG_HKDF</span></code> (macro)<a class="headerlink" href="#c.PSA_ALG_HKDF" title="Link to this heading">¶</a></h3>
<p>Macro to build an HKDF algorithm.</p>
<pre class="literal-block">#define <a class="reference internal" href="#c.PSA_ALG_HKDF" title="PSA_ALG_HKDF">PSA_ALG_HKDF</a>(hash_alg) <em><a class="reference internal" href="../../overview/implementation.html#specification-defined-value"><span class="std std-ref">/* specification-defined value */</span></a></em></pre>
<p class="rubric">Parameters</p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">hash_alg</span></code></p>
</dt><dd><p>A hash algorithm: a value of type <a class="reference internal" href="algorithms.html#c.psa_algorithm_t" title="psa_algorithm_t"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_algorithm_t</span></code></a> such that <a class="reference internal" href="algorithms.html#c.PSA_ALG_IS_HASH" title="PSA_ALG_IS_HASH"><code class="docutils literal notranslate"><span class="pre">PSA_ALG_IS_HASH</span></code></a><code class="docutils literal notranslate"><span class="pre">(</span></code><code class="docutils literal notranslate"><span class="pre">hash_alg</span></code><code class="docutils literal notranslate"><span class="pre">)</span></code> is true.</p>
</dd>
</dl>
</div>
<p class="rubric">Returns</p>
<p>The corresponding HKDF algorithm. For example, <a class="reference internal" href="#c.PSA_ALG_HKDF" title="PSA_ALG_HKDF"><code class="docutils literal notranslate"><span class="pre">PSA_ALG_HKDF</span></code></a><code class="docutils literal notranslate"><span class="pre">(</span></code><a class="reference internal" href="hash.html#c.PSA_ALG_SHA_256" title="PSA_ALG_SHA_256"><code class="docutils literal notranslate"><span class="pre">PSA_ALG_SHA_256</span></code></a><code class="docutils literal notranslate"><span class="pre">)</span></code> is HKDF using HMAC-SHA-256.</p>
<p>Unspecified if <code class="docutils literal notranslate"><span class="pre">hash_alg</span></code> is not a supported hash algorithm.</p>
<p class="rubric">Description</p>
<p>This is the HMAC-based Extract-and-Expand Key Derivation Function (HKDF) specified by <span><em>HMAC-based Extract-and-Expand Key Derivation Function (HKDF)</em> <a class="reference internal" href="../../about.html#cite-rfc5869"><span class="cite">[RFC5869]</span></a></span>.</p>
<p>This key-derivation algorithm uses the following inputs:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_SALT" title="PSA_KEY_DERIVATION_INPUT_SALT"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_SALT</span></code></a> is the salt used in the “extract” step. It is optional; if omitted, the derivation uses an empty salt.</p></li>
<li><p><a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_SECRET" title="PSA_KEY_DERIVATION_INPUT_SECRET"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_SECRET</span></code></a> is the secret key (input keying material) used in the “extract” step.</p></li>
<li><p><a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_INFO" title="PSA_KEY_DERIVATION_INPUT_INFO"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_INFO</span></code></a> is the info string used in the “expand” step.</p></li>
</ul>
<p>If <a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_SALT" title="PSA_KEY_DERIVATION_INPUT_SALT"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_SALT</span></code></a> is provided, it must be before <a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_SECRET" title="PSA_KEY_DERIVATION_INPUT_SECRET"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_SECRET</span></code></a>. <a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_INFO" title="PSA_KEY_DERIVATION_INPUT_INFO"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_INFO</span></code></a> can be provided at any time after setup and before starting to generate output.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>HKDF processes the salt as follows: first hash it with <code class="docutils literal notranslate"><span class="pre">hash_alg</span></code> if the salt is longer than the block size of the hash algorithm; then pad with null bytes up to the block size. As a result, it is possible for distinct salt inputs to result in the same outputs. To ensure unique outputs, it is recommended to use a fixed length for salt values.</p>
</div>
<p>Each input may only be passed once.</p>
<p class="rubric">Compatible key types</p>
<div class="line-block">
<div class="line"><a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_DERIVE" title="PSA_KEY_TYPE_DERIVE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_DERIVE</span></code></a> (for the secret key)</div>
<div class="line"><a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_RAW_DATA" title="PSA_KEY_TYPE_RAW_DATA"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_RAW_DATA</span></code></a> (for the other inputs)</div>
</div>
</section>
<section id="c.PSA_ALG_HKDF_EXTRACT">
<h3><code class="docutils literal notranslate"><span class="pre">PSA_ALG_HKDF_EXTRACT</span></code> (macro)<a class="headerlink" href="#c.PSA_ALG_HKDF_EXTRACT" title="Link to this heading">¶</a></h3>
<p>Macro to build an HKDF-Extract algorithm.</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 1.1.</span></p>
</div>
<pre class="literal-block">#define <a class="reference internal" href="#c.PSA_ALG_HKDF_EXTRACT" title="PSA_ALG_HKDF_EXTRACT">PSA_ALG_HKDF_EXTRACT</a>(hash_alg) <em><a class="reference internal" href="../../overview/implementation.html#specification-defined-value"><span class="std std-ref">/* specification-defined value */</span></a></em></pre>
<p class="rubric">Parameters</p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">hash_alg</span></code></p>
</dt><dd><p>A hash algorithm: a value of type <a class="reference internal" href="algorithms.html#c.psa_algorithm_t" title="psa_algorithm_t"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_algorithm_t</span></code></a> such that <a class="reference internal" href="algorithms.html#c.PSA_ALG_IS_HASH" title="PSA_ALG_IS_HASH"><code class="docutils literal notranslate"><span class="pre">PSA_ALG_IS_HASH</span></code></a><code class="docutils literal notranslate"><span class="pre">(</span></code><code class="docutils literal notranslate"><span class="pre">hash_alg</span></code><code class="docutils literal notranslate"><span class="pre">)</span></code> is true.</p>
</dd>
</dl>
</div>
<p class="rubric">Returns</p>
<p>The corresponding HKDF-Extract algorithm. For example, <a class="reference internal" href="#c.PSA_ALG_HKDF_EXTRACT" title="PSA_ALG_HKDF_EXTRACT"><code class="docutils literal notranslate"><span class="pre">PSA_ALG_HKDF_EXTRACT</span></code></a><code class="docutils literal notranslate"><span class="pre">(</span></code><a class="reference internal" href="hash.html#c.PSA_ALG_SHA_256" title="PSA_ALG_SHA_256"><code class="docutils literal notranslate"><span class="pre">PSA_ALG_SHA_256</span></code></a><code class="docutils literal notranslate"><span class="pre">)</span></code> is HKDF-Extract using HMAC-SHA-256.</p>
<p>Unspecified if <code class="docutils literal notranslate"><span class="pre">hash_alg</span></code> is not a supported hash algorithm.</p>
<p class="rubric">Description</p>
<p>This is the Extract step of HKDF as specified by <span><em>HMAC-based Extract-and-Expand Key Derivation Function (HKDF)</em> <a class="reference internal" href="../../about.html#cite-rfc5869"><span class="cite">[RFC5869]</span></a></span> <a class="reference external" href="https://datatracker.ietf.org/doc/html/rfc5869.html#section-2.2">§2.2</a>.</p>
<p>This key-derivation algorithm uses the following inputs:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_SALT" title="PSA_KEY_DERIVATION_INPUT_SALT"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_SALT</span></code></a> is the salt.</p></li>
<li><p><a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_SECRET" title="PSA_KEY_DERIVATION_INPUT_SECRET"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_SECRET</span></code></a> is the input keying material used in the “extract” step.</p></li>
</ul>
<p>The inputs are mandatory and must be passed in the order above. Each input may only be passed once.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>HKDF-Extract is not meant to be used on its own. <a class="reference internal" href="#c.PSA_ALG_HKDF" title="PSA_ALG_HKDF"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_ALG_HKDF</span></code></a> should be used instead if possible. <a class="reference internal" href="#c.PSA_ALG_HKDF_EXTRACT" title="PSA_ALG_HKDF_EXTRACT"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_ALG_HKDF_EXTRACT</span></code></a> is provided as a separate algorithm for the sake of protocols that use it as a building block. It may also be a slight performance optimization in applications that use HKDF with the same salt and key but many different info strings.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>HKDF processes the salt as follows: first hash it with <code class="docutils literal notranslate"><span class="pre">hash_alg</span></code> if the salt is longer than the block size of the hash algorithm; then pad with null bytes up to the block size. As a result, it is possible for distinct salt inputs to result in the same outputs. To ensure unique outputs, it is recommended to use a fixed length for salt values.</p>
</div>
<p class="rubric">Compatible key types</p>
<div class="line-block">
<div class="line"><a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_DERIVE" title="PSA_KEY_TYPE_DERIVE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_DERIVE</span></code></a> (for the input keying material)</div>
<div class="line"><a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_RAW_DATA" title="PSA_KEY_TYPE_RAW_DATA"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_RAW_DATA</span></code></a> (for the salt)</div>
</div>
</section>
<section id="c.PSA_ALG_HKDF_EXPAND">
<h3><code class="docutils literal notranslate"><span class="pre">PSA_ALG_HKDF_EXPAND</span></code> (macro)<a class="headerlink" href="#c.PSA_ALG_HKDF_EXPAND" title="Link to this heading">¶</a></h3>
<p>Macro to build an HKDF-Expand algorithm.</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 1.1.</span></p>
</div>
<pre class="literal-block">#define <a class="reference internal" href="#c.PSA_ALG_HKDF_EXPAND" title="PSA_ALG_HKDF_EXPAND">PSA_ALG_HKDF_EXPAND</a>(hash_alg) <em><a class="reference internal" href="../../overview/implementation.html#specification-defined-value"><span class="std std-ref">/* specification-defined value */</span></a></em></pre>
<p class="rubric">Parameters</p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">hash_alg</span></code></p>
</dt><dd><p>A hash algorithm: a value of type <a class="reference internal" href="algorithms.html#c.psa_algorithm_t" title="psa_algorithm_t"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_algorithm_t</span></code></a> such that <a class="reference internal" href="algorithms.html#c.PSA_ALG_IS_HASH" title="PSA_ALG_IS_HASH"><code class="docutils literal notranslate"><span class="pre">PSA_ALG_IS_HASH</span></code></a><code class="docutils literal notranslate"><span class="pre">(</span></code><code class="docutils literal notranslate"><span class="pre">hash_alg</span></code><code class="docutils literal notranslate"><span class="pre">)</span></code> is true.</p>
</dd>
</dl>
</div>
<p class="rubric">Returns</p>
<p>The corresponding HKDF-Expand algorithm. For example, <a class="reference internal" href="#c.PSA_ALG_HKDF_EXPAND" title="PSA_ALG_HKDF_EXPAND"><code class="docutils literal notranslate"><span class="pre">PSA_ALG_HKDF_EXPAND</span></code></a><code class="docutils literal notranslate"><span class="pre">(</span></code><a class="reference internal" href="hash.html#c.PSA_ALG_SHA_256" title="PSA_ALG_SHA_256"><code class="docutils literal notranslate"><span class="pre">PSA_ALG_SHA_256</span></code></a><code class="docutils literal notranslate"><span class="pre">)</span></code> is HKDF-Expand using HMAC-SHA-256.</p>
<p>Unspecified if <code class="docutils literal notranslate"><span class="pre">hash_alg</span></code> is not a supported hash algorithm.</p>
<p class="rubric">Description</p>
<p>This is the Expand step of HKDF as specified by <span><em>HMAC-based Extract-and-Expand Key Derivation Function (HKDF)</em> <a class="reference internal" href="../../about.html#cite-rfc5869"><span class="cite">[RFC5869]</span></a></span> <a class="reference external" href="https://datatracker.ietf.org/doc/html/rfc5869.html#section-2.3">§2.3</a>.</p>
<p>This key-derivation algorithm uses the following inputs:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_SECRET" title="PSA_KEY_DERIVATION_INPUT_SECRET"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_SECRET</span></code></a> is the pseudorandom key (PRK).</p></li>
<li><p><a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_INFO" title="PSA_KEY_DERIVATION_INPUT_INFO"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_INFO</span></code></a> is the info string.</p></li>
</ul>
<p>The inputs are mandatory and must be passed in the order above. Each input may only be passed once.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>HKDF-Expand is not meant to be used on its own. <a class="reference internal" href="#c.PSA_ALG_HKDF" title="PSA_ALG_HKDF"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_ALG_HKDF</span></code></a> should be used instead if possible. <a class="reference internal" href="#c.PSA_ALG_HKDF_EXPAND" title="PSA_ALG_HKDF_EXPAND"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_ALG_HKDF_EXPAND</span></code></a> is provided as a separate algorithm for the sake of protocols that use it as a building block. It may also be a slight performance optimization in applications that use HKDF with the same salt and key but many different info strings.</p>
</div>
<p class="rubric">Compatible key types</p>
<div class="line-block">
<div class="line"><a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_DERIVE" title="PSA_KEY_TYPE_DERIVE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_DERIVE</span></code></a> (for the pseudorandom key)</div>
<div class="line"><a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_RAW_DATA" title="PSA_KEY_TYPE_RAW_DATA"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_RAW_DATA</span></code></a> (for the info string)</div>
</div>
</section>
<section id="c.PSA_ALG_SP800_108_COUNTER_HMAC">
<h3><code class="docutils literal notranslate"><span class="pre">PSA_ALG_SP800_108_COUNTER_HMAC</span></code> (macro)<a class="headerlink" href="#c.PSA_ALG_SP800_108_COUNTER_HMAC" title="Link to this heading">¶</a></h3>
<p>Macro to build a NIST SP 800-108 conformant, counter-mode KDF algorithm based on HMAC.</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 1.2.</span></p>
</div>
<pre class="literal-block">#define <a class="reference internal" href="#c.PSA_ALG_SP800_108_COUNTER_HMAC" title="PSA_ALG_SP800_108_COUNTER_HMAC">PSA_ALG_SP800_108_COUNTER_HMAC</a>(hash_alg) \
    <em><a class="reference internal" href="../../overview/implementation.html#specification-defined-value"><span class="std std-ref">/* specification-defined value */</span></a></em></pre>
<p class="rubric">Parameters</p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">hash_alg</span></code></p>
</dt><dd><p>A hash algorithm: a value of type <a class="reference internal" href="algorithms.html#c.psa_algorithm_t" title="psa_algorithm_t"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_algorithm_t</span></code></a> such that <a class="reference internal" href="algorithms.html#c.PSA_ALG_IS_HASH" title="PSA_ALG_IS_HASH"><code class="docutils literal notranslate"><span class="pre">PSA_ALG_IS_HASH</span></code></a><code class="docutils literal notranslate"><span class="pre">(</span></code><code class="docutils literal notranslate"><span class="pre">hash_alg</span></code><code class="docutils literal notranslate"><span class="pre">)</span></code> is true.</p>
</dd>
</dl>
</div>
<p class="rubric">Returns</p>
<p>The corresponding key-derivation algorithm. For example, the counter-mode KDF using HMAC-SHA-256 is <a class="reference internal" href="#c.PSA_ALG_SP800_108_COUNTER_HMAC" title="PSA_ALG_SP800_108_COUNTER_HMAC"><code class="docutils literal notranslate"><span class="pre">PSA_ALG_SP800_108_COUNTER_HMAC</span></code></a><code class="docutils literal notranslate"><span class="pre">(</span></code><a class="reference internal" href="hash.html#c.PSA_ALG_SHA_256" title="PSA_ALG_SHA_256"><code class="docutils literal notranslate"><span class="pre">PSA_ALG_SHA_256</span></code></a><code class="docutils literal notranslate"><span class="pre">)</span></code>.</p>
<p>Unspecified if <code class="docutils literal notranslate"><span class="pre">hash_alg</span></code> is not a supported hash algorithm.</p>
<p class="rubric">Description</p>
<p>This is an HMAC-based, counter mode key-derivation function, using the construction recommended by <span><em>NIST Special Publication 800-108r1: Recommendation for Key Derivation Using Pseudorandom Functions</em> <a class="reference internal" href="../../about.html#cite-sp800-108"><span class="cite">[SP800-108]</span></a></span>, §4.1.</p>
<p>This key-derivation algorithm uses the following inputs:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_SECRET" title="PSA_KEY_DERIVATION_INPUT_SECRET"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_SECRET</span></code></a> is the secret input keying material, <span class="math notranslate nohighlight">\(K_{IN}\)</span>.</p></li>
<li><p><a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_LABEL" title="PSA_KEY_DERIVATION_INPUT_LABEL"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_LABEL</span></code></a> is the <span class="math notranslate nohighlight">\(Label\)</span>. It is optional; if omitted, <span class="math notranslate nohighlight">\(Label\)</span> is a zero-length string. If provided, it must not contain any null bytes.</p></li>
<li><p><a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_CONTEXT" title="PSA_KEY_DERIVATION_INPUT_CONTEXT"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_CONTEXT</span></code></a> is the <span class="math notranslate nohighlight">\(Context\)</span>. It is optional; if omitted, <span class="math notranslate nohighlight">\(Context\)</span> is a zero-length string.</p></li>
</ul>
<p>Each input can only be passed once. Inputs must be passed in the order above.</p>
<p>This algorithm uses the output length as part of the derivation process. In the derivation this value is <span class="math notranslate nohighlight">\(L\)</span>, the required output size in bits. After setup, the initial capacity of the key-derivation operation is <span class="math notranslate nohighlight">\(2^{29}-1\)</span> bytes (<code class="docutils literal notranslate"><span class="pre">0x1fffffff</span></code>). The capacity can be set to a lower value by calling <a class="reference internal" href="#c.psa_key_derivation_set_capacity" title="psa_key_derivation_set_capacity"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_set_capacity()</span></code></a>.</p>
<p>When the first output is requested, the value of <span class="math notranslate nohighlight">\(L\)</span> is calculated as <span class="math notranslate nohighlight">\(L=8*cap\)</span>, where <span class="math notranslate nohighlight">\(cap\)</span> is the value of <a class="reference internal" href="#c.psa_key_derivation_get_capacity" title="psa_key_derivation_get_capacity"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_get_capacity()</span></code></a>. Subsequent calls to <a class="reference internal" href="#c.psa_key_derivation_set_capacity" title="psa_key_derivation_set_capacity"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_set_capacity()</span></code></a> are not permitted for this algorithm.</p>
<p>The derivation is constructed as described in <a class="reference internal" href="../../about.html#cite-sp800-108"><span class="cite">[SP800-108]</span></a> §4.1, with the iteration counter <span class="math notranslate nohighlight">\(i\)</span> and output length <span class="math notranslate nohighlight">\(L\)</span> encoded as big-endian, 32-bit values. The resulting output stream <span class="math notranslate nohighlight">\(K_1\ ||\ K_2\ ||\ K_3\ ||\ ...\)</span> is computed as:</p>
<div class="math notranslate nohighlight">
\[K_i = \text{HMAC}( K_{IN}, [i]_4\ ||\ Label\ ||\ \texttt{0x00}\ ||\ Context\ ||\ [L]_4 ),\quad\text{for }i = 1, 2, 3, ...\]</div>
<p>Where <span class="math notranslate nohighlight">\([x]_n\)</span> is the big-endian, <span class="math notranslate nohighlight">\(n\)</span>-byte encoding of the integer <span class="math notranslate nohighlight">\(x\)</span>.</p>
<p class="rubric">Compatible key types</p>
<div class="line-block">
<div class="line"><a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_HMAC" title="PSA_KEY_TYPE_HMAC"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_HMAC</span></code></a> (for the secret key)</div>
<div class="line"><a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_DERIVE" title="PSA_KEY_TYPE_DERIVE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_DERIVE</span></code></a> (for the secret key)</div>
<div class="line"><a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_RAW_DATA" title="PSA_KEY_TYPE_RAW_DATA"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_RAW_DATA</span></code></a> (for the other inputs)</div>
</div>
</section>
<section id="c.PSA_ALG_SP800_108_COUNTER_CMAC">
<h3><code class="docutils literal notranslate"><span class="pre">PSA_ALG_SP800_108_COUNTER_CMAC</span></code> (macro)<a class="headerlink" href="#c.PSA_ALG_SP800_108_COUNTER_CMAC" title="Link to this heading">¶</a></h3>
<p>Macro to build a NIST SP 800-108 conformant, counter-mode KDF algorithm based on CMAC.</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 1.2.</span></p>
</div>
<pre class="literal-block">#define <a class="reference internal" href="#c.PSA_ALG_SP800_108_COUNTER_CMAC" title="PSA_ALG_SP800_108_COUNTER_CMAC">PSA_ALG_SP800_108_COUNTER_CMAC</a> ((<a class="reference internal" href="algorithms.html#c.psa_algorithm_t" title="psa_algorithm_t">psa_algorithm_t</a>)0x08000800)</pre>
<p>This is a CMAC-based, counter mode key-derivation function, using the construction recommended by <span><em>NIST Special Publication 800-108r1: Recommendation for Key Derivation Using Pseudorandom Functions</em> <a class="reference internal" href="../../about.html#cite-sp800-108"><span class="cite">[SP800-108]</span></a></span>, §4.1.</p>
<p>This key-derivation algorithm uses the following inputs:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_SECRET" title="PSA_KEY_DERIVATION_INPUT_SECRET"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_SECRET</span></code></a> is the secret input keying material, <span class="math notranslate nohighlight">\(K_{IN}\)</span>. This must be a block-cipher key that is compatible with the CMAC algorithm, and must be input using <a class="reference internal" href="#c.psa_key_derivation_input_key" title="psa_key_derivation_input_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_input_key()</span></code></a>. See also <a class="reference internal" href="mac.html#c.PSA_ALG_CMAC" title="PSA_ALG_CMAC"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_ALG_CMAC</span></code></a>.</p></li>
<li><p><a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_LABEL" title="PSA_KEY_DERIVATION_INPUT_LABEL"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_LABEL</span></code></a> is the <span class="math notranslate nohighlight">\(Label\)</span>. It is optional; if omitted, <span class="math notranslate nohighlight">\(Label\)</span> is a zero-length string. If provided, it must not contain any null bytes.</p></li>
<li><p><a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_CONTEXT" title="PSA_KEY_DERIVATION_INPUT_CONTEXT"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_CONTEXT</span></code></a> is the <span class="math notranslate nohighlight">\(Context\)</span>. It is optional; if omitted, <span class="math notranslate nohighlight">\(Context\)</span> is a zero-length string.</p></li>
</ul>
<p>Each input can only be passed once. Inputs must be passed in the order above.</p>
<p>This algorithm uses the output length as part of the derivation process. In the derivation this value is <span class="math notranslate nohighlight">\(L\)</span>, the required output size in bits. After setup, the initial capacity of the key-derivation operation is <span class="math notranslate nohighlight">\(2^{29}-1\)</span> bytes (<code class="docutils literal notranslate"><span class="pre">0x1fffffff</span></code>). The capacity can be set to a lower value by calling <a class="reference internal" href="#c.psa_key_derivation_set_capacity" title="psa_key_derivation_set_capacity"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_set_capacity()</span></code></a>.</p>
<p>When the first output is requested, the value of <span class="math notranslate nohighlight">\(L\)</span> is calculated as <span class="math notranslate nohighlight">\(L=8*cap\)</span>, where <span class="math notranslate nohighlight">\(cap\)</span> is the value of <a class="reference internal" href="#c.psa_key_derivation_get_capacity" title="psa_key_derivation_get_capacity"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_get_capacity()</span></code></a>. Subsequent calls to <a class="reference internal" href="#c.psa_key_derivation_set_capacity" title="psa_key_derivation_set_capacity"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_set_capacity()</span></code></a> are not permitted for this algorithm.</p>
<p>The derivation is constructed as described in <a class="reference internal" href="../../about.html#cite-sp800-108"><span class="cite">[SP800-108]</span></a> §4.1, with the following details:</p>
<ul class="simple">
<li><p>The iteration counter <span class="math notranslate nohighlight">\(i\)</span> and output length <span class="math notranslate nohighlight">\(L\)</span> are encoded as big-endian, 32-bit values.</p></li>
<li><p>The mitigation to make the CMAC-based construction robust is implemented.</p></li>
</ul>
<p>The resulting output stream <span class="math notranslate nohighlight">\(K_1\ ||\ K_2\ ||\ K_3\ ||\ ...\)</span> is computed as:</p>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}K_0 &amp;= \text{CMAC}( K_{IN}, Label\ ||\ \texttt{0x00}\ ||\ Context\ ||\ [L]_4\ )\\K_i &amp;= \text{CMAC}( K_{IN}, [i]_4\ ||\ Label\ ||\ \texttt{0x00}\ ||\ Context\ ||\ [L]_4\ ||\ K_0 ),\quad\text{for }i = 1, 2, 3, ...\end{aligned}\end{align} \]</div>
<p>Where <span class="math notranslate nohighlight">\([x]_n\)</span> is the big-endian, <span class="math notranslate nohighlight">\(n\)</span>-byte encoding of the integer <span class="math notranslate nohighlight">\(x\)</span>.</p>
<p class="rubric">Compatible key types</p>
<div class="line-block">
<div class="line"><a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_AES" title="PSA_KEY_TYPE_AES"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_AES</span></code></a> (for the secret key)</div>
<div class="line"><a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_ARIA" title="PSA_KEY_TYPE_ARIA"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_ARIA</span></code></a> (for the secret key)</div>
<div class="line"><a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_CAMELLIA" title="PSA_KEY_TYPE_CAMELLIA"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_CAMELLIA</span></code></a> (for the secret key)</div>
<div class="line"><a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_SM4" title="PSA_KEY_TYPE_SM4"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_SM4</span></code></a> (for the secret key)</div>
<div class="line"><a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_RAW_DATA" title="PSA_KEY_TYPE_RAW_DATA"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_RAW_DATA</span></code></a> (for the other inputs)</div>
</div>
</section>
<section id="c.PSA_ALG_TLS12_PRF">
<h3><code class="docutils literal notranslate"><span class="pre">PSA_ALG_TLS12_PRF</span></code> (macro)<a class="headerlink" href="#c.PSA_ALG_TLS12_PRF" title="Link to this heading">¶</a></h3>
<p>Macro to build a TLS-1.2 PRF algorithm.</p>
<pre class="literal-block">#define <a class="reference internal" href="#c.PSA_ALG_TLS12_PRF" title="PSA_ALG_TLS12_PRF">PSA_ALG_TLS12_PRF</a>(hash_alg) <em><a class="reference internal" href="../../overview/implementation.html#specification-defined-value"><span class="std std-ref">/* specification-defined value */</span></a></em></pre>
<p class="rubric">Parameters</p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">hash_alg</span></code></p>
</dt><dd><p>A hash algorithm: a value of type <a class="reference internal" href="algorithms.html#c.psa_algorithm_t" title="psa_algorithm_t"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_algorithm_t</span></code></a> such that <a class="reference internal" href="algorithms.html#c.PSA_ALG_IS_HASH" title="PSA_ALG_IS_HASH"><code class="docutils literal notranslate"><span class="pre">PSA_ALG_IS_HASH</span></code></a><code class="docutils literal notranslate"><span class="pre">(</span></code><code class="docutils literal notranslate"><span class="pre">hash_alg</span></code><code class="docutils literal notranslate"><span class="pre">)</span></code> is true.</p>
</dd>
</dl>
</div>
<p class="rubric">Returns</p>
<p>The corresponding TLS-1.2 PRF algorithm. For example, <a class="reference internal" href="#c.PSA_ALG_TLS12_PRF" title="PSA_ALG_TLS12_PRF"><code class="docutils literal notranslate"><span class="pre">PSA_ALG_TLS12_PRF</span></code></a><code class="docutils literal notranslate"><span class="pre">(</span></code><a class="reference internal" href="hash.html#c.PSA_ALG_SHA_256" title="PSA_ALG_SHA_256"><code class="docutils literal notranslate"><span class="pre">PSA_ALG_SHA_256</span></code></a><code class="docutils literal notranslate"><span class="pre">)</span></code> represents the TLS 1.2 PRF using HMAC-SHA-256.</p>
<p>Unspecified if <code class="docutils literal notranslate"><span class="pre">hash_alg</span></code> is not a supported hash algorithm.</p>
<p class="rubric">Description</p>
<p>TLS 1.2 uses a custom pseudorandom function (PRF) for key schedule, specified in <span><em>The Transport Layer Security (TLS) Protocol Version 1.2</em> <a class="reference internal" href="../../about.html#cite-rfc5246"><span class="cite">[RFC5246]</span></a></span> <a class="reference external" href="https://datatracker.ietf.org/doc/html/rfc5246.html#section-5">§5</a>. It is based on HMAC and can be used with either SHA-256 or SHA-384.</p>
<p>This key-derivation algorithm uses the following inputs, which must be passed in the order given here:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_SEED" title="PSA_KEY_DERIVATION_INPUT_SEED"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_SEED</span></code></a> is the seed.</p></li>
<li><p><a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_SECRET" title="PSA_KEY_DERIVATION_INPUT_SECRET"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_SECRET</span></code></a> is the secret key.</p></li>
<li><p><a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_LABEL" title="PSA_KEY_DERIVATION_INPUT_LABEL"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_LABEL</span></code></a> is the label.</p></li>
</ul>
<p>Each input may only be passed once.</p>
<p>For the application to TLS-1.2 key expansion:</p>
<ul class="simple">
<li><p>The seed is the concatenation of <code class="docutils literal notranslate"><span class="pre">ServerHello.Random</span> <span class="pre">+</span> <span class="pre">ClientHello.Random</span></code>.</p></li>
<li><p>The label is <code class="docutils literal notranslate"><span class="pre">&quot;key</span> <span class="pre">expansion&quot;</span></code>.</p></li>
</ul>
<p class="rubric">Compatible key types</p>
<div class="line-block">
<div class="line"><a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_DERIVE" title="PSA_KEY_TYPE_DERIVE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_DERIVE</span></code></a> (for the secret key)</div>
<div class="line"><a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_RAW_DATA" title="PSA_KEY_TYPE_RAW_DATA"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_RAW_DATA</span></code></a> (for the other inputs)</div>
</div>
</section>
<section id="c.PSA_ALG_TLS12_PSK_TO_MS">
<h3><code class="docutils literal notranslate"><span class="pre">PSA_ALG_TLS12_PSK_TO_MS</span></code> (macro)<a class="headerlink" href="#c.PSA_ALG_TLS12_PSK_TO_MS" title="Link to this heading">¶</a></h3>
<p>Macro to build a TLS-1.2 PSK-to-MasterSecret algorithm.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.1: </span>Added step to support cipher-suites that include a key-exchange.</p>
</div>
<pre class="literal-block">#define <a class="reference internal" href="#c.PSA_ALG_TLS12_PSK_TO_MS" title="PSA_ALG_TLS12_PSK_TO_MS">PSA_ALG_TLS12_PSK_TO_MS</a>(hash_alg) <em><a class="reference internal" href="../../overview/implementation.html#specification-defined-value"><span class="std std-ref">/* specification-defined value */</span></a></em></pre>
<p class="rubric">Parameters</p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">hash_alg</span></code></p>
</dt><dd><p>A hash algorithm: a value of type <a class="reference internal" href="algorithms.html#c.psa_algorithm_t" title="psa_algorithm_t"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_algorithm_t</span></code></a> such that <a class="reference internal" href="algorithms.html#c.PSA_ALG_IS_HASH" title="PSA_ALG_IS_HASH"><code class="docutils literal notranslate"><span class="pre">PSA_ALG_IS_HASH</span></code></a><code class="docutils literal notranslate"><span class="pre">(</span></code><code class="docutils literal notranslate"><span class="pre">hash_alg</span></code><code class="docutils literal notranslate"><span class="pre">)</span></code> is true.</p>
</dd>
</dl>
</div>
<p class="rubric">Returns</p>
<p>The corresponding TLS-1.2 PSK to MS algorithm. For example, <a class="reference internal" href="#c.PSA_ALG_TLS12_PSK_TO_MS" title="PSA_ALG_TLS12_PSK_TO_MS"><code class="docutils literal notranslate"><span class="pre">PSA_ALG_TLS12_PSK_TO_MS</span></code></a><code class="docutils literal notranslate"><span class="pre">(</span></code><a class="reference internal" href="hash.html#c.PSA_ALG_SHA_256" title="PSA_ALG_SHA_256"><code class="docutils literal notranslate"><span class="pre">PSA_ALG_SHA_256</span></code></a><code class="docutils literal notranslate"><span class="pre">)</span></code> represents the TLS-1.2 PSK to MasterSecret derivation PRF using HMAC-SHA-256.</p>
<p>Unspecified if <code class="docutils literal notranslate"><span class="pre">hash_alg</span></code> is not a supported hash algorithm.</p>
<p class="rubric">Description</p>
<p>In a pure-PSK handshake in TLS 1.2, the master secret (MS) is derived from the pre-shared key (PSK) through the application of padding (<span><em>Pre-Shared Key Ciphersuites for Transport Layer Security (TLS)</em> <a class="reference internal" href="../../about.html#cite-rfc4279"><span class="cite">[RFC4279]</span></a></span> <a class="reference external" href="https://datatracker.ietf.org/doc/html/rfc4279.html#section-2">§2</a>) and the TLS-1.2 PRF (<span><em>The Transport Layer Security (TLS) Protocol Version 1.2</em> <a class="reference internal" href="../../about.html#cite-rfc5246"><span class="cite">[RFC5246]</span></a></span> <a class="reference external" href="https://datatracker.ietf.org/doc/html/rfc5246.html#section-5">§5</a>). The latter is based on HMAC and can be used with either SHA-256 or SHA-384.</p>
<p>This key-derivation algorithm uses the following inputs, which must be passed in the order given here:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_SEED" title="PSA_KEY_DERIVATION_INPUT_SEED"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_SEED</span></code></a> is the seed.</p></li>
<li><p><a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_OTHER_SECRET" title="PSA_KEY_DERIVATION_INPUT_OTHER_SECRET"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_OTHER_SECRET</span></code></a> is the other secret for the computation of the premaster secret. This input is optional; if omitted, it defaults to a string of null bytes with the same length as the secret (PSK) input.</p></li>
<li><p><a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_SECRET" title="PSA_KEY_DERIVATION_INPUT_SECRET"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_SECRET</span></code></a> is the PSK. The PSK must not be larger than <a class="reference internal" href="#c.PSA_TLS12_PSK_TO_MS_PSK_MAX_SIZE" title="PSA_TLS12_PSK_TO_MS_PSK_MAX_SIZE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_TLS12_PSK_TO_MS_PSK_MAX_SIZE</span></code></a>.</p></li>
<li><p><a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_LABEL" title="PSA_KEY_DERIVATION_INPUT_LABEL"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_LABEL</span></code></a> is the label.</p></li>
</ul>
<p>Each input may only be passed once.</p>
<p>For the application to TLS-1.2:</p>
<ul class="simple">
<li><p>The seed, which is forwarded to the TLS-1.2 PRF, is the concatenation of the <code class="docutils literal notranslate"><span class="pre">ClientHello.Random</span> <span class="pre">+</span> <span class="pre">ServerHello.Random</span></code>.</p></li>
<li><p>The other secret depends on the key exchange specified in the cipher suite:</p>
<ul>
<li><p>For a plain PSK cipher suite (<a class="reference internal" href="../../about.html#cite-rfc4279"><span class="cite">[RFC4279]</span></a> <a class="reference external" href="https://datatracker.ietf.org/doc/html/rfc4279.html#section-2">§2</a>), omit <a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_OTHER_SECRET" title="PSA_KEY_DERIVATION_INPUT_OTHER_SECRET"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_OTHER_SECRET</span></code></a>.</p></li>
<li><p>For a DHE-PSK (<a class="reference internal" href="../../about.html#cite-rfc4279"><span class="cite">[RFC4279]</span></a> <a class="reference external" href="https://datatracker.ietf.org/doc/html/rfc4279.html#section-3">§3</a>) or ECDHE-PSK cipher suite (<span><em>ECDHE_PSK Cipher Suites for Transport Layer Security (TLS)</em> <a class="reference internal" href="../../about.html#cite-rfc5489"><span class="cite">[RFC5489]</span></a></span> <a class="reference external" href="https://datatracker.ietf.org/doc/html/rfc5489.html#section-2">§2</a>), the other secret should be the output of the <a class="reference internal" href="key-agreement.html#c.PSA_ALG_FFDH" title="PSA_ALG_FFDH"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_ALG_FFDH</span></code></a> or <a class="reference internal" href="key-agreement.html#c.PSA_ALG_ECDH" title="PSA_ALG_ECDH"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_ALG_ECDH</span></code></a> key agreement performed with the peer. The recommended way to pass this input is to use a key-derivation algorithm constructed as <a class="reference internal" href="key-agreement.html#c.PSA_ALG_KEY_AGREEMENT" title="PSA_ALG_KEY_AGREEMENT"><code class="docutils literal notranslate"><span class="pre">PSA_ALG_KEY_AGREEMENT</span></code></a><code class="docutils literal notranslate"><span class="pre">(</span></code><code class="docutils literal notranslate"><span class="pre">ka_alg</span></code><code class="docutils literal notranslate"><span class="pre">,</span> </code><a class="reference internal" href="#c.PSA_ALG_TLS12_PSK_TO_MS" title="PSA_ALG_TLS12_PSK_TO_MS"><code class="docutils literal notranslate"><span class="pre">PSA_ALG_TLS12_PSK_TO_MS</span></code></a><code class="docutils literal notranslate"><span class="pre">(</span></code><code class="docutils literal notranslate"><span class="pre">hash_alg</span></code><code class="docutils literal notranslate"><span class="pre">))</span></code> and to call <a class="reference internal" href="key-agreement.html#c.psa_key_derivation_key_agreement" title="psa_key_derivation_key_agreement"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_key_agreement()</span></code></a>. Alternatively, this input may be an output of <a class="reference internal" href="key-agreement.html#c.psa_key_agreement" title="psa_key_agreement"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_agreement()</span></code></a> passed with <a class="reference internal" href="#c.psa_key_derivation_input_key" title="psa_key_derivation_input_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_input_key()</span></code></a>, or an equivalent input passed with <a class="reference internal" href="#c.psa_key_derivation_input_bytes" title="psa_key_derivation_input_bytes"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_input_bytes()</span></code></a> or <a class="reference internal" href="#c.psa_key_derivation_input_key" title="psa_key_derivation_input_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_input_key()</span></code></a>.</p></li>
<li><p>For a RSA-PSK cipher suite (<a class="reference internal" href="../../about.html#cite-rfc4279"><span class="cite">[RFC4279]</span></a> <a class="reference external" href="https://datatracker.ietf.org/doc/html/rfc4279.html#section-4">§4</a>), the other secret should be the 48-byte client challenge (the <code class="docutils literal notranslate"><span class="pre">PreMasterSecret</span></code> of <a class="reference internal" href="../../about.html#cite-rfc5246"><span class="cite">[RFC5246]</span></a> <a class="reference external" href="https://datatracker.ietf.org/doc/html/rfc5246.html#section-7.4.7.1">§7.4.7.1</a>) concatenation of the TLS version and a 46-byte random string chosen by the client. On the server, this is typically an output of <a class="reference internal" href="pk-encryption.html#c.psa_asymmetric_decrypt" title="psa_asymmetric_decrypt"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_asymmetric_decrypt()</span></code></a> using <a class="reference internal" href="pk-encryption.html#c.PSA_ALG_RSA_PKCS1V15_CRYPT" title="PSA_ALG_RSA_PKCS1V15_CRYPT"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_ALG_RSA_PKCS1V15_CRYPT</span></code></a>, passed to the key-derivation operation with <a class="reference internal" href="#c.psa_key_derivation_input_bytes" title="psa_key_derivation_input_bytes"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_input_bytes()</span></code></a>.</p></li>
</ul>
</li>
<li><p>The label is <code class="docutils literal notranslate"><span class="pre">&quot;master</span> <span class="pre">secret&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;extended</span> <span class="pre">master</span> <span class="pre">secret&quot;</span></code>.</p></li>
</ul>
<p class="rubric">Compatible key types</p>
<div class="line-block">
<div class="line"><a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_DERIVE" title="PSA_KEY_TYPE_DERIVE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_DERIVE</span></code></a> (for the PSK)</div>
<div class="line"><a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_RAW_DATA" title="PSA_KEY_TYPE_RAW_DATA"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_RAW_DATA</span></code></a> (for the other inputs)</div>
</div>
</section>
<section id="c.PSA_ALG_TLS12_ECJPAKE_TO_PMS">
<h3><code class="docutils literal notranslate"><span class="pre">PSA_ALG_TLS12_ECJPAKE_TO_PMS</span></code> (macro)<a class="headerlink" href="#c.PSA_ALG_TLS12_ECJPAKE_TO_PMS" title="Link to this heading">¶</a></h3>
<p>The TLS 1.2 ECJPAKE-to-PMS key-derivation algorithm.</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 1.2.</span></p>
</div>
<pre class="literal-block">#define <a class="reference internal" href="#c.PSA_ALG_TLS12_ECJPAKE_TO_PMS" title="PSA_ALG_TLS12_ECJPAKE_TO_PMS">PSA_ALG_TLS12_ECJPAKE_TO_PMS</a> ((<a class="reference internal" href="algorithms.html#c.psa_algorithm_t" title="psa_algorithm_t">psa_algorithm_t</a>)0x08000609)</pre>
<p>This KDF is defined in <span><em>Elliptic Curve J-PAKE Cipher Suites for Transport Layer Security (TLS)</em> <a class="reference internal" href="../../about.html#cite-tls-ecjpake"><span class="cite">[TLS-ECJPAKE]</span></a></span> §8.7. This specifies the use of a KDF to derive the TLS 1.2 session secrets from the output of EC J-PAKE over the secp256r1 Elliptic curve (the 256-bit curve in <a class="reference internal" href="../keys/types.html#c.PSA_ECC_FAMILY_SECP_R1" title="PSA_ECC_FAMILY_SECP_R1"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_ECC_FAMILY_SECP_R1</span></code></a>). EC J-PAKE operations can be performed using a PAKE operation, see <a class="reference internal" href="pake.html#pake"><span class="secref">Password-authenticated key exchange (PAKE)</span></a>.</p>
<p>This KDF takes the shared secret <span class="math notranslate nohighlight">\(K`\)</span> (an uncompressed EC point in case of EC J-PAKE) and calculates <span class="math notranslate nohighlight">\(\text{SHA256}(K.x)\)</span>.</p>
<p>This function takes a single input:</p>
<ul>
<li><p><a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_SECRET" title="PSA_KEY_DERIVATION_INPUT_SECRET"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_SECRET</span></code></a> is the shared secret <span class="math notranslate nohighlight">\(K\)</span> from EC J-PAKE. For secp256r1, the input is exactly 65 bytes.</p>
<p>The shared secret can be obtained by calling <a class="reference internal" href="pake.html#c.psa_pake_get_shared_key" title="psa_pake_get_shared_key"><code class="docutils literal notranslate"><span class="pre">psa_pake_get_shared_key</span></code></a><code class="docutils literal notranslate"><span class="pre">()</span></code> on a PAKE operation that is performing the EC J-PAKE algorithm. See <a class="reference internal" href="pake.html#pake"><span class="secref">Password-authenticated key exchange (PAKE)</span></a>.</p>
</li>
</ul>
<p>The 32-byte output has to be read in a single call to either <a class="reference internal" href="#c.psa_key_derivation_output_bytes" title="psa_key_derivation_output_bytes"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_output_bytes()</span></code></a>, <a class="reference internal" href="#c.psa_key_derivation_output_key" title="psa_key_derivation_output_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_output_key()</span></code></a>, or <a class="reference internal" href="#c.psa_key_derivation_output_key_custom" title="psa_key_derivation_output_key_custom"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_output_key_custom()</span></code></a>. The size of the output is defined as <a class="reference internal" href="#c.PSA_TLS12_ECJPAKE_TO_PMS_OUTPUT_SIZE" title="PSA_TLS12_ECJPAKE_TO_PMS_OUTPUT_SIZE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_TLS12_ECJPAKE_TO_PMS_OUTPUT_SIZE</span></code></a>.</p>
<p class="rubric">Compatible key types</p>
<div class="line-block">
<div class="line"><a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_DERIVE" title="PSA_KEY_TYPE_DERIVE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_DERIVE</span></code></a> — the secret key is extracted from a PAKE operation by calling <a class="reference internal" href="pake.html#c.psa_pake_get_shared_key" title="psa_pake_get_shared_key"><code class="docutils literal notranslate"><span class="pre">psa_pake_get_shared_key</span></code></a><code class="docutils literal notranslate"><span class="pre">()</span></code>.</div>
</div>
</section>
<section id="c.PSA_ALG_PBKDF2_HMAC">
<h3><code class="docutils literal notranslate"><span class="pre">PSA_ALG_PBKDF2_HMAC</span></code> (macro)<a class="headerlink" href="#c.PSA_ALG_PBKDF2_HMAC" title="Link to this heading">¶</a></h3>
<p>Macro to build a PBKDF2-HMAC password-hashing or key-stretching algorithm.</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 1.1.</span></p>
</div>
<pre class="literal-block">#define <a class="reference internal" href="#c.PSA_ALG_PBKDF2_HMAC" title="PSA_ALG_PBKDF2_HMAC">PSA_ALG_PBKDF2_HMAC</a>(hash_alg) <em><a class="reference internal" href="../../overview/implementation.html#specification-defined-value"><span class="std std-ref">/* specification-defined value */</span></a></em></pre>
<p class="rubric">Parameters</p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">hash_alg</span></code></p>
</dt><dd><p>A hash algorithm: a value of type <a class="reference internal" href="algorithms.html#c.psa_algorithm_t" title="psa_algorithm_t"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_algorithm_t</span></code></a> such that <a class="reference internal" href="algorithms.html#c.PSA_ALG_IS_HASH" title="PSA_ALG_IS_HASH"><code class="docutils literal notranslate"><span class="pre">PSA_ALG_IS_HASH</span></code></a><code class="docutils literal notranslate"><span class="pre">(</span></code><code class="docutils literal notranslate"><span class="pre">hash_alg</span></code><code class="docutils literal notranslate"><span class="pre">)</span></code> is true.</p>
</dd>
</dl>
</div>
<p class="rubric">Returns</p>
<p>The corresponding PBKDF2-HMAC-XXX algorithm. For example, <a class="reference internal" href="#c.PSA_ALG_PBKDF2_HMAC" title="PSA_ALG_PBKDF2_HMAC"><code class="docutils literal notranslate"><span class="pre">PSA_ALG_PBKDF2_HMAC</span></code></a><code class="docutils literal notranslate"><span class="pre">(</span></code><a class="reference internal" href="hash.html#c.PSA_ALG_SHA_256" title="PSA_ALG_SHA_256"><code class="docutils literal notranslate"><span class="pre">PSA_ALG_SHA_256</span></code></a><code class="docutils literal notranslate"><span class="pre">)</span></code> is the algorithm identifier for PBKDF2-HMAC-SHA-256.</p>
<p>Unspecified if <code class="docutils literal notranslate"><span class="pre">hash_alg</span></code> is not a supported hash algorithm.</p>
<p class="rubric">Description</p>
<p>PBKDF2 is specified by <span><em>PKCS #5: Password-Based Cryptography Specification Version 2.1</em> <a class="reference internal" href="../../about.html#cite-rfc8018"><span class="cite">[RFC8018]</span></a></span> <a class="reference external" href="https://datatracker.ietf.org/doc/html/rfc8018.html#section-5.2">§5.2</a>. This macro constructs a PBKDF2 algorithm that uses a pseudorandom function based on HMAC with the specified hash.</p>
<p>This key-derivation algorithm uses the following inputs, which must be provided in the following order:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_COST" title="PSA_KEY_DERIVATION_INPUT_COST"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_COST</span></code></a> is the iteration count.
This input step must be used exactly once.</p></li>
<li><p><a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_SALT" title="PSA_KEY_DERIVATION_INPUT_SALT"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_SALT</span></code></a> is the salt.
This input step must be used one or more times; if used several times, the inputs will be concatenated.
This can be used to build the final salt from multiple sources, both public and secret (also known as pepper).</p></li>
<li><p><a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_PASSWORD" title="PSA_KEY_DERIVATION_INPUT_PASSWORD"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_PASSWORD</span></code></a> is the password to be hashed.
This input step must be used exactly once.</p></li>
</ul>
<p class="rubric">Compatible key types</p>
<div class="line-block">
<div class="line"><a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_DERIVE" title="PSA_KEY_TYPE_DERIVE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_DERIVE</span></code></a> (for password input)</div>
<div class="line"><a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_PASSWORD" title="PSA_KEY_TYPE_PASSWORD"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_PASSWORD</span></code></a> (for password input)</div>
<div class="line"><a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_PEPPER" title="PSA_KEY_TYPE_PEPPER"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_PEPPER</span></code></a> (for salt input)</div>
<div class="line"><a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_RAW_DATA" title="PSA_KEY_TYPE_RAW_DATA"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_RAW_DATA</span></code></a> (for salt input)</div>
<div class="line"><a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_PASSWORD_HASH" title="PSA_KEY_TYPE_PASSWORD_HASH"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_PASSWORD_HASH</span></code></a> (for key verification)</div>
</div>
</section>
<section id="c.PSA_ALG_PBKDF2_AES_CMAC_PRF_128">
<h3><code class="docutils literal notranslate"><span class="pre">PSA_ALG_PBKDF2_AES_CMAC_PRF_128</span></code> (macro)<a class="headerlink" href="#c.PSA_ALG_PBKDF2_AES_CMAC_PRF_128" title="Link to this heading">¶</a></h3>
<p>The PBKDF2-AES-CMAC-PRF-128 password-hashing or key-stretching algorithm.</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 1.1.</span></p>
</div>
<pre class="literal-block">#define <a class="reference internal" href="#c.PSA_ALG_PBKDF2_AES_CMAC_PRF_128" title="PSA_ALG_PBKDF2_AES_CMAC_PRF_128">PSA_ALG_PBKDF2_AES_CMAC_PRF_128</a> ((<a class="reference internal" href="algorithms.html#c.psa_algorithm_t" title="psa_algorithm_t">psa_algorithm_t</a>)0x08800200)</pre>
<p>PBKDF2 is specified by <span><em>PKCS #5: Password-Based Cryptography Specification Version 2.1</em> <a class="reference internal" href="../../about.html#cite-rfc8018"><span class="cite">[RFC8018]</span></a></span> <a class="reference external" href="https://datatracker.ietf.org/doc/html/rfc8018.html#section-5.2">§5.2</a>. This algorithm specifies the PBKDF2 algorithm using the AES-CMAC-PRF-128 pseudorandom function specified by <a class="reference internal" href="../../about.html#cite-rfc4615"><span class="cite">[RFC4615]</span></a></p>
<p>This key-derivation algorithm uses the same inputs as <a class="reference internal" href="#c.PSA_ALG_PBKDF2_HMAC" title="PSA_ALG_PBKDF2_HMAC"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_ALG_PBKDF2_HMAC()</span></code></a> with the same constraints.</p>
<p class="rubric">Compatible key types</p>
<div class="line-block">
<div class="line"><a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_DERIVE" title="PSA_KEY_TYPE_DERIVE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_DERIVE</span></code></a> (for password input)</div>
<div class="line"><a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_PASSWORD" title="PSA_KEY_TYPE_PASSWORD"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_PASSWORD</span></code></a> (for password input)</div>
<div class="line"><a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_PEPPER" title="PSA_KEY_TYPE_PEPPER"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_PEPPER</span></code></a> (for salt input)</div>
<div class="line"><a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_RAW_DATA" title="PSA_KEY_TYPE_RAW_DATA"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_RAW_DATA</span></code></a> (for salt input)</div>
<div class="line"><a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_PASSWORD_HASH" title="PSA_KEY_TYPE_PASSWORD_HASH"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_PASSWORD_HASH</span></code></a> (for key verification)</div>
</div>
</section>
</section>
<section id="input-step-types">
<h2><span class="section-number">10.6.2 </span>Input step types<a class="headerlink" href="#input-step-types" title="Link to this heading">¶</a></h2>
<section id="c.psa_key_derivation_step_t">
<h3><code class="docutils literal notranslate"><span class="pre">psa_key_derivation_step_t</span></code> (typedef)<a class="headerlink" href="#c.psa_key_derivation_step_t" title="Link to this heading">¶</a></h3>
<p>Encoding of the step of a key derivation.</p>
<pre class="literal-block">typedef uint16_t <a class="reference internal" href="#c.psa_key_derivation_step_t" title="psa_key_derivation_step_t">psa_key_derivation_step_t</a>;</pre>
<div class="admonition-implementation-note admonition">
<p class="admonition-title">Implementation note</p>
<p>It is recommended that the value <code class="docutils literal notranslate"><span class="pre">0</span></code> is not allocated as a valid key-derivation step.</p>
</div>
</section>
<section id="c.PSA_KEY_DERIVATION_INPUT_SECRET">
<h3><code class="docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_SECRET</span></code> (macro)<a class="headerlink" href="#c.PSA_KEY_DERIVATION_INPUT_SECRET" title="Link to this heading">¶</a></h3>
<p>A high-entropy secret input for key derivation.</p>
<pre class="literal-block">#define <a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_SECRET" title="PSA_KEY_DERIVATION_INPUT_SECRET">PSA_KEY_DERIVATION_INPUT_SECRET</a> <em><a class="reference internal" href="../../overview/implementation.html#implementation-defined-value"><span class="std std-ref">/* implementation-defined value */</span></a></em></pre>
<p>This is typically a key of type <a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_DERIVE" title="PSA_KEY_TYPE_DERIVE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_DERIVE</span></code></a> passed to <a class="reference internal" href="#c.psa_key_derivation_input_key" title="psa_key_derivation_input_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_input_key()</span></code></a>, or the shared secret resulting from a key agreement obtained via <a class="reference internal" href="key-agreement.html#c.psa_key_derivation_key_agreement" title="psa_key_derivation_key_agreement"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_key_agreement()</span></code></a>.</p>
<p>For some algorithms, a specific type of key is required. For example, see <a class="reference internal" href="#c.PSA_ALG_SP800_108_COUNTER_CMAC" title="PSA_ALG_SP800_108_COUNTER_CMAC"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_ALG_SP800_108_COUNTER_CMAC</span></code></a>.</p>
<p>The secret can also be a direct input passed to <a class="reference internal" href="#c.psa_key_derivation_input_bytes" title="psa_key_derivation_input_bytes"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_input_bytes()</span></code></a>. In this case, the derivation operation cannot be used to derive keys: the operation will not permit a call to <a class="reference internal" href="#c.psa_key_derivation_output_key" title="psa_key_derivation_output_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_output_key()</span></code></a> or <a class="reference internal" href="#c.psa_key_derivation_output_key_custom" title="psa_key_derivation_output_key_custom"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_output_key_custom()</span></code></a>.</p>
</section>
<section id="c.PSA_KEY_DERIVATION_INPUT_OTHER_SECRET">
<h3><code class="docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_OTHER_SECRET</span></code> (macro)<a class="headerlink" href="#c.PSA_KEY_DERIVATION_INPUT_OTHER_SECRET" title="Link to this heading">¶</a></h3>
<p>A high-entropy additional secret input for key derivation.</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 1.1.</span></p>
</div>
<pre class="literal-block">#define <a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_OTHER_SECRET" title="PSA_KEY_DERIVATION_INPUT_OTHER_SECRET">PSA_KEY_DERIVATION_INPUT_OTHER_SECRET</a> \
    <em><a class="reference internal" href="../../overview/implementation.html#implementation-defined-value"><span class="std std-ref">/* implementation-defined value */</span></a></em></pre>
<p>This is typically the shared secret resulting from a key agreement obtained via <a class="reference internal" href="key-agreement.html#c.psa_key_derivation_key_agreement" title="psa_key_derivation_key_agreement"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_key_agreement()</span></code></a>. It may alternatively be a key of type <a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_DERIVE" title="PSA_KEY_TYPE_DERIVE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_DERIVE</span></code></a> passed to <a class="reference internal" href="#c.psa_key_derivation_input_key" title="psa_key_derivation_input_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_input_key()</span></code></a>, or a direct input passed to <a class="reference internal" href="#c.psa_key_derivation_input_bytes" title="psa_key_derivation_input_bytes"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_input_bytes()</span></code></a>.</p>
</section>
<section id="c.PSA_KEY_DERIVATION_INPUT_PASSWORD">
<h3><code class="docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_PASSWORD</span></code> (macro)<a class="headerlink" href="#c.PSA_KEY_DERIVATION_INPUT_PASSWORD" title="Link to this heading">¶</a></h3>
<p>A low-entropy secret input for password hashing or key stretching.</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 1.1.</span></p>
</div>
<pre class="literal-block">#define <a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_PASSWORD" title="PSA_KEY_DERIVATION_INPUT_PASSWORD">PSA_KEY_DERIVATION_INPUT_PASSWORD</a> <em><a class="reference internal" href="../../overview/implementation.html#implementation-defined-value"><span class="std std-ref">/* implementation-defined value */</span></a></em></pre>
<p>This is usually a key of type <a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_PASSWORD" title="PSA_KEY_TYPE_PASSWORD"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_PASSWORD</span></code></a> passed to <a class="reference internal" href="#c.psa_key_derivation_input_key" title="psa_key_derivation_input_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_input_key()</span></code></a> or a direct input passed to <a class="reference internal" href="#c.psa_key_derivation_input_bytes" title="psa_key_derivation_input_bytes"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_input_bytes()</span></code></a> that is a password or passphrase. It can also be high-entropy secret, for example, a key of type <a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_DERIVE" title="PSA_KEY_TYPE_DERIVE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_DERIVE</span></code></a>, or the shared secret resulting from a key agreement.</p>
<p>If the secret is a direct input, the derivation operation cannot be used to derive keys: the operation will not permit a call to <a class="reference internal" href="#c.psa_key_derivation_output_key" title="psa_key_derivation_output_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_output_key()</span></code></a> or <a class="reference internal" href="#c.psa_key_derivation_output_key_custom" title="psa_key_derivation_output_key_custom"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_output_key_custom()</span></code></a>.</p>
</section>
<section id="c.PSA_KEY_DERIVATION_INPUT_LABEL">
<h3><code class="docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_LABEL</span></code> (macro)<a class="headerlink" href="#c.PSA_KEY_DERIVATION_INPUT_LABEL" title="Link to this heading">¶</a></h3>
<p>A label for key derivation.</p>
<pre class="literal-block">#define <a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_LABEL" title="PSA_KEY_DERIVATION_INPUT_LABEL">PSA_KEY_DERIVATION_INPUT_LABEL</a> <em><a class="reference internal" href="../../overview/implementation.html#implementation-defined-value"><span class="std std-ref">/* implementation-defined value */</span></a></em></pre>
<p>This is typically a direct input. It can also be a key of type <a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_RAW_DATA" title="PSA_KEY_TYPE_RAW_DATA"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_RAW_DATA</span></code></a>.</p>
</section>
<section id="c.PSA_KEY_DERIVATION_INPUT_CONTEXT">
<h3><code class="docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_CONTEXT</span></code> (macro)<a class="headerlink" href="#c.PSA_KEY_DERIVATION_INPUT_CONTEXT" title="Link to this heading">¶</a></h3>
<p>A context for key derivation.</p>
<pre class="literal-block">#define <a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_CONTEXT" title="PSA_KEY_DERIVATION_INPUT_CONTEXT">PSA_KEY_DERIVATION_INPUT_CONTEXT</a> <em><a class="reference internal" href="../../overview/implementation.html#implementation-defined-value"><span class="std std-ref">/* implementation-defined value */</span></a></em></pre>
<p>This is typically a direct input. It can also be a key of type <a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_RAW_DATA" title="PSA_KEY_TYPE_RAW_DATA"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_RAW_DATA</span></code></a>.</p>
</section>
<section id="c.PSA_KEY_DERIVATION_INPUT_SALT">
<h3><code class="docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_SALT</span></code> (macro)<a class="headerlink" href="#c.PSA_KEY_DERIVATION_INPUT_SALT" title="Link to this heading">¶</a></h3>
<p>A salt for key derivation.</p>
<pre class="literal-block">#define <a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_SALT" title="PSA_KEY_DERIVATION_INPUT_SALT">PSA_KEY_DERIVATION_INPUT_SALT</a> <em><a class="reference internal" href="../../overview/implementation.html#implementation-defined-value"><span class="std std-ref">/* implementation-defined value */</span></a></em></pre>
<p>This is typically a direct input. It can also be a key of type <a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_RAW_DATA" title="PSA_KEY_TYPE_RAW_DATA"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_RAW_DATA</span></code></a> or <a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_PEPPER" title="PSA_KEY_TYPE_PEPPER"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_PEPPER</span></code></a>.</p>
</section>
<section id="c.PSA_KEY_DERIVATION_INPUT_INFO">
<h3><code class="docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_INFO</span></code> (macro)<a class="headerlink" href="#c.PSA_KEY_DERIVATION_INPUT_INFO" title="Link to this heading">¶</a></h3>
<p>An information string for key derivation.</p>
<pre class="literal-block">#define <a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_INFO" title="PSA_KEY_DERIVATION_INPUT_INFO">PSA_KEY_DERIVATION_INPUT_INFO</a> <em><a class="reference internal" href="../../overview/implementation.html#implementation-defined-value"><span class="std std-ref">/* implementation-defined value */</span></a></em></pre>
<p>This is typically a direct input. It can also be a key of type <a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_RAW_DATA" title="PSA_KEY_TYPE_RAW_DATA"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_RAW_DATA</span></code></a>.</p>
</section>
<section id="c.PSA_KEY_DERIVATION_INPUT_SEED">
<h3><code class="docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_SEED</span></code> (macro)<a class="headerlink" href="#c.PSA_KEY_DERIVATION_INPUT_SEED" title="Link to this heading">¶</a></h3>
<p>A seed for key derivation.</p>
<pre class="literal-block">#define <a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_SEED" title="PSA_KEY_DERIVATION_INPUT_SEED">PSA_KEY_DERIVATION_INPUT_SEED</a> <em><a class="reference internal" href="../../overview/implementation.html#implementation-defined-value"><span class="std std-ref">/* implementation-defined value */</span></a></em></pre>
<p>This is typically a direct input. It can also be a key of type <a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_RAW_DATA" title="PSA_KEY_TYPE_RAW_DATA"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_RAW_DATA</span></code></a>.</p>
</section>
<section id="c.PSA_KEY_DERIVATION_INPUT_COST">
<h3><code class="docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_COST</span></code> (macro)<a class="headerlink" href="#c.PSA_KEY_DERIVATION_INPUT_COST" title="Link to this heading">¶</a></h3>
<p>A cost parameter for password hashing or key stretching.</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 1.1.</span></p>
</div>
<pre class="literal-block">#define <a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_COST" title="PSA_KEY_DERIVATION_INPUT_COST">PSA_KEY_DERIVATION_INPUT_COST</a> <em><a class="reference internal" href="../../overview/implementation.html#implementation-defined-value"><span class="std std-ref">/* implementation-defined value */</span></a></em></pre>
<p>This must be a direct input, passed to <a class="reference internal" href="#c.psa_key_derivation_input_integer" title="psa_key_derivation_input_integer"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_input_integer()</span></code></a>.</p>
</section>
</section>
<section id="key-derivation-functions">
<h2><span class="section-number">10.6.3 </span>Key-derivation functions<a class="headerlink" href="#key-derivation-functions" title="Link to this heading">¶</a></h2>
<section id="c.psa_key_derivation_operation_t">
<h3><code class="docutils literal notranslate"><span class="pre">psa_key_derivation_operation_t</span></code> (typedef)<a class="headerlink" href="#c.psa_key_derivation_operation_t" title="Link to this heading">¶</a></h3>
<p>The type of the state object for key-derivation operations.</p>
<pre class="literal-block">typedef <em><a class="reference internal" href="../../overview/implementation.html#implementation-defined-type"><span class="std std-ref">/* implementation-defined type */</span></a></em> <a class="reference internal" href="#c.psa_key_derivation_operation_t" title="psa_key_derivation_operation_t">psa_key_derivation_operation_t</a>;</pre>
<p>Before calling any function on a key-derivation operation object, the application must initialize it by any of the following means:</p>
<ul>
<li><p>Set the object to all-bits-zero, for example:</p>
<pre class="literal-block"><a class="reference internal" href="#c.psa_key_derivation_operation_t" title="psa_key_derivation_operation_t">psa_key_derivation_operation_t</a> operation;
memset(&amp;operation, 0, sizeof(operation));</pre>
</li>
<li><p>Initialize the object to logical zero values by declaring the object as static or global without an explicit initializer, for example:</p>
<pre class="literal-block">static <a class="reference internal" href="#c.psa_key_derivation_operation_t" title="psa_key_derivation_operation_t">psa_key_derivation_operation_t</a> operation;</pre>
</li>
<li><p>Initialize the object to the initializer <a class="reference internal" href="#c.PSA_KEY_DERIVATION_OPERATION_INIT" title="PSA_KEY_DERIVATION_OPERATION_INIT"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_OPERATION_INIT</span></code></a>, for example:</p>
<pre class="literal-block"><a class="reference internal" href="#c.psa_key_derivation_operation_t" title="psa_key_derivation_operation_t">psa_key_derivation_operation_t</a> operation = <a class="reference internal" href="#c.PSA_KEY_DERIVATION_OPERATION_INIT" title="PSA_KEY_DERIVATION_OPERATION_INIT">PSA_KEY_DERIVATION_OPERATION_INIT</a>;</pre>
</li>
<li><p>Assign the result of the function <a class="reference internal" href="#c.psa_key_derivation_operation_init" title="psa_key_derivation_operation_init"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_operation_init()</span></code></a> to the object, for example:</p>
<pre class="literal-block"><a class="reference internal" href="#c.psa_key_derivation_operation_t" title="psa_key_derivation_operation_t">psa_key_derivation_operation_t</a> operation;
operation = <a class="reference internal" href="#c.psa_key_derivation_operation_init" title="psa_key_derivation_operation_init">psa_key_derivation_operation_init</a>();</pre>
</li>
</ul>
<p>This is an implementation-defined type. Applications that make assumptions about the content of this object will result in implementation-specific behavior, and are non-portable.</p>
</section>
<section id="c.PSA_KEY_DERIVATION_OPERATION_INIT">
<h3><code class="docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_OPERATION_INIT</span></code> (macro)<a class="headerlink" href="#c.PSA_KEY_DERIVATION_OPERATION_INIT" title="Link to this heading">¶</a></h3>
<p>This macro returns a suitable initializer for a key-derivation operation object of type <a class="reference internal" href="#c.psa_key_derivation_operation_t" title="psa_key_derivation_operation_t"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_operation_t</span></code></a>.</p>
<pre class="literal-block">#define <a class="reference internal" href="#c.PSA_KEY_DERIVATION_OPERATION_INIT" title="PSA_KEY_DERIVATION_OPERATION_INIT">PSA_KEY_DERIVATION_OPERATION_INIT</a> <em><a class="reference internal" href="../../overview/implementation.html#implementation-defined-value"><span class="std std-ref">/* implementation-defined value */</span></a></em></pre>
</section>
<section id="c.psa_key_derivation_operation_init">
<h3><code class="docutils literal notranslate"><span class="pre">psa_key_derivation_operation_init</span></code> (function)<a class="headerlink" href="#c.psa_key_derivation_operation_init" title="Link to this heading">¶</a></h3>
<p>Return an initial value for a key-derivation operation object.</p>
<pre class="literal-block"><a class="reference internal" href="#c.psa_key_derivation_operation_t" title="psa_key_derivation_operation_t">psa_key_derivation_operation_t</a> <a class="reference internal" href="#c.psa_key_derivation_operation_init" title="psa_key_derivation_operation_init">psa_key_derivation_operation_init</a>(void);</pre>
<p class="rubric">Returns: <a class="reference internal" href="#c.psa_key_derivation_operation_t" title="psa_key_derivation_operation_t"><code class="docutils literal notranslate"><span class="pre">psa_key_derivation_operation_t</span></code></a></p>
</section>
<section id="c.psa_key_derivation_setup">
<h3><code class="docutils literal notranslate"><span class="pre">psa_key_derivation_setup</span></code> (function)<a class="headerlink" href="#c.psa_key_derivation_setup" title="Link to this heading">¶</a></h3>
<p>Set up a key-derivation operation.</p>
<pre class="literal-block">psa_status_t <a class="reference internal" href="#c.psa_key_derivation_setup" title="psa_key_derivation_setup">psa_key_derivation_setup</a>(<a class="reference internal" href="#c.psa_key_derivation_operation_t" title="psa_key_derivation_operation_t">psa_key_derivation_operation_t</a> * operation,
                                      <a class="reference internal" href="algorithms.html#c.psa_algorithm_t" title="psa_algorithm_t">psa_algorithm_t</a> alg);</pre>
<p class="rubric">Parameters</p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">operation</span></code></p>
</dt><dd><p>The key-derivation operation object to set up. It must have been initialized but not set up yet.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">alg</span></code></p>
</dt><dd><p>The algorithm to compute. This must be one of the following:</p>
<ul class="simple">
<li><p>A key-derivation algorithm: a value of type <a class="reference internal" href="algorithms.html#c.psa_algorithm_t" title="psa_algorithm_t"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_algorithm_t</span></code></a> such that <a class="reference internal" href="algorithms.html#c.PSA_ALG_IS_KEY_DERIVATION" title="PSA_ALG_IS_KEY_DERIVATION"><code class="docutils literal notranslate"><span class="pre">PSA_ALG_IS_KEY_DERIVATION</span></code></a><code class="docutils literal notranslate"><span class="pre">(</span></code><code class="docutils literal notranslate"><span class="pre">alg</span></code><code class="docutils literal notranslate"><span class="pre">)</span></code> is true.</p></li>
<li><p>A key-agreement and key-derivation algorithm: a value of type <a class="reference internal" href="algorithms.html#c.psa_algorithm_t" title="psa_algorithm_t"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_algorithm_t</span></code></a> such that <a class="reference internal" href="algorithms.html#c.PSA_ALG_IS_KEY_AGREEMENT" title="PSA_ALG_IS_KEY_AGREEMENT"><code class="docutils literal notranslate"><span class="pre">PSA_ALG_IS_KEY_AGREEMENT</span></code></a><code class="docutils literal notranslate"><span class="pre">(</span></code><code class="docutils literal notranslate"><span class="pre">alg</span></code><code class="docutils literal notranslate"><span class="pre">)</span></code> is true and <a class="reference internal" href="key-agreement.html#c.PSA_ALG_IS_RAW_KEY_AGREEMENT" title="PSA_ALG_IS_RAW_KEY_AGREEMENT"><code class="docutils literal notranslate"><span class="pre">PSA_ALG_IS_RAW_KEY_AGREEMENT</span></code></a><code class="docutils literal notranslate"><span class="pre">(</span></code><code class="docutils literal notranslate"><span class="pre">alg</span></code><code class="docutils literal notranslate"><span class="pre">)</span></code> is false.</p></li>
</ul>
</dd>
</dl>
</div>
<p class="rubric">Returns: <code class="docutils literal notranslate"><span class="pre">psa_status_t</span></code></p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_SUCCESS</span></code></p>
</dt><dd><p>Success. The operation is now active.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_BAD_STATE</span></code></p>
</dt><dd><p>The following conditions can result in this error:</p>
<ul class="simple">
<li><p>The operation state is not valid: it must be inactive.</p></li>
<li><p>The library requires initializing by a call to <a class="reference internal" href="../library/library.html#c.psa_crypto_init" title="psa_crypto_init"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_crypto_init()</span></code></a>.</p></li>
</ul>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INVALID_ARGUMENT</span></code></p>
</dt><dd><p><code class="docutils literal notranslate"><span class="pre">alg</span></code> is neither a key-derivation algorithm, nor a key-agreement and key-derivation algorithm.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_NOT_SUPPORTED</span></code></p>
</dt><dd><p><code class="docutils literal notranslate"><span class="pre">alg</span></code> is not supported or is not a key-derivation algorithm, or a key-agreement and key-derivation algorithm.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INSUFFICIENT_MEMORY</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_COMMUNICATION_FAILURE</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_CORRUPTION_DETECTED</span></code></p>
</dt><dd></dd>
</dl>
</div>
<p class="rubric">Description</p>
<p>A key-derivation algorithm takes some inputs and uses them to generate a byte stream in a deterministic way. This byte stream can be used to produce keys and other cryptographic material.</p>
<p>A key-agreement and key-derivation algorithm uses a key-agreement protocol to provide a shared secret which is used for the key derivation. See <a class="reference internal" href="key-agreement.html#c.psa_key_derivation_key_agreement" title="psa_key_derivation_key_agreement"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_key_agreement()</span></code></a>.</p>
<p>The sequence of operations to derive a key is as follows:</p>
<ol class="arabic simple">
<li><p>Allocate a key-derivation operation object which will be passed to all the functions listed here.</p></li>
<li><p>Initialize the operation object with one of the methods described in the documentation for <a class="reference internal" href="#c.psa_key_derivation_operation_t" title="psa_key_derivation_operation_t"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_operation_t</span></code></a>, e.g. <a class="reference internal" href="#c.PSA_KEY_DERIVATION_OPERATION_INIT" title="PSA_KEY_DERIVATION_OPERATION_INIT"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_OPERATION_INIT</span></code></a>.</p></li>
<li><p>Call <a class="reference internal" href="#c.psa_key_derivation_setup" title="psa_key_derivation_setup"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_setup()</span></code></a> to specify the algorithm.</p></li>
<li><p>Provide the inputs for the key derivation by calling <a class="reference internal" href="#c.psa_key_derivation_input_bytes" title="psa_key_derivation_input_bytes"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_input_bytes()</span></code></a> or <a class="reference internal" href="#c.psa_key_derivation_input_key" title="psa_key_derivation_input_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_input_key()</span></code></a> as appropriate. Which inputs are needed, in what order, whether keys are permitted, and what type of keys depends on the algorithm.</p></li>
<li><p>Optionally set the operation’s maximum capacity with <a class="reference internal" href="#c.psa_key_derivation_set_capacity" title="psa_key_derivation_set_capacity"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_set_capacity()</span></code></a>. This can be done before, in the middle of, or after providing inputs. For some algorithms, this step is mandatory because the output depends on the maximum capacity.</p></li>
<li><p>To derive a key, call <a class="reference internal" href="#c.psa_key_derivation_output_key" title="psa_key_derivation_output_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_output_key()</span></code></a> or <a class="reference internal" href="#c.psa_key_derivation_output_key_custom" title="psa_key_derivation_output_key_custom"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_output_key_custom()</span></code></a>. To derive a byte string for a different purpose, call <a class="reference internal" href="#c.psa_key_derivation_output_bytes" title="psa_key_derivation_output_bytes"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_output_bytes()</span></code></a>. Successive calls to these functions use successive output bytes calculated by the key-derivation algorithm.</p></li>
<li><p>Clean up the key-derivation operation object with <a class="reference internal" href="#c.psa_key_derivation_abort" title="psa_key_derivation_abort"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_abort()</span></code></a>.</p></li>
</ol>
<p>After a successful call to <a class="reference internal" href="#c.psa_key_derivation_setup" title="psa_key_derivation_setup"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_setup()</span></code></a>, the operation is active, and the application must eventually terminate the operation with a call to <a class="reference internal" href="#c.psa_key_derivation_abort" title="psa_key_derivation_abort"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_abort()</span></code></a>.</p>
<p>If <a class="reference internal" href="#c.psa_key_derivation_setup" title="psa_key_derivation_setup"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_setup()</span></code></a> returns an error, the operation object is unchanged. If a subsequent function call with an active operation returns an error, the operation enters an error state.</p>
<p>To abandon an active operation, or reset an operation in an error state, call <a class="reference internal" href="#c.psa_key_derivation_abort" title="psa_key_derivation_abort"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_abort()</span></code></a>.</p>
<p>See <a class="reference internal" href="../../overview/functionality.html#multi-part-operations"><span class="secref">Multi-part operations</span></a>.</p>
</section>
<section id="c.psa_key_derivation_get_capacity">
<h3><code class="docutils literal notranslate"><span class="pre">psa_key_derivation_get_capacity</span></code> (function)<a class="headerlink" href="#c.psa_key_derivation_get_capacity" title="Link to this heading">¶</a></h3>
<p>Retrieve the current capacity of a key-derivation operation.</p>
<pre class="literal-block">psa_status_t <a class="reference internal" href="#c.psa_key_derivation_get_capacity" title="psa_key_derivation_get_capacity">psa_key_derivation_get_capacity</a>(const <a class="reference internal" href="#c.psa_key_derivation_operation_t" title="psa_key_derivation_operation_t">psa_key_derivation_operation_t</a> * operation,
                                             size_t * capacity);</pre>
<p class="rubric">Parameters</p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">operation</span></code></p>
</dt><dd><p>The operation to query.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">capacity</span></code></p>
</dt><dd><p>On success, the capacity of the operation.</p>
</dd>
</dl>
</div>
<p class="rubric">Returns: <code class="docutils literal notranslate"><span class="pre">psa_status_t</span></code></p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_SUCCESS</span></code></p>
</dt><dd><p>Success.
The maximum number of bytes that this key derivation can return is <code class="docutils literal notranslate"><span class="pre">(*capacity)</span></code>.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_BAD_STATE</span></code></p>
</dt><dd><p>The following conditions can result in this error:</p>
<ul class="simple">
<li><p>The operation state is not valid: it must be active.</p></li>
<li><p>The library requires initializing by a call to <a class="reference internal" href="../library/library.html#c.psa_crypto_init" title="psa_crypto_init"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_crypto_init()</span></code></a>.</p></li>
</ul>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_COMMUNICATION_FAILURE</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_CORRUPTION_DETECTED</span></code></p>
</dt><dd></dd>
</dl>
</div>
<p class="rubric">Description</p>
<p>The capacity of a key derivation is the maximum number of bytes that it can return. Reading <span class="math notranslate nohighlight">\(N\)</span> bytes of output from a key-derivation operation reduces its capacity by at least <span class="math notranslate nohighlight">\(N\)</span>. The capacity can be reduced by more than <span class="math notranslate nohighlight">\(N\)</span> in the following situations:</p>
<ul class="simple">
<li><p>Calling <a class="reference internal" href="#c.psa_key_derivation_output_key" title="psa_key_derivation_output_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_output_key()</span></code></a> or <a class="reference internal" href="#c.psa_key_derivation_output_key_custom" title="psa_key_derivation_output_key_custom"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_output_key_custom()</span></code></a> can reduce the capacity by more than the key size, depending on the type of key being generated. See  <a class="reference internal" href="#c.psa_key_derivation_output_key" title="psa_key_derivation_output_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_output_key()</span></code></a> for details of the key-derivation process.</p></li>
<li><p>When the <a class="reference internal" href="#c.psa_key_derivation_operation_t" title="psa_key_derivation_operation_t"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_operation_t</span></code></a> object is operating as a deterministic random bit generator (DBRG), which reduces capacity in whole blocks, even when less than a block is read.</p></li>
</ul>
</section>
<section id="c.psa_key_derivation_set_capacity">
<h3><code class="docutils literal notranslate"><span class="pre">psa_key_derivation_set_capacity</span></code> (function)<a class="headerlink" href="#c.psa_key_derivation_set_capacity" title="Link to this heading">¶</a></h3>
<p>Set the maximum capacity of a key-derivation operation.</p>
<pre class="literal-block">psa_status_t <a class="reference internal" href="#c.psa_key_derivation_set_capacity" title="psa_key_derivation_set_capacity">psa_key_derivation_set_capacity</a>(<a class="reference internal" href="#c.psa_key_derivation_operation_t" title="psa_key_derivation_operation_t">psa_key_derivation_operation_t</a> * operation,
                                             size_t capacity);</pre>
<p class="rubric">Parameters</p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">operation</span></code></p>
</dt><dd><p>The key-derivation operation object to modify.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">capacity</span></code></p>
</dt><dd><p>The new capacity of the operation. It must be less or equal to the operation’s current capacity.</p>
</dd>
</dl>
</div>
<p class="rubric">Returns: <code class="docutils literal notranslate"><span class="pre">psa_status_t</span></code></p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_SUCCESS</span></code></p>
</dt><dd><p>Success.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_BAD_STATE</span></code></p>
</dt><dd><p>The following conditions can result in this error:</p>
<ul class="simple">
<li><p>The operation state is not valid: it must be active.</p></li>
<li><p>The library requires initializing by a call to <a class="reference internal" href="../library/library.html#c.psa_crypto_init" title="psa_crypto_init"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_crypto_init()</span></code></a>.</p></li>
</ul>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INVALID_ARGUMENT</span></code></p>
</dt><dd><p><code class="docutils literal notranslate"><span class="pre">capacity</span></code> is larger than the operation’s current capacity. In this case, the operation object remains valid and its capacity remains unchanged.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_COMMUNICATION_FAILURE</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_CORRUPTION_DETECTED</span></code></p>
</dt><dd></dd>
</dl>
</div>
<p class="rubric">Description</p>
<p>The capacity of a key-derivation operation is the maximum number of bytes that the key-derivation operation can return from this point onwards.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For some algorithms, the capacity value can affect the output of the key derivation. For example, see <a class="reference internal" href="#c.PSA_ALG_SP800_108_COUNTER_HMAC" title="PSA_ALG_SP800_108_COUNTER_HMAC"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_ALG_SP800_108_COUNTER_HMAC</span></code></a>.</p>
</div>
</section>
<section id="c.psa_key_derivation_input_bytes">
<h3><code class="docutils literal notranslate"><span class="pre">psa_key_derivation_input_bytes</span></code> (function)<a class="headerlink" href="#c.psa_key_derivation_input_bytes" title="Link to this heading">¶</a></h3>
<p>Provide an input for key derivation or key agreement.</p>
<pre class="literal-block">psa_status_t <a class="reference internal" href="#c.psa_key_derivation_input_bytes" title="psa_key_derivation_input_bytes">psa_key_derivation_input_bytes</a>(<a class="reference internal" href="#c.psa_key_derivation_operation_t" title="psa_key_derivation_operation_t">psa_key_derivation_operation_t</a> * operation,
                                            <a class="reference internal" href="#c.psa_key_derivation_step_t" title="psa_key_derivation_step_t">psa_key_derivation_step_t</a> step,
                                            const uint8_t * data,
                                            size_t data_length);</pre>
<p class="rubric">Parameters</p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">operation</span></code></p>
</dt><dd><p>The key-derivation operation object to use. It must have been set up with <a class="reference internal" href="#c.psa_key_derivation_setup" title="psa_key_derivation_setup"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_setup()</span></code></a> and must not have produced any output yet.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">step</span></code></p>
</dt><dd><p>Which step the input data is for.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">data</span></code></p>
</dt><dd><p>Input data to use.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">data_length</span></code></p>
</dt><dd><p>Size of the <code class="docutils literal notranslate"><span class="pre">data</span></code> buffer in bytes.</p>
</dd>
</dl>
</div>
<p class="rubric">Returns: <code class="docutils literal notranslate"><span class="pre">psa_status_t</span></code></p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_SUCCESS</span></code></p>
</dt><dd><p>Success.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_BAD_STATE</span></code></p>
</dt><dd><p>The following conditions can result in this error:</p>
<ul class="simple">
<li><p>The operation state is not valid for this input <code class="docutils literal notranslate"><span class="pre">step</span></code>. This can happen if the application provides a step out of order or repeats a step that may not be repeated.</p></li>
<li><p>The library requires initializing by a call to <a class="reference internal" href="../library/library.html#c.psa_crypto_init" title="psa_crypto_init"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_crypto_init()</span></code></a>.</p></li>
</ul>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INVALID_ARGUMENT</span></code></p>
</dt><dd><p>The following conditions can result in this error:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">step</span></code> is not compatible with the operation’s algorithm.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">step</span></code> does not permit direct inputs.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data_length</span></code> is too small or too large for <code class="docutils literal notranslate"><span class="pre">step</span></code> in this particular algorithm.</p></li>
</ul>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_NOT_SUPPORTED</span></code></p>
</dt><dd><p>The following conditions can result in this error:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">step</span></code> is not supported with the operation’s algorithm.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data_length</span></code> is is not supported for <code class="docutils literal notranslate"><span class="pre">step</span></code> in this particular algorithm.</p></li>
</ul>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INSUFFICIENT_MEMORY</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_COMMUNICATION_FAILURE</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_CORRUPTION_DETECTED</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_STORAGE_FAILURE</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_DATA_CORRUPT</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_DATA_INVALID</span></code></p>
</dt><dd></dd>
</dl>
</div>
<p class="rubric">Description</p>
<p>Which inputs are required and in what order depends on the algorithm. Refer to the documentation of each key-derivation or key-agreement algorithm for information.</p>
<p>This function passes direct inputs, which is usually correct for non-secret inputs. To pass a secret input, which is normally in a key object, call <a class="reference internal" href="#c.psa_key_derivation_input_key" title="psa_key_derivation_input_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_input_key()</span></code></a> instead of this function. Refer to the documentation of individual step types (<code class="docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_xxx</span></code> values of type <a class="reference internal" href="#c.psa_key_derivation_step_t" title="psa_key_derivation_step_t"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_step_t</span></code></a>) for more information.</p>
<p>If this function returns an error status, the operation enters an error state and must be aborted by calling <a class="reference internal" href="#c.psa_key_derivation_abort" title="psa_key_derivation_abort"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_abort()</span></code></a>.</p>
</section>
<section id="c.psa_key_derivation_input_integer">
<h3><code class="docutils literal notranslate"><span class="pre">psa_key_derivation_input_integer</span></code> (function)<a class="headerlink" href="#c.psa_key_derivation_input_integer" title="Link to this heading">¶</a></h3>
<p>Provide a numeric input for key derivation or key agreement.</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 1.1.</span></p>
</div>
<pre class="literal-block">psa_status_t <a class="reference internal" href="#c.psa_key_derivation_input_integer" title="psa_key_derivation_input_integer">psa_key_derivation_input_integer</a>(<a class="reference internal" href="#c.psa_key_derivation_operation_t" title="psa_key_derivation_operation_t">psa_key_derivation_operation_t</a> * operation,
                                              <a class="reference internal" href="#c.psa_key_derivation_step_t" title="psa_key_derivation_step_t">psa_key_derivation_step_t</a> step,
                                              uint64_t value);</pre>
<p class="rubric">Parameters</p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">operation</span></code></p>
</dt><dd><p>The key-derivation operation object to use. It must have been set up with <a class="reference internal" href="#c.psa_key_derivation_setup" title="psa_key_derivation_setup"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_setup()</span></code></a> and must not have produced any output yet.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">step</span></code></p>
</dt><dd><p>Which step the input data is for.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">value</span></code></p>
</dt><dd><p>The value of the numeric input.</p>
</dd>
</dl>
</div>
<p class="rubric">Returns: <code class="docutils literal notranslate"><span class="pre">psa_status_t</span></code></p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_SUCCESS</span></code></p>
</dt><dd><p>Success.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_BAD_STATE</span></code></p>
</dt><dd><p>The following conditions can result in this error:</p>
<ul class="simple">
<li><p>The operation state is not valid for this input <code class="docutils literal notranslate"><span class="pre">step</span></code>. This can happen if the application provides a step out of order or repeats a step that may not be repeated.</p></li>
<li><p>The library requires initializing by a call to <a class="reference internal" href="../library/library.html#c.psa_crypto_init" title="psa_crypto_init"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_crypto_init()</span></code></a>.</p></li>
</ul>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INVALID_ARGUMENT</span></code></p>
</dt><dd><p>The following conditions can result in this error:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">step</span></code> is not compatible with the operation’s algorithm.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">step</span></code> does not permit numerical inputs.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">value</span></code> is not valid for <code class="docutils literal notranslate"><span class="pre">step</span></code> in the operation’s algorithm.</p></li>
</ul>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_NOT_SUPPORTED</span></code></p>
</dt><dd><p>The following conditions can result in this error:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">step</span></code> is not supported with the operation’s algorithm.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">value</span></code> is not supported for <code class="docutils literal notranslate"><span class="pre">step</span></code> in the operation’s algorithm.</p></li>
</ul>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INSUFFICIENT_MEMORY</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_COMMUNICATION_FAILURE</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_CORRUPTION_DETECTED</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_STORAGE_FAILURE</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_DATA_CORRUPT</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_DATA_INVALID</span></code></p>
</dt><dd></dd>
</dl>
</div>
<p class="rubric">Description</p>
<p>Which inputs are required and in what order depends on the algorithm.
However, when an algorithm requires a particular order, numeric inputs usually come first as they tend to be configuration parameters.
Refer to the documentation of each key-derivation or key-agreement algorithm for information.</p>
<p>This function is used for inputs which are fixed-size non-negative integers.</p>
<p>If this function returns an error status, the operation enters an error state and must be aborted by calling <a class="reference internal" href="#c.psa_key_derivation_abort" title="psa_key_derivation_abort"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_abort()</span></code></a>.</p>
</section>
<section id="c.psa_key_derivation_input_key">
<h3><code class="docutils literal notranslate"><span class="pre">psa_key_derivation_input_key</span></code> (function)<a class="headerlink" href="#c.psa_key_derivation_input_key" title="Link to this heading">¶</a></h3>
<p>Provide an input for key derivation in the form of a key.</p>
<pre class="literal-block">psa_status_t <a class="reference internal" href="#c.psa_key_derivation_input_key" title="psa_key_derivation_input_key">psa_key_derivation_input_key</a>(<a class="reference internal" href="#c.psa_key_derivation_operation_t" title="psa_key_derivation_operation_t">psa_key_derivation_operation_t</a> * operation,
                                          <a class="reference internal" href="#c.psa_key_derivation_step_t" title="psa_key_derivation_step_t">psa_key_derivation_step_t</a> step,
                                          <a class="reference internal" href="../keys/ids.html#c.psa_key_id_t" title="psa_key_id_t">psa_key_id_t</a> key);</pre>
<p class="rubric">Parameters</p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">operation</span></code></p>
</dt><dd><p>The key-derivation operation object to use. It must have been set up with <a class="reference internal" href="#c.psa_key_derivation_setup" title="psa_key_derivation_setup"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_setup()</span></code></a> and must not have produced any output yet.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">step</span></code></p>
</dt><dd><p>Which step the input data is for.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">key</span></code></p>
</dt><dd><p>Identifier of the key. The key must have an appropriate type for <code class="docutils literal notranslate"><span class="pre">step</span></code>, it must permit the usage <a class="reference internal" href="../keys/policy.html#c.PSA_KEY_USAGE_DERIVE" title="PSA_KEY_USAGE_DERIVE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_USAGE_DERIVE</span></code></a> or <a class="reference internal" href="../keys/policy.html#c.PSA_KEY_USAGE_VERIFY_DERIVATION" title="PSA_KEY_USAGE_VERIFY_DERIVATION"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_USAGE_VERIFY_DERIVATION</span></code></a> (see <a class="reference internal" href="#note">note</a>), and it must permit the algorithm used by the operation.</p>
</dd>
</dl>
</div>
<p class="rubric">Returns: <code class="docutils literal notranslate"><span class="pre">psa_status_t</span></code></p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_SUCCESS</span></code></p>
</dt><dd><p>Success.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_BAD_STATE</span></code></p>
</dt><dd><p>The following conditions can result in this error:</p>
<ul class="simple">
<li><p>The operation state is not valid for this input <code class="docutils literal notranslate"><span class="pre">step</span></code>. This can happen if the application provides a step out of order or repeats a step that may not be repeated.</p></li>
<li><p>The library requires initializing by a call to <a class="reference internal" href="../library/library.html#c.psa_crypto_init" title="psa_crypto_init"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_crypto_init()</span></code></a>.</p></li>
</ul>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INVALID_HANDLE</span></code></p>
</dt><dd><p><code class="docutils literal notranslate"><span class="pre">key</span></code> is not a valid key identifier.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_NOT_PERMITTED</span></code></p>
</dt><dd><p>The following conditions can result in this error:</p>
<ul class="simple">
<li><p>The key has neither the <a class="reference internal" href="../keys/policy.html#c.PSA_KEY_USAGE_DERIVE" title="PSA_KEY_USAGE_DERIVE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_USAGE_DERIVE</span></code></a> nor the <a class="reference internal" href="../keys/policy.html#c.PSA_KEY_USAGE_VERIFY_DERIVATION" title="PSA_KEY_USAGE_VERIFY_DERIVATION"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_USAGE_VERIFY_DERIVATION</span></code></a> usage flag.</p></li>
<li><p>The key does not permit the operation’s algorithm.</p></li>
</ul>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INVALID_ARGUMENT</span></code></p>
</dt><dd><p>The following conditions can result in this error:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">step</span></code> is not compatible with the operation’s algorithm.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">step</span></code> does not permit key inputs of the given type, or does not permit key inputs at all.</p></li>
</ul>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_NOT_SUPPORTED</span></code></p>
</dt><dd><p>The following conditions can result in this error:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">step</span></code> is not supported with the operation’s algorithm.</p></li>
<li><p>Key inputs of the given type are not supported for <code class="docutils literal notranslate"><span class="pre">step</span></code> in the operation’s algorithm.</p></li>
</ul>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INSUFFICIENT_MEMORY</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_COMMUNICATION_FAILURE</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_CORRUPTION_DETECTED</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_STORAGE_FAILURE</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_DATA_CORRUPT</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_DATA_INVALID</span></code></p>
</dt><dd></dd>
</dl>
</div>
<p class="rubric">Description</p>
<p>Which inputs are required and in what order depends on the algorithm. Refer to the documentation of each key-derivation or key-agreement algorithm for information.</p>
<p>This function obtains input from a key object, which is usually correct for secret inputs or for non-secret personalization strings kept in the key store. To pass a non-secret parameter which is not in the key store, call <a class="reference internal" href="#c.psa_key_derivation_input_bytes" title="psa_key_derivation_input_bytes"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_input_bytes()</span></code></a> instead of this function. Refer to the documentation of individual step types (<code class="docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_xxx</span></code> values of type <a class="reference internal" href="#c.psa_key_derivation_step_t" title="psa_key_derivation_step_t"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_step_t</span></code></a>) for more information.</p>
<div class="admonition note" id="note">
<p class="admonition-title">Note</p>
<p>Once all inputs steps are completed, the following operations are permitted:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#c.psa_key_derivation_output_bytes" title="psa_key_derivation_output_bytes"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_output_bytes()</span></code></a> — if each input was either a direct input, or a key with usage flag <a class="reference internal" href="../keys/policy.html#c.PSA_KEY_USAGE_DERIVE" title="PSA_KEY_USAGE_DERIVE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_USAGE_DERIVE</span></code></a>.</p></li>
<li><p><a class="reference internal" href="#c.psa_key_derivation_output_key" title="psa_key_derivation_output_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_output_key()</span></code></a> or <a class="reference internal" href="#c.psa_key_derivation_output_key_custom" title="psa_key_derivation_output_key_custom"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_output_key_custom()</span></code></a> — if the input for step <a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_SECRET" title="PSA_KEY_DERIVATION_INPUT_SECRET"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_SECRET</span></code></a> or <a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_PASSWORD" title="PSA_KEY_DERIVATION_INPUT_PASSWORD"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_PASSWORD</span></code></a> was a key with usage flag <a class="reference internal" href="../keys/policy.html#c.PSA_KEY_USAGE_DERIVE" title="PSA_KEY_USAGE_DERIVE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_USAGE_DERIVE</span></code></a>, and every other input was either a direct input or a key with usage flag <a class="reference internal" href="../keys/policy.html#c.PSA_KEY_USAGE_DERIVE" title="PSA_KEY_USAGE_DERIVE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_USAGE_DERIVE</span></code></a>.</p></li>
<li><p><a class="reference internal" href="#c.psa_key_derivation_verify_bytes" title="psa_key_derivation_verify_bytes"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_verify_bytes()</span></code></a></p></li>
<li><p><a class="reference internal" href="#c.psa_key_derivation_verify_key" title="psa_key_derivation_verify_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_verify_key()</span></code></a></p></li>
</ul>
</div>
<p>If this function returns an error status, the operation enters an error state and must be aborted by calling <a class="reference internal" href="#c.psa_key_derivation_abort" title="psa_key_derivation_abort"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_abort()</span></code></a>.</p>
</section>
<section id="c.psa_key_derivation_output_bytes">
<h3><code class="docutils literal notranslate"><span class="pre">psa_key_derivation_output_bytes</span></code> (function)<a class="headerlink" href="#c.psa_key_derivation_output_bytes" title="Link to this heading">¶</a></h3>
<p>Read some data from a key-derivation operation.</p>
<pre class="literal-block">psa_status_t <a class="reference internal" href="#c.psa_key_derivation_output_bytes" title="psa_key_derivation_output_bytes">psa_key_derivation_output_bytes</a>(<a class="reference internal" href="#c.psa_key_derivation_operation_t" title="psa_key_derivation_operation_t">psa_key_derivation_operation_t</a> * operation,
                                             uint8_t * output,
                                             size_t output_length);</pre>
<p class="rubric">Parameters</p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">operation</span></code></p>
</dt><dd><p>The key-derivation operation object to read from.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">output</span></code></p>
</dt><dd><p>Buffer where the output will be written.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">output_length</span></code></p>
</dt><dd><p>Number of bytes to output.</p>
</dd>
</dl>
</div>
<p class="rubric">Returns: <code class="docutils literal notranslate"><span class="pre">psa_status_t</span></code></p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_SUCCESS</span></code></p>
</dt><dd><p>Success.
The first <code class="docutils literal notranslate"><span class="pre">output_length</span></code> bytes of <code class="docutils literal notranslate"><span class="pre">output</span></code> contain the derived data.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_BAD_STATE</span></code></p>
</dt><dd><p>The following conditions can result in this error:</p>
<ul class="simple">
<li><p>The operation state is not valid: it must be active, with all required input steps complete.</p></li>
<li><p>The library requires initializing by a call to <a class="reference internal" href="../library/library.html#c.psa_crypto_init" title="psa_crypto_init"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_crypto_init()</span></code></a>.</p></li>
</ul>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_NOT_PERMITTED</span></code></p>
</dt><dd><p>One of the inputs was a key whose policy did not permit <a class="reference internal" href="../keys/policy.html#c.PSA_KEY_USAGE_DERIVE" title="PSA_KEY_USAGE_DERIVE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_USAGE_DERIVE</span></code></a>.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INSUFFICIENT_DATA</span></code></p>
</dt><dd><p>The operation’s capacity was less than <code class="docutils literal notranslate"><span class="pre">output_length</span></code> bytes. In this case, the following occurs:</p>
<ul class="simple">
<li><p>No output is written to the output buffer.</p></li>
<li><p>The operation’s capacity is set to zero.</p></li>
</ul>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INSUFFICIENT_MEMORY</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_COMMUNICATION_FAILURE</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_CORRUPTION_DETECTED</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_STORAGE_FAILURE</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_DATA_CORRUPT</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_DATA_INVALID</span></code></p>
</dt><dd></dd>
</dl>
</div>
<p class="rubric">Description</p>
<p>This function calculates output bytes from a key-derivation algorithm and returns those bytes. If the key derivation’s output is viewed as a stream of bytes, this function consumes the requested number of bytes from the stream and returns them to the caller. The operation’s capacity decreases by the number of bytes read.</p>
<p>A request to extract more data than the remaining capacity — <code class="docutils literal notranslate"><span class="pre">output_length</span></code><code class="docutils literal notranslate"> <span class="pre">&gt;</span> </code><a class="reference internal" href="#c.psa_key_derivation_get_capacity" title="psa_key_derivation_get_capacity"><code class="docutils literal notranslate"><span class="pre">psa_key_derivation_get_capacity</span></code></a><code class="docutils literal notranslate"><span class="pre">()</span></code> — fails with <code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INSUFFICIENT_DATA</span></code>, and sets the remaining capacity to zero.</p>
<p>If the operation’s capacity is zero, and <code class="docutils literal notranslate"><span class="pre">output_length</span></code> is zero, then it is <a class="reference internal" href="../../about.html#term-implementation-defined"><span class="scterm">implementation defined</span></a> whether this function returns <code class="docutils literal notranslate"><span class="pre">PSA_SUCCESS</span></code> or <code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INSUFFICIENT_DATA</span></code>.</p>
<p>If this function returns an error status other than <code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INSUFFICIENT_DATA</span></code>, the operation enters an error state and must be aborted by calling <a class="reference internal" href="#c.psa_key_derivation_abort" title="psa_key_derivation_abort"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_abort()</span></code></a>.</p>
</section>
<section id="c.psa_key_derivation_output_key">
<h3><code class="docutils literal notranslate"><span class="pre">psa_key_derivation_output_key</span></code> (function)<a class="headerlink" href="#c.psa_key_derivation_output_key" title="Link to this heading">¶</a></h3>
<p>Derive a key from an ongoing key-derivation operation.</p>
<pre class="literal-block">psa_status_t <a class="reference internal" href="#c.psa_key_derivation_output_key" title="psa_key_derivation_output_key">psa_key_derivation_output_key</a>(const <a class="reference internal" href="../keys/attributes.html#c.psa_key_attributes_t" title="psa_key_attributes_t">psa_key_attributes_t</a> * attributes,
                                           <a class="reference internal" href="#c.psa_key_derivation_operation_t" title="psa_key_derivation_operation_t">psa_key_derivation_operation_t</a> * operation,
                                           <a class="reference internal" href="../keys/ids.html#c.psa_key_id_t" title="psa_key_id_t">psa_key_id_t</a> * key);</pre>
<p class="rubric">Parameters</p>
<div class="apisubitem docutils container">
<dl>
<dt><p><code class="docutils literal notranslate"><span class="pre">attributes</span></code></p>
</dt><dd><p>The attributes for the new key.</p>
<p>The following attributes are required for all keys:</p>
<ul class="simple">
<li><p>The key type. It must not be an asymmetric public key.</p></li>
<li><p>The key size. It must be a valid size for the key type.</p></li>
</ul>
<p>The following attributes must be set for keys used in cryptographic operations:</p>
<ul>
<li><p>The key permitted-algorithm policy, see <a class="reference internal" href="../keys/policy.html#permitted-algorithms"><span class="secref">Permitted algorithms</span></a>.</p>
<p>If the key type to be created is <a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_PASSWORD_HASH" title="PSA_KEY_TYPE_PASSWORD_HASH"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_PASSWORD_HASH</span></code></a>, then the permitted-algorithm policy must be either the same as the current operation’s algorithm, or <a class="reference internal" href="algorithms.html#c.PSA_ALG_NONE" title="PSA_ALG_NONE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_ALG_NONE</span></code></a>.</p>
</li>
<li><p>The key usage flags, see <a class="reference internal" href="../keys/policy.html#key-usage-flags"><span class="secref">Key usage flags</span></a>.</p></li>
</ul>
<p>The following attributes must be set for keys that do not use the default <a class="reference internal" href="../keys/lifetimes.html#c.PSA_KEY_LIFETIME_VOLATILE" title="PSA_KEY_LIFETIME_VOLATILE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_LIFETIME_VOLATILE</span></code></a> lifetime:</p>
<ul class="simple">
<li><p>The key lifetime, see <a class="reference internal" href="../keys/lifetimes.html#key-lifetimes"><span class="secref">Key lifetimes</span></a>.</p></li>
<li><p>The key identifier is required for a key with a persistent lifetime, see <a class="reference internal" href="../keys/ids.html#key-identifiers"><span class="secref">Key identifiers</span></a>.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is an input parameter: it is not updated with the final key attributes.
The final attributes of the new key can be queried by calling <a class="reference internal" href="../keys/attributes.html#c.psa_get_key_attributes" title="psa_get_key_attributes"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_get_key_attributes()</span></code></a> with the key’s identifier.</p>
</div>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">operation</span></code></p>
</dt><dd><p>The key-derivation operation object to read from.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">key</span></code></p>
</dt><dd><p>On success, an identifier for the newly created key.
For persistent keys, this is the key identifier defined in <code class="docutils literal notranslate"><span class="pre">attributes</span></code>.
<a class="reference internal" href="../keys/ids.html#c.PSA_KEY_ID_NULL" title="PSA_KEY_ID_NULL"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_ID_NULL</span></code></a> on failure.</p>
</dd>
</dl>
</div>
<p class="rubric">Returns: <code class="docutils literal notranslate"><span class="pre">psa_status_t</span></code></p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_SUCCESS</span></code></p>
</dt><dd><p>Success.
If the key is persistent, the key material and the key’s metadata have been saved to persistent storage.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_BAD_STATE</span></code></p>
</dt><dd><p>The following conditions can result in this error:</p>
<ul class="simple">
<li><p>The operation state is not valid: it must be active, with all required input steps complete.</p></li>
<li><p>The library requires initializing by a call to <a class="reference internal" href="../library/library.html#c.psa_crypto_init" title="psa_crypto_init"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_crypto_init()</span></code></a>.</p></li>
</ul>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_NOT_PERMITTED</span></code></p>
</dt><dd><p>The following conditions can result in this error:</p>
<ul class="simple">
<li><p>A <a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_SECRET" title="PSA_KEY_DERIVATION_INPUT_SECRET"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_SECRET</span></code></a> or <a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_PASSWORD" title="PSA_KEY_DERIVATION_INPUT_PASSWORD"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_PASSWORD</span></code></a> input step was neither provided through a key, nor the result of a key agreement.</p></li>
<li><p>One of the inputs was a key whose policy did not permit <a class="reference internal" href="../keys/policy.html#c.PSA_KEY_USAGE_DERIVE" title="PSA_KEY_USAGE_DERIVE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_USAGE_DERIVE</span></code></a>.</p></li>
<li><p>The implementation does not permit creating a key with the specified attributes due to some implementation-specific policy.</p></li>
</ul>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_ALREADY_EXISTS</span></code></p>
</dt><dd><p>This is an attempt to create a persistent key, and there is already a persistent key with the given identifier.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INSUFFICIENT_DATA</span></code></p>
</dt><dd><p>There was not enough data to create the desired key. In this case, the following occurs:</p>
<ul class="simple">
<li><p>No key is generated.</p></li>
<li><p>The operation’s capacity is set to zero.</p></li>
</ul>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INVALID_ARGUMENT</span></code></p>
</dt><dd><p>The following conditions can result in this error:</p>
<ul class="simple">
<li><p>The key type is invalid, or is an asymmetric public-key type.</p></li>
<li><p>The key type is <a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_PASSWORD_HASH" title="PSA_KEY_TYPE_PASSWORD_HASH"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_PASSWORD_HASH</span></code></a>, and the permitted-algorithm policy is not the same as the current operation’s algorithm.</p></li>
<li><p>The key size is not valid for the key type. Implementations must reject an attempt to derive a key of size <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p></li>
<li><p>The key lifetime is invalid.</p></li>
<li><p>The key identifier is not valid for the key lifetime.</p></li>
<li><p>The key usage flags include invalid values.</p></li>
<li><p>The key’s permitted-usage algorithm is invalid.</p></li>
<li><p>The key attributes, as a whole, are invalid.</p></li>
</ul>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_NOT_SUPPORTED</span></code></p>
</dt><dd><p>The key attributes, as a whole, are not supported, either by the implementation in general or in the specified storage location.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INSUFFICIENT_MEMORY</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INSUFFICIENT_STORAGE</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_COMMUNICATION_FAILURE</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_CORRUPTION_DETECTED</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_STORAGE_FAILURE</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_DATA_CORRUPT</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_DATA_INVALID</span></code></p>
</dt><dd></dd>
</dl>
</div>
<p class="rubric">Description</p>
<p>This function calculates output bytes from a key-derivation algorithm and uses those bytes to generate a key deterministically. The key’s location, policy, type and size are taken from <code class="docutils literal notranslate"><span class="pre">attributes</span></code>.</p>
<p>If the key derivation’s output is viewed as a stream of bytes, this function consumes the required number of bytes from the stream. The operation’s capacity decreases by the number of bytes used to derive the key.</p>
<p>A request that needs to extract more data than the remaining capacity fails with <code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INSUFFICIENT_DATA</span></code>, and sets the remaining capacity to zero.</p>
<p>If this function returns an error status other than <code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INSUFFICIENT_DATA</span></code>, the operation enters an error state and must be aborted by calling <a class="reference internal" href="#c.psa_key_derivation_abort" title="psa_key_derivation_abort"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_abort()</span></code></a>.</p>
<p>How much output is produced and consumed from the operation, and how the key is derived, depends on the key type. The key-derivation procedures for standard key-derivation algorithms are described in the <em>Key derivation</em> section of each key definition in <a class="reference internal" href="../keys/types.html#key-types"><span class="secref">Key types</span></a>. Implementations can use other methods for implementation-specific algorithms.</p>
<p>For algorithms that take a <a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_SECRET" title="PSA_KEY_DERIVATION_INPUT_SECRET"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_SECRET</span></code></a> or <a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_PASSWORD" title="PSA_KEY_DERIVATION_INPUT_PASSWORD"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_PASSWORD</span></code></a> input step, the input to that step must be provided with <a class="reference internal" href="#c.psa_key_derivation_input_key" title="psa_key_derivation_input_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_input_key()</span></code></a>. Future versions of this specification might include additional restrictions on the derived key based on the attributes and strength of the secret key.</p>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>This function is equivalent to calling <a class="reference internal" href="#c.psa_key_derivation_output_key_custom" title="psa_key_derivation_output_key_custom"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_output_key_custom()</span></code></a> with the production parameters <a class="reference internal" href="../keys/management.html#c.PSA_CUSTOM_KEY_PARAMETERS_INIT" title="PSA_CUSTOM_KEY_PARAMETERS_INIT"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_CUSTOM_KEY_PARAMETERS_INIT</span></code></a> and <code class="docutils literal notranslate"><span class="pre">custom_data_length</span> <span class="pre">==</span> <span class="pre">0</span></code> (<code class="docutils literal notranslate"><span class="pre">custom_data</span></code> is ignored).</p>
</div>
</div></blockquote>
</section>
<section id="c.psa_key_derivation_output_key_custom">
<h3><code class="docutils literal notranslate"><span class="pre">psa_key_derivation_output_key_custom</span></code> (function)<a class="headerlink" href="#c.psa_key_derivation_output_key_custom" title="Link to this heading">¶</a></h3>
<p>Derive a key from an ongoing key-derivation operation with custom production parameters.</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 1.3.</span></p>
</div>
<pre class="literal-block">psa_status_t <a class="reference internal" href="#c.psa_key_derivation_output_key_custom" title="psa_key_derivation_output_key_custom">psa_key_derivation_output_key_custom</a>(const <a class="reference internal" href="../keys/attributes.html#c.psa_key_attributes_t" title="psa_key_attributes_t">psa_key_attributes_t</a> * attributes,
                                                  <a class="reference internal" href="#c.psa_key_derivation_operation_t" title="psa_key_derivation_operation_t">psa_key_derivation_operation_t</a> * operation,
                                                  const <a class="reference internal" href="../keys/management.html#c.psa_custom_key_parameters_t" title="psa_custom_key_parameters_t">psa_custom_key_parameters_t</a> * custom,
                                                  const uint8_t * custom_data,
                                                  size_t custom_data_length,
                                                  <a class="reference internal" href="../keys/ids.html#c.psa_key_id_t" title="psa_key_id_t">psa_key_id_t</a> * key);</pre>
<p class="rubric">Parameters</p>
<div class="apisubitem docutils container">
<dl>
<dt><p><code class="docutils literal notranslate"><span class="pre">attributes</span></code></p>
</dt><dd><p>The attributes for the new key.</p>
<p>The following attributes are required for all keys:</p>
<ul class="simple">
<li><p>The key type. It must not be an asymmetric public key.</p></li>
<li><p>The key size. It must be a valid size for the key type.</p></li>
</ul>
<p>The following attributes must be set for keys used in cryptographic operations:</p>
<ul>
<li><p>The key permitted-algorithm policy, see <a class="reference internal" href="../keys/policy.html#permitted-algorithms"><span class="secref">Permitted algorithms</span></a>.</p>
<p>If the key type to be created is <a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_PASSWORD_HASH" title="PSA_KEY_TYPE_PASSWORD_HASH"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_PASSWORD_HASH</span></code></a>, then the permitted-algorithm policy must be either the same as the current operation’s algorithm, or <a class="reference internal" href="algorithms.html#c.PSA_ALG_NONE" title="PSA_ALG_NONE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_ALG_NONE</span></code></a>.</p>
</li>
<li><p>The key usage flags, see <a class="reference internal" href="../keys/policy.html#key-usage-flags"><span class="secref">Key usage flags</span></a>.</p></li>
</ul>
<p>The following attributes must be set for keys that do not use the default <a class="reference internal" href="../keys/lifetimes.html#c.PSA_KEY_LIFETIME_VOLATILE" title="PSA_KEY_LIFETIME_VOLATILE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_LIFETIME_VOLATILE</span></code></a> lifetime:</p>
<ul class="simple">
<li><p>The key lifetime, see <a class="reference internal" href="../keys/lifetimes.html#key-lifetimes"><span class="secref">Key lifetimes</span></a>.</p></li>
<li><p>The key identifier is required for a key with a persistent lifetime, see <a class="reference internal" href="../keys/ids.html#key-identifiers"><span class="secref">Key identifiers</span></a>.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is an input parameter: it is not updated with the final key attributes.
The final attributes of the new key can be queried by calling <a class="reference internal" href="../keys/attributes.html#c.psa_get_key_attributes" title="psa_get_key_attributes"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_get_key_attributes()</span></code></a> with the key’s identifier.</p>
</div>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">operation</span></code></p>
</dt><dd><p>The key-derivation operation object to read from.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">custom</span></code></p>
</dt><dd><p>Customized production parameters for the key derivation.</p>
<p>When this is <a class="reference internal" href="../keys/management.html#c.PSA_CUSTOM_KEY_PARAMETERS_INIT" title="PSA_CUSTOM_KEY_PARAMETERS_INIT"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_CUSTOM_KEY_PARAMETERS_INIT</span></code></a> with <code class="docutils literal notranslate"><span class="pre">custom_data_length</span> <span class="pre">==</span> <span class="pre">0</span></code>,
this function is equivalent to <a class="reference internal" href="#c.psa_key_derivation_output_key" title="psa_key_derivation_output_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_output_key()</span></code></a>.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">custom_data</span></code></p>
</dt><dd><p>A buffer containing additional variable-sized production parameters.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">custom_data_length</span></code></p>
</dt><dd><p>Length of <code class="docutils literal notranslate"><span class="pre">custom_data</span></code> in bytes.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">key</span></code></p>
</dt><dd><p>On success, an identifier for the newly created key.
For persistent keys, this is the key identifier defined in <code class="docutils literal notranslate"><span class="pre">attributes</span></code>.
<a class="reference internal" href="../keys/ids.html#c.PSA_KEY_ID_NULL" title="PSA_KEY_ID_NULL"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_ID_NULL</span></code></a> on failure.</p>
</dd>
</dl>
</div>
<p class="rubric">Returns: <code class="docutils literal notranslate"><span class="pre">psa_status_t</span></code></p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_SUCCESS</span></code></p>
</dt><dd><p>Success.
If the key is persistent, the key material and the key’s metadata have been saved to persistent storage.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_BAD_STATE</span></code></p>
</dt><dd><p>The following conditions can result in this error:</p>
<ul class="simple">
<li><p>The operation state is not valid: it must be active, with all required input steps complete.</p></li>
<li><p>The library requires initializing by a call to <a class="reference internal" href="../library/library.html#c.psa_crypto_init" title="psa_crypto_init"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_crypto_init()</span></code></a>.</p></li>
</ul>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_NOT_PERMITTED</span></code></p>
</dt><dd><p>The following conditions can result in this error:</p>
<ul class="simple">
<li><p>A <a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_SECRET" title="PSA_KEY_DERIVATION_INPUT_SECRET"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_SECRET</span></code></a> or <a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_PASSWORD" title="PSA_KEY_DERIVATION_INPUT_PASSWORD"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_PASSWORD</span></code></a> input step was neither provided through a key, nor the result of a key agreement.</p></li>
<li><p>One of the inputs was a key whose policy did not permit <a class="reference internal" href="../keys/policy.html#c.PSA_KEY_USAGE_DERIVE" title="PSA_KEY_USAGE_DERIVE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_USAGE_DERIVE</span></code></a>.</p></li>
<li><p>The implementation does not permit creating a key with the specified attributes due to some implementation-specific policy.</p></li>
</ul>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_ALREADY_EXISTS</span></code></p>
</dt><dd><p>This is an attempt to create a persistent key, and there is already a persistent key with the given identifier.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INSUFFICIENT_DATA</span></code></p>
</dt><dd><p>There was not enough data to create the desired key. In this case, the following occurs:</p>
<ul class="simple">
<li><p>No key is generated.</p></li>
<li><p>The operation’s capacity is set to zero.</p></li>
</ul>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INVALID_ARGUMENT</span></code></p>
</dt><dd><p>The following conditions can result in this error:</p>
<ul class="simple">
<li><p>The key type is invalid, or is an asymmetric public-key type.</p></li>
<li><p>The key type is <a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_PASSWORD_HASH" title="PSA_KEY_TYPE_PASSWORD_HASH"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_PASSWORD_HASH</span></code></a>, and the permitted-algorithm policy is not the same as the current operation’s algorithm.</p></li>
<li><p>The key size is not valid for the key type. Implementations must reject an attempt to derive a key of size <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p></li>
<li><p>The key lifetime is invalid.</p></li>
<li><p>The key identifier is not valid for the key lifetime.</p></li>
<li><p>The key usage flags include invalid values.</p></li>
<li><p>The key’s permitted-usage algorithm is invalid.</p></li>
<li><p>The key attributes, as a whole, are invalid.</p></li>
<li><p>The production parameters are invalid.</p></li>
</ul>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_NOT_SUPPORTED</span></code></p>
</dt><dd><p>The following conditions can result in this error:</p>
<ul class="simple">
<li><p>The key attributes, as a whole, are not supported, either by the implementation in general or in the specified storage location.</p></li>
<li><p>The production parameters are not supported by the implementation.</p></li>
</ul>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INSUFFICIENT_MEMORY</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INSUFFICIENT_STORAGE</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_COMMUNICATION_FAILURE</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_CORRUPTION_DETECTED</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_STORAGE_FAILURE</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_DATA_CORRUPT</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_DATA_INVALID</span></code></p>
</dt><dd></dd>
</dl>
</div>
<p class="rubric">Description</p>
<p>This function calculates output bytes from a key-derivation algorithm and uses those bytes to generate a key deterministically. The key’s location, policy, type and size are taken from <code class="docutils literal notranslate"><span class="pre">attributes</span></code>.</p>
<p>This function operates in a similar way to <a class="reference internal" href="#c.psa_key_derivation_output_key" title="psa_key_derivation_output_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_output_key()</span></code></a>, but enables explicit production parameters to be provided when deriving a key.
For example, the production parameters can be used to select an alternative key-derivation process, or configure additional key parameters.
See <a class="reference internal" href="#c.psa_key_derivation_output_key" title="psa_key_derivation_output_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_output_key()</span></code></a> for the operation of this function with the default production parameters.</p>
<p>See <a class="reference internal" href="../keys/management.html#c.psa_custom_key_parameters_t" title="psa_custom_key_parameters_t"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_custom_key_parameters_t</span></code></a> for a list of non-default production parameters. See the key type definitions in <a class="reference internal" href="../keys/types.html#key-types"><span class="secref">Key types</span></a> for details of the custom production parameters used for key derivation.</p>
</section>
<section id="c.psa_key_derivation_verify_bytes">
<h3><code class="docutils literal notranslate"><span class="pre">psa_key_derivation_verify_bytes</span></code> (function)<a class="headerlink" href="#c.psa_key_derivation_verify_bytes" title="Link to this heading">¶</a></h3>
<p>Compare output data from a key-derivation operation to an expected value.</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 1.1.</span></p>
</div>
<pre class="literal-block">psa_status_t <a class="reference internal" href="#c.psa_key_derivation_verify_bytes" title="psa_key_derivation_verify_bytes">psa_key_derivation_verify_bytes</a>(<a class="reference internal" href="#c.psa_key_derivation_operation_t" title="psa_key_derivation_operation_t">psa_key_derivation_operation_t</a> * operation,
                                             const uint8_t * expected_output,
                                             size_t output_length);</pre>
<p class="rubric">Parameters</p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">operation</span></code></p>
</dt><dd><p>The key-derivation operation object to read from.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">expected_output</span></code></p>
</dt><dd><p>Buffer containing the expected derivation output.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">output_length</span></code></p>
</dt><dd><p>Length of the expected output. This is also the number of bytes that will be read.</p>
</dd>
</dl>
</div>
<p class="rubric">Returns: <code class="docutils literal notranslate"><span class="pre">psa_status_t</span></code></p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_SUCCESS</span></code></p>
</dt><dd><p>Success.
The output of the key-derivation operation matches <code class="docutils literal notranslate"><span class="pre">expected_output</span></code>.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_BAD_STATE</span></code></p>
</dt><dd><p>The following conditions can result in this error:</p>
<ul class="simple">
<li><p>The operation state is not valid: it must be active, with all required input steps complete.</p></li>
<li><p>The library requires initializing by a call to <a class="reference internal" href="../library/library.html#c.psa_crypto_init" title="psa_crypto_init"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_crypto_init()</span></code></a>.</p></li>
</ul>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INVALID_SIGNATURE</span></code></p>
</dt><dd><p>The output of the key-derivation operation does not match the value in <code class="docutils literal notranslate"><span class="pre">expected_output</span></code>.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INSUFFICIENT_DATA</span></code></p>
</dt><dd><p>The operation’s capacity was less than <code class="docutils literal notranslate"><span class="pre">output_length</span></code> bytes. In this case, the operation’s capacity is set to zero.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INSUFFICIENT_MEMORY</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_COMMUNICATION_FAILURE</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_CORRUPTION_DETECTED</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_STORAGE_FAILURE</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_DATA_CORRUPT</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_DATA_INVALID</span></code></p>
</dt><dd></dd>
</dl>
</div>
<p class="rubric">Description</p>
<p>This function calculates output bytes from a key-derivation algorithm and compares those bytes to an expected value.
If the key derivation’s output is viewed as a stream of bytes, this function destructively reads <code class="docutils literal notranslate"><span class="pre">output_length</span></code> bytes from the stream before comparing them with <code class="docutils literal notranslate"><span class="pre">expected_output</span></code>.
The operation’s capacity decreases by the number of bytes read.</p>
<p>A request to extract more data than the remaining capacity — <code class="docutils literal notranslate"><span class="pre">output_length</span></code><code class="docutils literal notranslate"> <span class="pre">&gt;</span> </code><a class="reference internal" href="#c.psa_key_derivation_get_capacity" title="psa_key_derivation_get_capacity"><code class="docutils literal notranslate"><span class="pre">psa_key_derivation_get_capacity</span></code></a><code class="docutils literal notranslate"><span class="pre">()</span></code> — fails with <code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INSUFFICIENT_DATA</span></code>, and sets the remaining capacity to zero.</p>
<p>If the operation’s capacity is zero, and <code class="docutils literal notranslate"><span class="pre">output_length</span></code> is zero, then it is <a class="reference internal" href="../../about.html#term-implementation-defined"><span class="scterm">implementation defined</span></a> whether this function returns <code class="docutils literal notranslate"><span class="pre">PSA_SUCCESS</span></code> or <code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INSUFFICIENT_DATA</span></code>.</p>
<p>If this function returns an error status other than <code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INSUFFICIENT_DATA</span></code>, the operation enters an error state and must be aborted by calling <a class="reference internal" href="#c.psa_key_derivation_abort" title="psa_key_derivation_abort"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_abort()</span></code></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A call to <a class="reference internal" href="#c.psa_key_derivation_verify_bytes" title="psa_key_derivation_verify_bytes"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_verify_bytes()</span></code></a> is functionally equivalent to the following code:</p>
<pre class="literal-block">uint8_t tmp[output_length];
<a class="reference internal" href="#c.psa_key_derivation_output_bytes" title="psa_key_derivation_output_bytes">psa_key_derivation_output_bytes</a>(operation, tmp, output_length);
if (memcmp(expected_output, tmp, output_length) != 0)
    return PSA_ERROR_INVALID_SIGNATURE;</pre>
<p>However, calling <a class="reference internal" href="#c.psa_key_derivation_verify_bytes" title="psa_key_derivation_verify_bytes"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_verify_bytes()</span></code></a> works even if an input key’s policy does not include <a class="reference internal" href="../keys/policy.html#c.PSA_KEY_USAGE_DERIVE" title="PSA_KEY_USAGE_DERIVE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_USAGE_DERIVE</span></code></a>.</p>
</div>
<div class="admonition-implementation-note admonition">
<p class="admonition-title">Implementation note</p>
<p>Implementations must make the best effort to ensure that the comparison between the actual key-derivation output and the expected output is performed in constant time.</p>
</div>
</section>
<section id="c.psa_key_derivation_verify_key">
<h3><code class="docutils literal notranslate"><span class="pre">psa_key_derivation_verify_key</span></code> (function)<a class="headerlink" href="#c.psa_key_derivation_verify_key" title="Link to this heading">¶</a></h3>
<p>Compare output data from a key-derivation operation to an expected value stored in a key.</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 1.1.</span></p>
</div>
<pre class="literal-block">psa_status_t <a class="reference internal" href="#c.psa_key_derivation_verify_key" title="psa_key_derivation_verify_key">psa_key_derivation_verify_key</a>(<a class="reference internal" href="#c.psa_key_derivation_operation_t" title="psa_key_derivation_operation_t">psa_key_derivation_operation_t</a> * operation,
                                           <a class="reference internal" href="../keys/ids.html#c.psa_key_id_t" title="psa_key_id_t">psa_key_id_t</a> expected);</pre>
<p class="rubric">Parameters</p>
<div class="apisubitem docutils container">
<dl>
<dt><p><code class="docutils literal notranslate"><span class="pre">operation</span></code></p>
</dt><dd><p>The key-derivation operation object to read from.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">expected</span></code></p>
</dt><dd><p>A key of type <a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_PASSWORD_HASH" title="PSA_KEY_TYPE_PASSWORD_HASH"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_PASSWORD_HASH</span></code></a> containing the expected output.
The key must permit the usage <a class="reference internal" href="../keys/policy.html#c.PSA_KEY_USAGE_VERIFY_DERIVATION" title="PSA_KEY_USAGE_VERIFY_DERIVATION"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_USAGE_VERIFY_DERIVATION</span></code></a>, and the permitted algorithm must match the operation’s algorithm.</p>
<p>The value of this key is typically computed by a previous call to <a class="reference internal" href="#c.psa_key_derivation_output_key" title="psa_key_derivation_output_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_output_key()</span></code></a> or <a class="reference internal" href="#c.psa_key_derivation_output_key_custom" title="psa_key_derivation_output_key_custom"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_output_key_custom()</span></code></a>.</p>
</dd>
</dl>
</div>
<p class="rubric">Returns: <code class="docutils literal notranslate"><span class="pre">psa_status_t</span></code></p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_SUCCESS</span></code></p>
</dt><dd><p>Success.
The output of the key-derivation operation matches the <code class="docutils literal notranslate"><span class="pre">expected</span></code> key value.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_BAD_STATE</span></code></p>
</dt><dd><p>The following conditions can result in this error:</p>
<ul class="simple">
<li><p>The operation state is not valid: it must be active, with all required input steps complete.</p></li>
<li><p>The library requires initializing by a call to <a class="reference internal" href="../library/library.html#c.psa_crypto_init" title="psa_crypto_init"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_crypto_init()</span></code></a>.</p></li>
</ul>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INVALID_HANDLE</span></code></p>
</dt><dd><p><code class="docutils literal notranslate"><span class="pre">expected</span></code> is not a valid key identifier.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_NOT_PERMITTED</span></code></p>
</dt><dd><p>The <code class="docutils literal notranslate"><span class="pre">expected</span></code> key does not have the <a class="reference internal" href="../keys/policy.html#c.PSA_KEY_USAGE_VERIFY_DERIVATION" title="PSA_KEY_USAGE_VERIFY_DERIVATION"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_USAGE_VERIFY_DERIVATION</span></code></a> flag, or it does not permit the requested algorithm.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INVALID_SIGNATURE</span></code></p>
</dt><dd><p>The output of the key-derivation operation does not match the value of the <code class="docutils literal notranslate"><span class="pre">expected</span></code> key.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INSUFFICIENT_DATA</span></code></p>
</dt><dd><p>The operation’s capacity was less than the length of the <code class="docutils literal notranslate"><span class="pre">expected</span></code> key. In this case, the operation’s capacity is set to zero.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INVALID_ARGUMENT</span></code></p>
</dt><dd><p>The key type is not <a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_PASSWORD_HASH" title="PSA_KEY_TYPE_PASSWORD_HASH"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_PASSWORD_HASH</span></code></a>.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INSUFFICIENT_MEMORY</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_COMMUNICATION_FAILURE</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_CORRUPTION_DETECTED</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_STORAGE_FAILURE</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_DATA_CORRUPT</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_DATA_INVALID</span></code></p>
</dt><dd></dd>
</dl>
</div>
<p class="rubric">Description</p>
<p>This function calculates output bytes from a key-derivation algorithm and compares those bytes to an expected value, provided as key of type <a class="reference internal" href="../keys/types.html#c.PSA_KEY_TYPE_PASSWORD_HASH" title="PSA_KEY_TYPE_PASSWORD_HASH"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_TYPE_PASSWORD_HASH</span></code></a>.
If the key derivation’s output is viewed as a stream of bytes, this function destructively reads the number of bytes corresponding to the length of the <code class="docutils literal notranslate"><span class="pre">expected</span></code> key from the stream before comparing them with the key value.
The operation’s capacity decreases by the number of bytes read.</p>
<p>A request that needs to extract more data than the remaining capacity fails with <code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INSUFFICIENT_DATA</span></code>, and sets the remaining capacity to zero.</p>
<p>If this function returns an error status other than <code class="docutils literal notranslate"><span class="pre">PSA_ERROR_INSUFFICIENT_DATA</span></code>, the operation enters an error state and must be aborted by calling <a class="reference internal" href="#c.psa_key_derivation_abort" title="psa_key_derivation_abort"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_abort()</span></code></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A call to <a class="reference internal" href="#c.psa_key_derivation_verify_key" title="psa_key_derivation_verify_key"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_verify_key()</span></code></a> is functionally equivalent to exporting the <code class="docutils literal notranslate"><span class="pre">expected</span></code> key and calling <a class="reference internal" href="#c.psa_key_derivation_verify_bytes" title="psa_key_derivation_verify_bytes"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_verify_bytes()</span></code></a> on the result, except that it works when the key cannot be exported.</p>
</div>
<div class="admonition-implementation-note admonition">
<p class="admonition-title">Implementation note</p>
<p>Implementations must make the best effort to ensure that the comparison between the actual key-derivation output and the expected output is performed in constant time.</p>
</div>
</section>
<section id="c.psa_key_derivation_abort">
<h3><code class="docutils literal notranslate"><span class="pre">psa_key_derivation_abort</span></code> (function)<a class="headerlink" href="#c.psa_key_derivation_abort" title="Link to this heading">¶</a></h3>
<p>Abort a key-derivation operation.</p>
<pre class="literal-block">psa_status_t <a class="reference internal" href="#c.psa_key_derivation_abort" title="psa_key_derivation_abort">psa_key_derivation_abort</a>(<a class="reference internal" href="#c.psa_key_derivation_operation_t" title="psa_key_derivation_operation_t">psa_key_derivation_operation_t</a> * operation);</pre>
<p class="rubric">Parameters</p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">operation</span></code></p>
</dt><dd><p>The operation to abort.</p>
</dd>
</dl>
</div>
<p class="rubric">Returns: <code class="docutils literal notranslate"><span class="pre">psa_status_t</span></code></p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_SUCCESS</span></code></p>
</dt><dd><p>Success.
The operation object can now be discarded or reused.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_BAD_STATE</span></code></p>
</dt><dd><p>The library requires initializing by a call to <a class="reference internal" href="../library/library.html#c.psa_crypto_init" title="psa_crypto_init"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_crypto_init()</span></code></a>.</p>
</dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_COMMUNICATION_FAILURE</span></code></p>
</dt><dd></dd>
<dt><p><code class="docutils literal notranslate"><span class="pre">PSA_ERROR_CORRUPTION_DETECTED</span></code></p>
</dt><dd></dd>
</dl>
</div>
<p class="rubric">Description</p>
<p>Aborting an operation frees all associated resources except for the <code class="docutils literal notranslate"><span class="pre">operation</span></code> object itself. Once aborted, the operation object can be reused for another operation by calling <a class="reference internal" href="#c.psa_key_derivation_setup" title="psa_key_derivation_setup"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_setup()</span></code></a> again.</p>
<p>This function can be called at any time after the operation object has been initialized as described in <a class="reference internal" href="#c.psa_key_derivation_operation_t" title="psa_key_derivation_operation_t"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_operation_t</span></code></a>.</p>
<p>In particular, it is valid to call <a class="reference internal" href="#c.psa_key_derivation_abort" title="psa_key_derivation_abort"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_abort()</span></code></a> twice, or to call <a class="reference internal" href="#c.psa_key_derivation_abort" title="psa_key_derivation_abort"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_key_derivation_abort()</span></code></a> on an operation that has not been set up.</p>
</section>
</section>
<section id="support-macros">
<h2><span class="section-number">10.6.4 </span>Support macros<a class="headerlink" href="#support-macros" title="Link to this heading">¶</a></h2>
<section id="c.PSA_ALG_IS_KEY_DERIVATION_STRETCHING">
<h3><code class="docutils literal notranslate"><span class="pre">PSA_ALG_IS_KEY_DERIVATION_STRETCHING</span></code> (macro)<a class="headerlink" href="#c.PSA_ALG_IS_KEY_DERIVATION_STRETCHING" title="Link to this heading">¶</a></h3>
<p>Whether the specified algorithm is a key-stretching or password-hashing algorithm.</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 1.1.</span></p>
</div>
<pre class="literal-block">#define <a class="reference internal" href="#c.PSA_ALG_IS_KEY_DERIVATION_STRETCHING" title="PSA_ALG_IS_KEY_DERIVATION_STRETCHING">PSA_ALG_IS_KEY_DERIVATION_STRETCHING</a>(alg) \
    <em><a class="reference internal" href="../../overview/implementation.html#specification-defined-value"><span class="std std-ref">/* specification-defined value */</span></a></em></pre>
<p class="rubric">Parameters</p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">alg</span></code></p>
</dt><dd><p>An algorithm identifier: a value of type <a class="reference internal" href="algorithms.html#c.psa_algorithm_t" title="psa_algorithm_t"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_algorithm_t</span></code></a>.</p>
</dd>
</dl>
</div>
<p class="rubric">Returns</p>
<p><code class="docutils literal notranslate"><span class="pre">1</span></code> if <code class="docutils literal notranslate"><span class="pre">alg</span></code> is a key-stretching or password-hashing algorithm, <code class="docutils literal notranslate"><span class="pre">0</span></code> otherwise.
This macro can return either <code class="docutils literal notranslate"><span class="pre">0</span></code> or <code class="docutils literal notranslate"><span class="pre">1</span></code> if <code class="docutils literal notranslate"><span class="pre">alg</span></code> is not a supported key-derivation algorithm algorithm identifier.</p>
<p class="rubric">Description</p>
<p>A key-stretching or password-hashing algorithm is a key-derivation algorithm that is suitable for use with a low-entropy secret such as a password.
Equivalently, it’s a key-derivation algorithm that uses a <a class="reference internal" href="#c.PSA_KEY_DERIVATION_INPUT_PASSWORD" title="PSA_KEY_DERIVATION_INPUT_PASSWORD"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_INPUT_PASSWORD</span></code></a> input step.</p>
</section>
<section id="c.PSA_ALG_IS_HKDF">
<h3><code class="docutils literal notranslate"><span class="pre">PSA_ALG_IS_HKDF</span></code> (macro)<a class="headerlink" href="#c.PSA_ALG_IS_HKDF" title="Link to this heading">¶</a></h3>
<p>Whether the specified algorithm is an HKDF algorithm (<a class="reference internal" href="#c.PSA_ALG_HKDF" title="PSA_ALG_HKDF"><code class="docutils literal notranslate"><span class="pre">PSA_ALG_HKDF</span></code></a><code class="docutils literal notranslate"><span class="pre">(</span></code><code class="docutils literal notranslate"><span class="pre">hash_alg</span></code><code class="docutils literal notranslate"><span class="pre">)</span></code>).</p>
<pre class="literal-block">#define <a class="reference internal" href="#c.PSA_ALG_IS_HKDF" title="PSA_ALG_IS_HKDF">PSA_ALG_IS_HKDF</a>(alg) <em><a class="reference internal" href="../../overview/implementation.html#specification-defined-value"><span class="std std-ref">/* specification-defined value */</span></a></em></pre>
<p class="rubric">Parameters</p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">alg</span></code></p>
</dt><dd><p>An algorithm identifier: a value of type <a class="reference internal" href="algorithms.html#c.psa_algorithm_t" title="psa_algorithm_t"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_algorithm_t</span></code></a>.</p>
</dd>
</dl>
</div>
<p class="rubric">Returns</p>
<p><code class="docutils literal notranslate"><span class="pre">1</span></code> if <code class="docutils literal notranslate"><span class="pre">alg</span></code> is an HKDF algorithm, <code class="docutils literal notranslate"><span class="pre">0</span></code> otherwise. This macro can return either <code class="docutils literal notranslate"><span class="pre">0</span></code> or <code class="docutils literal notranslate"><span class="pre">1</span></code> if <code class="docutils literal notranslate"><span class="pre">alg</span></code> is not a supported key-derivation algorithm identifier.</p>
<p class="rubric">Description</p>
<p>HKDF is a family of key-derivation algorithms that are based on a hash function and the HMAC construction.</p>
</section>
<section id="c.PSA_ALG_IS_HKDF_EXTRACT">
<h3><code class="docutils literal notranslate"><span class="pre">PSA_ALG_IS_HKDF_EXTRACT</span></code> (macro)<a class="headerlink" href="#c.PSA_ALG_IS_HKDF_EXTRACT" title="Link to this heading">¶</a></h3>
<p>Whether the specified algorithm is an HKDF-Extract algorithm (<a class="reference internal" href="#c.PSA_ALG_HKDF_EXTRACT" title="PSA_ALG_HKDF_EXTRACT"><code class="docutils literal notranslate"><span class="pre">PSA_ALG_HKDF_EXTRACT</span></code></a><code class="docutils literal notranslate"><span class="pre">(</span></code><code class="docutils literal notranslate"><span class="pre">hash_alg</span></code><code class="docutils literal notranslate"><span class="pre">)</span></code>).</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 1.1.</span></p>
</div>
<pre class="literal-block">#define <a class="reference internal" href="#c.PSA_ALG_IS_HKDF_EXTRACT" title="PSA_ALG_IS_HKDF_EXTRACT">PSA_ALG_IS_HKDF_EXTRACT</a>(alg) <em><a class="reference internal" href="../../overview/implementation.html#specification-defined-value"><span class="std std-ref">/* specification-defined value */</span></a></em></pre>
<p class="rubric">Parameters</p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">alg</span></code></p>
</dt><dd><p>An algorithm identifier: a value of type <a class="reference internal" href="algorithms.html#c.psa_algorithm_t" title="psa_algorithm_t"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_algorithm_t</span></code></a>.</p>
</dd>
</dl>
</div>
<p class="rubric">Returns</p>
<p><code class="docutils literal notranslate"><span class="pre">1</span></code> if <code class="docutils literal notranslate"><span class="pre">alg</span></code> is an HKDF-Extract algorithm, <code class="docutils literal notranslate"><span class="pre">0</span></code> otherwise. This macro can return either <code class="docutils literal notranslate"><span class="pre">0</span></code> or <code class="docutils literal notranslate"><span class="pre">1</span></code> if <code class="docutils literal notranslate"><span class="pre">alg</span></code> is not a supported key-derivation algorithm identifier.</p>
</section>
<section id="c.PSA_ALG_IS_HKDF_EXPAND">
<h3><code class="docutils literal notranslate"><span class="pre">PSA_ALG_IS_HKDF_EXPAND</span></code> (macro)<a class="headerlink" href="#c.PSA_ALG_IS_HKDF_EXPAND" title="Link to this heading">¶</a></h3>
<p>Whether the specified algorithm is an HKDF-Expand algorithm (<a class="reference internal" href="#c.PSA_ALG_HKDF_EXPAND" title="PSA_ALG_HKDF_EXPAND"><code class="docutils literal notranslate"><span class="pre">PSA_ALG_HKDF_EXPAND</span></code></a><code class="docutils literal notranslate"><span class="pre">(</span></code><code class="docutils literal notranslate"><span class="pre">hash_alg</span></code><code class="docutils literal notranslate"><span class="pre">)</span></code>).</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 1.1.</span></p>
</div>
<pre class="literal-block">#define <a class="reference internal" href="#c.PSA_ALG_IS_HKDF_EXPAND" title="PSA_ALG_IS_HKDF_EXPAND">PSA_ALG_IS_HKDF_EXPAND</a>(alg) <em><a class="reference internal" href="../../overview/implementation.html#specification-defined-value"><span class="std std-ref">/* specification-defined value */</span></a></em></pre>
<p class="rubric">Parameters</p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">alg</span></code></p>
</dt><dd><p>An algorithm identifier: a value of type <a class="reference internal" href="algorithms.html#c.psa_algorithm_t" title="psa_algorithm_t"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_algorithm_t</span></code></a>.</p>
</dd>
</dl>
</div>
<p class="rubric">Returns</p>
<p><code class="docutils literal notranslate"><span class="pre">1</span></code> if <code class="docutils literal notranslate"><span class="pre">alg</span></code> is an HKDF-Expand algorithm, <code class="docutils literal notranslate"><span class="pre">0</span></code> otherwise. This macro can return either <code class="docutils literal notranslate"><span class="pre">0</span></code> or <code class="docutils literal notranslate"><span class="pre">1</span></code> if <code class="docutils literal notranslate"><span class="pre">alg</span></code> is not a supported key-derivation algorithm identifier.</p>
</section>
<section id="c.PSA_ALG_IS_SP800_108_COUNTER_HMAC">
<h3><code class="docutils literal notranslate"><span class="pre">PSA_ALG_IS_SP800_108_COUNTER_HMAC</span></code> (macro)<a class="headerlink" href="#c.PSA_ALG_IS_SP800_108_COUNTER_HMAC" title="Link to this heading">¶</a></h3>
<p>Whether the specified algorithm is a key-derivation algorithm constructed using <a class="reference internal" href="#c.PSA_ALG_SP800_108_COUNTER_HMAC" title="PSA_ALG_SP800_108_COUNTER_HMAC"><code class="docutils literal notranslate"><span class="pre">PSA_ALG_SP800_108_COUNTER_HMAC</span></code></a><code class="docutils literal notranslate"><span class="pre">(</span></code><code class="docutils literal notranslate"><span class="pre">hash_alg</span></code><code class="docutils literal notranslate"><span class="pre">)</span></code>.</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 1.2.</span></p>
</div>
<pre class="literal-block">#define <a class="reference internal" href="#c.PSA_ALG_IS_SP800_108_COUNTER_HMAC" title="PSA_ALG_IS_SP800_108_COUNTER_HMAC">PSA_ALG_IS_SP800_108_COUNTER_HMAC</a>(alg) \
    <em><a class="reference internal" href="../../overview/implementation.html#specification-defined-value"><span class="std std-ref">/* specification-defined value */</span></a></em></pre>
<p class="rubric">Parameters</p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">alg</span></code></p>
</dt><dd><p>An algorithm identifier: a value of type <a class="reference internal" href="algorithms.html#c.psa_algorithm_t" title="psa_algorithm_t"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_algorithm_t</span></code></a>.</p>
</dd>
</dl>
</div>
<p class="rubric">Returns</p>
<p><code class="docutils literal notranslate"><span class="pre">1</span></code> if <code class="docutils literal notranslate"><span class="pre">alg</span></code> is a key-derivation algorithm constructed using <a class="reference internal" href="#c.PSA_ALG_SP800_108_COUNTER_HMAC" title="PSA_ALG_SP800_108_COUNTER_HMAC"><code class="docutils literal notranslate"><span class="pre">PSA_ALG_SP800_108_COUNTER_HMAC</span></code></a><code class="docutils literal notranslate"><span class="pre">()</span></code>, <code class="docutils literal notranslate"><span class="pre">0</span></code> otherwise. This macro can return either <code class="docutils literal notranslate"><span class="pre">0</span></code> or <code class="docutils literal notranslate"><span class="pre">1</span></code> if <code class="docutils literal notranslate"><span class="pre">alg</span></code> is not a supported key-derivation algorithm identifier.</p>
</section>
<section id="c.PSA_ALG_IS_TLS12_PRF">
<h3><code class="docutils literal notranslate"><span class="pre">PSA_ALG_IS_TLS12_PRF</span></code> (macro)<a class="headerlink" href="#c.PSA_ALG_IS_TLS12_PRF" title="Link to this heading">¶</a></h3>
<p>Whether the specified algorithm is a TLS-1.2 PRF algorithm.</p>
<pre class="literal-block">#define <a class="reference internal" href="#c.PSA_ALG_IS_TLS12_PRF" title="PSA_ALG_IS_TLS12_PRF">PSA_ALG_IS_TLS12_PRF</a>(alg) <em><a class="reference internal" href="../../overview/implementation.html#specification-defined-value"><span class="std std-ref">/* specification-defined value */</span></a></em></pre>
<p class="rubric">Parameters</p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">alg</span></code></p>
</dt><dd><p>An algorithm identifier: a value of type <a class="reference internal" href="algorithms.html#c.psa_algorithm_t" title="psa_algorithm_t"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_algorithm_t</span></code></a>.</p>
</dd>
</dl>
</div>
<p class="rubric">Returns</p>
<p><code class="docutils literal notranslate"><span class="pre">1</span></code> if <code class="docutils literal notranslate"><span class="pre">alg</span></code> is a TLS-1.2 PRF algorithm, <code class="docutils literal notranslate"><span class="pre">0</span></code> otherwise. This macro can return either <code class="docutils literal notranslate"><span class="pre">0</span></code> or <code class="docutils literal notranslate"><span class="pre">1</span></code> if <code class="docutils literal notranslate"><span class="pre">alg</span></code> is not a supported key-derivation algorithm identifier.</p>
</section>
<section id="c.PSA_ALG_IS_TLS12_PSK_TO_MS">
<h3><code class="docutils literal notranslate"><span class="pre">PSA_ALG_IS_TLS12_PSK_TO_MS</span></code> (macro)<a class="headerlink" href="#c.PSA_ALG_IS_TLS12_PSK_TO_MS" title="Link to this heading">¶</a></h3>
<p>Whether the specified algorithm is a TLS-1.2 PSK to MS algorithm.</p>
<pre class="literal-block">#define <a class="reference internal" href="#c.PSA_ALG_IS_TLS12_PSK_TO_MS" title="PSA_ALG_IS_TLS12_PSK_TO_MS">PSA_ALG_IS_TLS12_PSK_TO_MS</a>(alg) <em><a class="reference internal" href="../../overview/implementation.html#specification-defined-value"><span class="std std-ref">/* specification-defined value */</span></a></em></pre>
<p class="rubric">Parameters</p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">alg</span></code></p>
</dt><dd><p>An algorithm identifier: a value of type <a class="reference internal" href="algorithms.html#c.psa_algorithm_t" title="psa_algorithm_t"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_algorithm_t</span></code></a>.</p>
</dd>
</dl>
</div>
<p class="rubric">Returns</p>
<p><code class="docutils literal notranslate"><span class="pre">1</span></code> if <code class="docutils literal notranslate"><span class="pre">alg</span></code> is a TLS-1.2 PSK to MS algorithm, <code class="docutils literal notranslate"><span class="pre">0</span></code> otherwise. This macro can return either <code class="docutils literal notranslate"><span class="pre">0</span></code> or <code class="docutils literal notranslate"><span class="pre">1</span></code> if <code class="docutils literal notranslate"><span class="pre">alg</span></code> is not a supported key-derivation algorithm identifier.</p>
</section>
<section id="c.PSA_ALG_IS_PBKDF2_HMAC">
<h3><code class="docutils literal notranslate"><span class="pre">PSA_ALG_IS_PBKDF2_HMAC</span></code> (macro)<a class="headerlink" href="#c.PSA_ALG_IS_PBKDF2_HMAC" title="Link to this heading">¶</a></h3>
<p>Whether the specified algorithm is a PBKDF2-HMAC algorithm.</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 1.1.</span></p>
</div>
<pre class="literal-block">#define <a class="reference internal" href="#c.PSA_ALG_IS_PBKDF2_HMAC" title="PSA_ALG_IS_PBKDF2_HMAC">PSA_ALG_IS_PBKDF2_HMAC</a>(alg) <em><a class="reference internal" href="../../overview/implementation.html#specification-defined-value"><span class="std std-ref">/* specification-defined value */</span></a></em></pre>
<p class="rubric">Parameters</p>
<div class="apisubitem docutils container">
<dl class="simple">
<dt><p><code class="docutils literal notranslate"><span class="pre">alg</span></code></p>
</dt><dd><p>An algorithm identifier: a value of type <a class="reference internal" href="algorithms.html#c.psa_algorithm_t" title="psa_algorithm_t"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_algorithm_t</span></code></a>.</p>
</dd>
</dl>
</div>
<p class="rubric">Returns</p>
<p><code class="docutils literal notranslate"><span class="pre">1</span></code> if <code class="docutils literal notranslate"><span class="pre">alg</span></code> is a PBKDF2-HMAC algorithm, <code class="docutils literal notranslate"><span class="pre">0</span></code> otherwise. This macro can return either <code class="docutils literal notranslate"><span class="pre">0</span></code> or <code class="docutils literal notranslate"><span class="pre">1</span></code> if <code class="docutils literal notranslate"><span class="pre">alg</span></code> is not a supported key-derivation algorithm identifier.</p>
</section>
<section id="c.PSA_KEY_DERIVATION_UNLIMITED_CAPACITY">
<h3><code class="docutils literal notranslate"><span class="pre">PSA_KEY_DERIVATION_UNLIMITED_CAPACITY</span></code> (macro)<a class="headerlink" href="#c.PSA_KEY_DERIVATION_UNLIMITED_CAPACITY" title="Link to this heading">¶</a></h3>
<p>Use the maximum possible capacity for a key-derivation operation.</p>
<pre class="literal-block">#define <a class="reference internal" href="#c.PSA_KEY_DERIVATION_UNLIMITED_CAPACITY" title="PSA_KEY_DERIVATION_UNLIMITED_CAPACITY">PSA_KEY_DERIVATION_UNLIMITED_CAPACITY</a> \
    <em><a class="reference internal" href="../../overview/implementation.html#implementation-defined-value"><span class="std std-ref">/* implementation-defined value */</span></a></em></pre>
<p>Use this value as the capacity argument when setting up a key derivation to specify that the operation will use the maximum possible capacity. The value of the maximum possible capacity depends on the key-derivation algorithm.</p>
</section>
<section id="c.PSA_TLS12_PSK_TO_MS_PSK_MAX_SIZE">
<h3><code class="docutils literal notranslate"><span class="pre">PSA_TLS12_PSK_TO_MS_PSK_MAX_SIZE</span></code> (macro)<a class="headerlink" href="#c.PSA_TLS12_PSK_TO_MS_PSK_MAX_SIZE" title="Link to this heading">¶</a></h3>
<p>This macro returns the maximum supported length of the PSK for the TLS-1.2 PSK-to-MS key derivation.</p>
<pre class="literal-block">#define <a class="reference internal" href="#c.PSA_TLS12_PSK_TO_MS_PSK_MAX_SIZE" title="PSA_TLS12_PSK_TO_MS_PSK_MAX_SIZE">PSA_TLS12_PSK_TO_MS_PSK_MAX_SIZE</a> <em><a class="reference internal" href="../../overview/implementation.html#implementation-defined-value"><span class="std std-ref">/* implementation-defined value */</span></a></em></pre>
<p>This implementation-defined value specifies the maximum length for the PSK input used with a <a class="reference internal" href="#c.PSA_ALG_TLS12_PSK_TO_MS" title="PSA_ALG_TLS12_PSK_TO_MS"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_ALG_TLS12_PSK_TO_MS()</span></code></a> key-agreement algorithm.</p>
<p>Quoting <span><em>Pre-Shared Key Ciphersuites for Transport Layer Security (TLS)</em> <a class="reference internal" href="../../about.html#cite-rfc4279"><span class="cite">[RFC4279]</span></a></span> <a class="reference external" href="https://datatracker.ietf.org/doc/html/rfc4279.html#section-5.3">§5.3</a>:</p>
<blockquote>
<div><p>TLS implementations supporting these cipher suites MUST support arbitrary PSK identities up to 128 octets in length, and arbitrary PSKs up to 64 octets in length. Supporting longer identities and keys is RECOMMENDED.</p>
</div></blockquote>
<p>Therefore, it is recommended that implementations define <a class="reference internal" href="#c.PSA_TLS12_PSK_TO_MS_PSK_MAX_SIZE" title="PSA_TLS12_PSK_TO_MS_PSK_MAX_SIZE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_TLS12_PSK_TO_MS_PSK_MAX_SIZE</span></code></a> with a value greater than or equal to <code class="docutils literal notranslate"><span class="pre">64</span></code>.</p>
</section>
<section id="c.PSA_TLS12_ECJPAKE_TO_PMS_OUTPUT_SIZE">
<h3><code class="docutils literal notranslate"><span class="pre">PSA_TLS12_ECJPAKE_TO_PMS_OUTPUT_SIZE</span></code> (macro)<a class="headerlink" href="#c.PSA_TLS12_ECJPAKE_TO_PMS_OUTPUT_SIZE" title="Link to this heading">¶</a></h3>
<p>The size of the output from the TLS 1.2 ECJPAKE-to-PMS key-derivation algorithm, in bytes.</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 1.2.</span></p>
</div>
<pre class="literal-block">#define <a class="reference internal" href="#c.PSA_TLS12_ECJPAKE_TO_PMS_OUTPUT_SIZE" title="PSA_TLS12_ECJPAKE_TO_PMS_OUTPUT_SIZE">PSA_TLS12_ECJPAKE_TO_PMS_OUTPUT_SIZE</a> 32</pre>
<p>This value can be used when extracting the result of a key-derivation operation that was set up with the <a class="reference internal" href="#c.PSA_ALG_TLS12_ECJPAKE_TO_PMS" title="PSA_ALG_TLS12_ECJPAKE_TO_PMS"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_ALG_TLS12_ECJPAKE_TO_PMS</span></code></a> algorithm.</p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &#169; 2018-2025 Arm Limited and/or its affiliates.
      
    </div>

    

    
  </body>
</html>