---
---


<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<meta property="og:title" content="2. Architecture" />
<meta property="og:type" content="website" />
<meta property="og:url" content="{{ page.url | absolute_url }}" />
<meta property="og:site_name" content="PSA Certified Secure Storage API 1.0" />
<meta property="og:description" content="Use Cases and Rationale: Two use cases are addressed by Secure Storage API: Secure storage for device intimate data (Internal Trusted Storage)., Protection for data-at-rest (Protected Storage).. In..." />
<meta name="description" content="Use Cases and Rationale: Two use cases are addressed by Secure Storage API: Secure storage for device intimate data (Internal Trusted Storage)., Protection for data-at-rest (Protected Storage).. In..." />

    <title>2. Architecture &#8212; PSA Certified Secure Storage API 1.0</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="preconnect" type="text/css" href="https://fonts.googleapis.com" />
    <link rel="preconnect" type="text/css" href="https://fonts.gstatic.com" />
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,400;0,700;1,400&display=swap" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3. Requirements" href="requirements.html" />
    <link rel="prev" title="1. Introduction" href="intro.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="architecture">
<h1><span class="section-number">2. </span>Architecture<a class="headerlink" href="#architecture" title="Permalink to this headline">¶</a></h1>
<section id="use-cases-and-rationale">
<h2><span class="section-number">2.1. </span>Use Cases and Rationale<a class="headerlink" href="#use-cases-and-rationale" title="Permalink to this headline">¶</a></h2>
<p>Two use cases are addressed by Secure Storage API:</p>
<ul class="simple">
<li><p>Secure storage for device intimate data (Internal Trusted Storage).</p></li>
<li><p>Protection for data-at-rest (Protected Storage).</p></li>
</ul>
<p>Internal Trusted Storage aims at providing a place for devices to store their most intimate secrets, either to ensure data privacy or data integrity. For example, a device identity key requires confidentiality, whereas an authority public key is public data but requires integrity. Other critical values that are part of a <a class="reference internal" href="../about.html#term-root-of-trust-service"><span class="term">Root of Trust Service</span></a> — for example, secure time values, monotonic counter values, or firmware image hashes — will also need trusted storage.</p>
<p>Protected Storage is meant to protect larger data-sets against physical attacks. It aims to provide the ability for a firmware developer to store data onto external flash, with a promise of data-at-rest protection, including device-bound encryption, integrity, and replay protection. It should be possible to select the appropriate protection level — for example, encryption only, or integrity only, or both — depending on the threat model of the device and the nature of its deployment.</p>
</section>
<section id="technical-background">
<h2><span class="section-number">2.2. </span>Technical Background<a class="headerlink" href="#technical-background" title="Permalink to this headline">¶</a></h2>
<p>Modern embedded platforms have multiple types of storage, each with different security properties.</p>
<p>Most embedded microprocessors (MCU) have on-chip flash storage that can be made inaccessible except to software running on the MCU. If the storage is made inaccessible to software other than that of the <a class="reference internal" href="../about.html#term-platform-root-of-trust"><span class="term">Platform Root of Trust</span></a> (PRoT), then it can be used to store key material, replay protection values, or other data critical to the secure operation of the device.</p>
<p>In addition, many platforms also have external storage that requires confidentiality, integrity, and replay protection from attackers with physical access to the device.</p>
<p>By providing consistent APIs for accessing storage, software in both the <a class="reference internal" href="../about.html#term-nspe"><span class="term">NSPE</span></a> and <a class="reference internal" href="../about.html#term-spe"><span class="term">SPE</span></a> can be written in a platform-independent manner. This improves portability between platforms that implement the PSA Certified APIs.</p>
</section>
<section id="the-protected-storage-api">
<h2><span class="section-number">2.3. </span>The Protected Storage API<a class="headerlink" href="#the-protected-storage-api" title="Permalink to this headline">¶</a></h2>
<p>The Protected Storage API is the general-purpose API that most developers should use. It is intended to be used to protect storage media that are external to the MCU package.</p>
<p>If the Protected Storage API is implemented using external storage without hardware protection, the data must be stored using authenticated encryption, as well as replay-protection values stored using the Internal Trusted Storage API. If the external storage has hardware protection — for example, remote locations or tamper proof enclosures — the need for cryptographic protection will be different.</p>
<p>Secure Storage API provides flags, <a class="reference internal" href="../api/api.html#c.PSA_STORAGE_FLAG_NO_CONFIDENTIALITY" title="PSA_STORAGE_FLAG_NO_CONFIDENTIALITY"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_STORAGE_FLAG_NO_CONFIDENTIALITY</span></code></a> and <a class="reference internal" href="../api/api.html#c.PSA_STORAGE_FLAG_NO_REPLAY_PROTECTION" title="PSA_STORAGE_FLAG_NO_REPLAY_PROTECTION"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_STORAGE_FLAG_NO_REPLAY_PROTECTION</span></code></a>, enabling the caller to request a lower level of protection.</p>
<ul class="simple">
<li><p><a class="reference internal" href="../api/api.html#c.PSA_STORAGE_FLAG_NO_CONFIDENTIALITY" title="PSA_STORAGE_FLAG_NO_CONFIDENTIALITY"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_STORAGE_FLAG_NO_CONFIDENTIALITY</span></code></a> requests integrity but not confidentiality. For example, this might be selected when storing other party’s public keys. This flag does not affect replay protection.</p></li>
<li><p><a class="reference internal" href="../api/api.html#c.PSA_STORAGE_FLAG_NO_REPLAY_PROTECTION" title="PSA_STORAGE_FLAG_NO_REPLAY_PROTECTION"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_STORAGE_FLAG_NO_REPLAY_PROTECTION</span></code></a> requests confidentiality and integrity protection of the data as controlled by <a class="reference internal" href="../api/api.html#c.PSA_STORAGE_FLAG_NO_CONFIDENTIALITY" title="PSA_STORAGE_FLAG_NO_CONFIDENTIALITY"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_STORAGE_FLAG_NO_CONFIDENTIALITY</span></code></a>, but does not require the implementation to store data that would detect replacement with a previously valid value. For all other data objects, the implementation must ensure that the version returned is the most recently stored version.</p></li>
</ul>
<div class="admonition-implementation-note admonition">
<p class="admonition-title">Implementation note</p>
<p>This is usually achieved by creating a hash table or tree of all the file tags and storing the root in Internal Trusted Storage. Some implementations may only store the root and recreate the tree at boot — in which case when it detects and error it cannot tell which file has been tampered with and must reject all attempts to read replay protected files.</p>
</div>
<p>The implementation is permitted to treat these flags as indicative, and to apply a higher level of protection if it does not implement every protection class. It must not apply a lower level of protection than that requested.</p>
<p>An implementation must treat the <a class="reference internal" href="../api/api.html#c.PSA_STORAGE_FLAG_WRITE_ONCE" title="PSA_STORAGE_FLAG_WRITE_ONCE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_STORAGE_FLAG_WRITE_ONCE</span></code></a> flag as definitive, if it is supported.</p>
<p>When reporting meta data, <a class="reference internal" href="../api/api.html#c.psa_ps_get_info" title="psa_ps_get_info"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">psa_ps_get_info()</span></code></a> should report the actual protection level applied, and not the requested level.</p>
</section>
<section id="the-internal-trusted-storage-api">
<h2><span class="section-number">2.4. </span>The Internal Trusted Storage API<a class="headerlink" href="#the-internal-trusted-storage-api" title="Permalink to this headline">¶</a></h2>
<p>The Internal Trusted Storage API is a more specialized API. Uses of the Internal Trusted Storage API will be less common. It is intended to be used for assets that must be placed inside internal flash. Some examples of assets that require this are replay protection values for external storage, and keys used by components of the <a class="reference internal" href="../about.html#term-prot"><span class="term">PRoT</span></a>.</p>
<p>Storing assets that don’t fit this requirement is permissible. In fact, it is expected that many platforms will have the Protected Storage API call directly into the Internal Trusted Storage API. For example, this can be done on platforms that do not have external flash.</p>
<p>While this document makes no requirements about the size of the storage available by the Internal Trusted Storage API, it is expected to be limited, and therefore should be used for small, security-critical values.</p>
<p>As the Internal Storage is implicitly confidential and protected from replay, the implementation can ignore the flags requesting lower levels of protection. However, it must honor the <a class="reference internal" href="../api/api.html#c.PSA_STORAGE_FLAG_WRITE_ONCE" title="PSA_STORAGE_FLAG_WRITE_ONCE"><code class="xref any atg_c atg_c-ref docutils literal notranslate"><span class="pre">PSA_STORAGE_FLAG_WRITE_ONCE</span></code></a> flag.</p>
</section>
<section id="uids">
<h2><span class="section-number">2.5. </span>UIDs<a class="headerlink" href="#uids" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">uids</span></code> in the Secure Storage API are defined as <code class="docutils literal notranslate"><span class="pre">uint64_t</span></code>. This is expected to be larger than would be used on any system. This large namespace is chosen to allow a <a class="reference internal" href="../about.html#term-root-of-trust-service"><span class="term">Root of Trust Service</span></a> to easily manage assets on behalf of other services.</p>
<p>For example, consider a cryptography service running as a RoT Service. When a service running in a <a class="reference internal" href="../about.html#term-secure-partition"><span class="term">Secure Partition</span></a> requests key storage from the cryptography service, the cryptography service can concatenate a numerical identity of the requesting partition (for example, a <code class="docutils literal notranslate"><span class="pre">int32_t</span></code> in the <span><em>Arm® Platform Security Architecture Firmware Framework</em> <a class="reference internal" href="../about.html#cite-psa-ff-m"><span class="cite">[PSA-FF-M]</span></a></span>) with the key identifier (for example, a <code class="docutils literal notranslate"><span class="pre">uint32_t</span></code> in the <span><em>PSA Certified Crypto API</em> <a class="reference internal" href="../about.html#cite-psa-crypt"><span class="cite">[PSA-CRYPT]</span></a></span>) to generate the <code class="docutils literal notranslate"><span class="pre">uid</span></code> of the Internal Trusted Storage entry for the key. This allows the cryptography service to easily manage isolation between the key namespaces of its various clients.</p>
<p>Requirements for <code class="docutils literal notranslate"><span class="pre">uid</span></code>:</p>
<ul class="simple">
<li><p>The value zero (<code class="docutils literal notranslate"><span class="pre">0</span></code>) is reserved, and will result in an error if passed to any of the Secure Storage API functions.</p></li>
<li><p>Each partition can use any of the non-zero <code class="docutils literal notranslate"><span class="pre">uids</span></code> in the full 64-bit range.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">uid</span></code> namespaces are independent. Using a <code class="docutils literal notranslate"><span class="pre">uid</span></code> in one partition has no impact on the <code class="docutils literal notranslate"><span class="pre">uids</span></code> or data assets in another partition.</p></li>
<li><p>Data assets are always private. There is no mechanism that enables one partition to access a data asset owned by another partition.</p></li>
</ul>
<p>The implication is that the implementation cannot divide the <code class="docutils literal notranslate"><span class="pre">uid</span></code> range between partitions, but it must use a partition identify, in addition to the <code class="docutils literal notranslate"><span class="pre">uid</span></code>, to identify a specific data asset.</p>
</section>
<section id="atomicity-of-operations">
<h2><span class="section-number">2.6. </span>Atomicity of Operations<a class="headerlink" href="#atomicity-of-operations" title="Permalink to this headline">¶</a></h2>
<p>In the event of power failure or other interruption of operations that modify storage, implementations of the Secure Storage API must maintain the properties shown in <span><a class="reference internal" href="#tab-acid"><span class="numref">Table 4</span></a></span>.</p>
<table class="colwidths-given longtable docutils align-right" id="tab-acid">
<caption><span class="caption-number">Table 4 </span><span class="caption-text">Properties of storage operations</span><a class="headerlink" href="#tab-acid" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 17%" />
<col style="width: 83%" />
</colgroup>
<tbody>
<tr class="row-odd"><th class="stub"><p>Atomicity</p></th>
<td><p>After the operation, the data assets of the storage service either contain the new data or are unchanged. Atomicity should be guaranteed in all situations — for example, an invalid request, a software crash or a power cycle — and must not result in corruption of the data assets. The only exceptions to this are situations involving storage failures or corruption.</p></td>
</tr>
<tr class="row-even"><th class="stub"><p>Consistency</p></th>
<td><p>In the Secure Storage API, each operation is individually atomic. A multi-threaded application using Secure Storage API must not be able to observe any intermediate state in the data assets. If thread ‘B’ calls the Secure Storage API while thread ‘A’ is in the middle of an operation that modifies a data asset, thread ‘B’ must either see the state of the asset before, or the state of the asset after, the operation requested by thread ‘A’.</p></td>
</tr>
<tr class="row-odd"><th class="stub"><p>Isolation</p></th>
<td><p>A partition using the storage service cannot cause a change in the data assets belonging to a different partition.</p></td>
</tr>
<tr class="row-even"><th class="stub"><p>Durability</p></th>
<td><p>When an operation that modifies storage returns to the caller, the data is persisted. System reset or power fail at this point will not revert the data assets to the previous state.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="components">
<h2><span class="section-number">2.7. </span>Components<a class="headerlink" href="#components" title="Permalink to this headline">¶</a></h2>
<p><span><a class="reference internal" href="#tab-components"><span class="numref">Table 5</span></a></span> lists the significant components in a system that implements Secure Storage API.</p>
<table class="colwidths-given longtable docutils align-right" id="tab-components">
<caption><span class="caption-number">Table 5 </span><span class="caption-text">Components in a system that implements the Trusted Storage API</span><a class="headerlink" href="#tab-components" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 25%" />
<col style="width: 75%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Component</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Internal Trusted Storage API</p></td>
<td><p>The storage API described in this document intended for access to internal flash memory.</p></td>
</tr>
<tr class="row-odd"><td><p>Internal Trusted Storage service</p></td>
<td><p>A <a class="reference internal" href="../about.html#term-platform-root-of-trust"><span class="term">Platform Root of Trust</span></a> service that implements the Internal Trusted Storage API.</p></td>
</tr>
<tr class="row-even"><td><p>Protected Storage API</p></td>
<td><p>The general-purpose storage API described in this document.</p></td>
</tr>
<tr class="row-odd"><td><p>Protected Storage service</p></td>
<td><p>A service, implemented either in the <a class="reference internal" href="../about.html#term-application-root-of-trust"><span class="term">Application Root of Trust</span></a> or the <a class="reference internal" href="../about.html#term-nspe"><span class="term">NSPE</span></a>, that implements the Protected Storage API.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../about.html#term-secure-partition-manager"><span class="term">Secure Partition Manager</span></a></p></td>
<td><p>The entity in the <a class="reference internal" href="../about.html#term-secure-processing-environment"><span class="term">Secure Processing Environment</span></a> responsible for communicating requests between the various secure services.</p></td>
</tr>
</tbody>
</table>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/Arm_logo_blue_RGB.svg" alt="Logo"/>
            </a></p><hr />
<h3><a href="../index.html"><b>PSA Certified<br />Secure Storage API</b></a></h3>
IHI 0087<br/>
Non-confidential<br/>
Version 1.0.1
<span style="font-weight: bold;"></span>
<hr />
<ul>
<li class="toctree-l1"><a class="reference internal" href="../about.html">About this document</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">1. Introduction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">2. Architecture</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#use-cases-and-rationale">2.1. Use Cases and Rationale</a></li>
<li class="toctree-l2"><a class="reference internal" href="#technical-background">2.2. Technical Background</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-protected-storage-api">2.3. The Protected Storage API</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-internal-trusted-storage-api">2.4. The Internal Trusted Storage API</a></li>
<li class="toctree-l2"><a class="reference internal" href="#uids">2.5. UIDs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#atomicity-of-operations">2.6. Atomicity of Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#components">2.7. Components</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="requirements.html">3. Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="operation.html">4. Theory of Operation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/api.html">5. API Reference</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../appendix/headers.html">A. Example header files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/history.html">B. Document history</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../atg_c-identifiers.html">Index of API elements</a></li>
</ul>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy; 2018-2019, 2022 Arm Limited and/or its affiliates.
      
    </div>

    

    
  </body>
</html>